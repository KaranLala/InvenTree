import{r as n,i as t,j as s,B as H,eM as Q,b2 as le,cx as ce,dz as X,bx as de,bW as C,bw as ue,b9 as pe,S as me}from"./vendor-c9tu_e1b.js";import{b as se,m as o,A as c,U as _,e as T,f as _e}from"./index-C-YqHYR0.js";import{A as he}from"./AdminButton-B4su-izZ.js";import{P as Y}from"./PrimaryActionButton-DeoSYpU2.js";import{u as be,G as fe,R as ye,Z as xe,a as ke,I as ge,y as Ce,P as je,O as Pe,E as Ae,z as Se,X as De,Y as ve}from"./InvenTreeTable-_nPJoCLK.js";import{I as Ie,D as q,a as Re}from"./InstanceDetail-BhafbIJP.js";import{D as Fe,N as Le}from"./NotesPanel-B1Mm8XV0.js";import{a as Te,p as Ee,S as Z}from"./ThemeContext-CVPHi9Q7.js";import{P as Me}from"./PageDetail-UrmB-yLk.js";import{A as Ne}from"./AttachmentPanel-cEo4FCl5.js";import{P as Oe}from"./PanelGroup-Dx-tKZpU.js";import{b as j,R as qe,n as we,g as We,u as ae,a as Ke,A as Ue,h as Ve}from"./UseForm-21BEg7Md.js";import{a as Be}from"./formatters-1-K9MQML.js";import{a as Ge,b as z,u as J}from"./PurchaseOrderForms-CcRoGXTZ.js";import{u as He}from"./UseInstance-Z-QOK6WR.js";import{u as ie}from"./UseStatusCodes-Csh8ugV0.js";import{E as Qe}from"./ExtraLineItemTable-D78MeQx9.js";import{A as $}from"./ActionButton-Cn3lAMG1.js";import{P as Xe}from"./index-D1sX3jYA.js";import{d as Ye,I as Ze}from"./ImporterForms-BetUyFIA.js";import{P as ze,D as Je,R as $e,L as ee,n as te,T as et,j as tt,N as st}from"./ColumnRenderers-6-W27ey5.js";import{S as at}from"./StockItemTable-BNURu3dq.js";import"./DesktopAppView-Bg1vO8uy.js";import"./QRCode-4MaRh6JQ.js";import"./browser-oJrDmCBJ.js";import"./YesNoButton-BdKeJbQO.js";import"./ModelType-CepomS9H.js";import"./GenericErrorPage-RCGZWWhe.js";import"./NotFound-Cglkc0xC.js";import"./PermissionDenied-D4im8ofc.js";import"./PageTitle-BiZTQEW1.js";import"./AttachmentLink-BmXuTpAy.js";import"./PluginSource-CpS38oS9.js";import"./RemoteComponent-BK_-mK5N.js";import"./RemoveRowButton-0iZczeVG.js";import"./UseGenerator-DwBNXut7.js";import"./CommonForms-CCxz_oyT.js";import"./OrderPartsWizard-DcOlnycT.js";import"./CompanyForms-DAK9mm-H.js";import"./UseStockAdjustActions-PDcplZpx.js";function it({order:i,orderDetailRefresh:f,orderId:d,currency:e,supplierId:h,params:b}){const l=be("purchase-order-line-item"),w=Te(),u=se(),[S,E]=n.useState(!1),[D,M]=n.useState(void 0),W=n.useMemo(()=>{var p;const a=Ye();return a.model_type.hidden=!0,a.model_type.value=o.purchaseorderlineitem,a.field_overrides.value={order:d},a.field_defaults.value={purchase_price_currency:(i==null?void 0:i.order_currency)||((p=i==null?void 0:i.supplier_detail)==null?void 0:p.currency)||void 0},a.field_filters.value={part:{supplier:h,active:!0}},a},[i,d,h]),m=j({url:c.import_session_list,title:t._({id:"yWWRAr"}),fields:W,onFormSuccess:a=>{M(a.pk),E(!0)}}),[v,I]=n.useState(null),P=Ge({items:v?[v]:l.selectedRecords,orderPk:d,destinationPk:i.destination,formProps:{onClose:()=>{l.clearSelectedRecords(),l.refreshTable(),setTimeout(()=>I(null),500)}}}),N=n.useMemo(()=>[{accessor:"part",title:t._({id:"vgP+9p"}),sortable:!0,ordering:"part_name",switchable:!1,render:a=>ze({part:a.part_detail})},{accessor:"part_detail.IPN",sortable:!0,ordering:"IPN"},Je({accessor:"part_detail.description"}),$e({}),{accessor:"build_order",title:t._({id:"YxwWvi"}),sortable:!0,defaultVisible:!1,render:a=>a.build_order_detail?s.jsx(qe,{instance:a.build_order_detail,model:o.build}):"-"},{accessor:"quantity",title:t._({id:"VbWX2u"}),sortable:!0,switchable:!1,render:a=>{const p=(a==null?void 0:a.supplier_part_detail)??{},B=(a==null?void 0:a.part_detail)??(p==null?void 0:p.part_detail)??{},G=[];if((p==null?void 0:p.pack_quantity_native)!=null&&p.pack_quantity_native!=1){const ne=a.quantity*p.pack_quantity_native;G.push(s.jsxs(H,{children:[t._({id:"J9LTXQ"}),": ",p.pack_quantity]},"pack-quantity")),G.push(s.jsxs(H,{children:[t._({id:"GbI1d2"}),": ",ne," ",B==null?void 0:B.units]},"total-quantity"))}return s.jsx(we,{value:We(a.quantity),extra:G,title:t._({id:"VbWX2u"})})}},{accessor:"received",title:t._({id:"fZ5Vnu"}),sortable:!1,render:a=>s.jsx(Xe,{progressLabel:!0,value:a.received,maximum:a.quantity})},{accessor:"supplier_part_detail.packaging",sortable:!1,title:t._({id:"pD/Ew0"}),defaultVisible:!1},{accessor:"supplier_part_detail.pack_quantity",sortable:!1,title:t._({id:"J9LTXQ"})},{accessor:"sku",title:t._({id:"PeuqsI"}),switchable:!1,sortable:!0,ordering:"SKU"},ee({accessor:"supplier_part_detail.link",title:t._({id:"h3/Rpt"}),sortable:!1,defaultVisible:!1}),{accessor:"mpn",ordering:"MPN",title:t._({id:"u7qly3"}),sortable:!0,defaultVisible:!1},te({accessor:"purchase_price",title:t._({id:"vWelsN"})}),te({accessor:"total_price",currency_accessor:"purchase_price_currency",title:t._({id:"KyZVKD"})}),et({}),tt({accessor:"destination_detail",sortable:!1,title:t._({id:"Enslfm"})}),st({}),ee({})],[d,u]),K=n.useMemo(()=>[{name:"received",label:t._({id:"fZ5Vnu"}),description:t._({id:"8Dmqxr"})}],[]),U=z({create:!0,orderId:d,supplierId:h}),[V,R]=n.useState({}),r=j({url:c.purchase_order_line_list,title:t._({id:"pwb7Yo"}),fields:U,initialData:{...V,purchase_price_currency:e},onFormSuccess:f,table:l}),[y,A]=n.useState(0),F=z({create:!1,orderId:d,supplierId:h}),g=ae({url:c.purchase_order_line_list,pk:y,title:t._({id:"vgosWS"}),fields:F,onFormSuccess:f,table:l}),L=Ke({url:c.purchase_order_line_list,pk:y,title:t._({id:"tpKh8C"}),onFormSuccess:f,table:l}),x=ie({modelType:o.purchaseorder}),k=n.useMemo(()=>i.status==x.PENDING||i.status==x.PLACED||i.status==x.ON_HOLD,[i,x]),O=n.useMemo(()=>i.status==x.PLACED,[i,x]),re=n.useCallback(a=>[{hidden:((a==null?void 0:a.received)??0)>=((a==null?void 0:a.quantity)??0)||!O,title:t._({id:"ul9IpB"}),icon:s.jsx(Q,{}),color:"green",onClick:()=>{I(a),P.open()}},fe({hidden:!a.build_order,title:t._({id:"bjYQWK"}),modelType:o.build,modelId:a.build_order,navigate:w}),ye({hidden:!u.hasChangeRole(_.purchase_order),onClick:()=>{A(a.pk),g.open()}}),xe({hidden:!k||!u.hasAddRole(_.purchase_order),onClick:()=>{R({...a}),r.open()}}),ke({hidden:!u.hasDeleteRole(_.purchase_order),onClick:()=>{A(a.pk),L.open()}})],[d,u,k,O]),oe=n.useMemo(()=>[s.jsx($,{hidden:!k||!u.hasAddRole(_.purchase_order),tooltip:t._({id:"yWWRAr"}),icon:s.jsx(le,{}),onClick:()=>m.open()},"import-line-items"),s.jsx(Ue,{tooltip:t._({id:"pwb7Yo"}),onClick:()=>{R({order:d}),r.open()},hidden:!k||!(u!=null&&u.hasAddRole(_.purchase_order))},"add-line-item"),s.jsx($,{text:t._({id:"gyK1dv"}),icon:s.jsx(Q,{}),onClick:()=>P.open(),disabled:l.selectedRecords.length===0,hidden:!O||!u.hasChangeRole(_.purchase_order)},"receive-items")],[d,u,l,k,O]);return s.jsxs(s.Fragment,{children:[m.modal,P.modal,r.modal,g.modal,L.modal,s.jsx(ge,{url:T(c.purchase_order_line_list),tableState:l,columns:N,props:{enableSelection:!0,enableDownload:!0,params:{...b,order:d,part_detail:!0},rowActions:re,tableActions:oe,tableFilters:K,modelType:o.supplierpart,modelField:"part"}}),s.jsx(Ze,{sessionId:D??-1,opened:D!=null&&S,onClose:()=>{M(void 0),E(!1),l.refreshTable()}})]})}function Gt(){var R;const{id:i}=Ee(),f=se(),d=_e(),{instance:e,instanceQuery:h,refreshInstance:b}=He({endpoint:c.purchase_order_list,pk:i,params:{supplier_detail:!0},refetchOnMount:!0}),l=n.useMemo(()=>{var r;return e.order_currency||((r=e.supplier_detail)==null?void 0:r.currency)||d.getSetting("INVENTREE_DEFAULT_CURRENCY")},[e,d]),w=J({}),u=J({duplicateOrderId:e.pk}),S=ae({url:c.purchase_order_list,pk:i,title:t._({id:"lAF9Uk"}),fields:w,onFormSuccess:()=>{b()}}),E=n.useMemo(()=>{const r={...e};return delete r.reference,r},[e]),D=j({url:c.purchase_order_list,title:t._({id:"XRoR1U"}),fields:u,initialData:E,follow:!0,modelType:o.purchaseorder}),M=n.useMemo(()=>{var g,L,x;if(h.isFetching)return s.jsx(ce,{});const r=[{type:"text",name:"reference",label:t._({id:"N2C89m"}),copy:!0},{type:"text",name:"supplier_reference",label:t._({id:"K7PVg3"}),icon:"reference",hidden:!e.supplier_reference,copy:!0},{type:"link",name:"supplier",icon:"suppliers",label:t._({id:"PYTEl0"}),model:o.company},{type:"text",name:"description",label:t._({id:"Nu4oKW"}),copy:!0},{type:"status",name:"status",label:t._({id:"uAQUqI"}),model:o.purchaseorder},{type:"status",name:"status_custom_key",label:t._({id:"4DvUAJ"}),model:o.purchaseorder,icon:"status",hidden:!e.status_custom_key||e.status_custom_key==e.status}],y=[{type:"progressbar",name:"completed",icon:"progress",label:t._({id:"qgs95u"}),total:e.line_items,progress:e.completed_lines},{type:"link",model:o.stocklocation,link:!0,name:"destination",label:t._({id:"Enslfm"}),hidden:!e.destination},{type:"text",name:"currency",label:t._({id:"0UZTSq"}),value_formatter:()=>l},{type:"text",name:"total_price",label:t._({id:"A6C0pv"}),value_formatter:()=>{var k;return Be(e==null?void 0:e.total_price,{currency:(e==null?void 0:e.order_currency)||((k=e==null?void 0:e.supplier_detail)==null?void 0:k.currency)})}}],A=[{type:"link",external:!0,name:"link",label:t._({id:"yzF66j"}),copy:!0,hidden:!e.link},{type:"text",name:"contact_detail.name",label:t._({id:"jfC/xh"}),icon:"user",copy:!0,hidden:!e.contact},{type:"text",name:"contact_detail.email",label:t._({id:"41BQ3k"}),icon:"email",copy:!0,hidden:!((g=e.contact_detail)!=null&&g.email)},{type:"text",name:"contact_detail.phone",label:t._({id:"P1x5uo"}),icon:"phone",copy:!0,hidden:!((L=e.contact_detail)!=null&&L.phone)},{type:"text",name:"project_code_label",label:t._({id:"Sdfr6G"}),icon:"reference",copy:!0,hidden:!e.project_code},{type:"text",name:"responsible",label:t._({id:"XQACoK"}),badge:"owner",hidden:!e.responsible}],F=[{type:"date",name:"creation_date",label:t._({id:"FNcMGM"}),copy:!0,icon:"calendar"},{type:"date",name:"issue_date",label:t._({id:"M1cChr"}),icon:"calendar",copy:!0,hidden:!e.issue_date},{type:"date",name:"start_date",label:t._({id:"D3iCkb"}),icon:"calendar",copy:!0,hidden:!e.start_date},{type:"date",name:"target_date",label:t._({id:"ZmykKo"}),icon:"calendar",copy:!0,hidden:!e.target_date},{type:"date",name:"complete_date",icon:"calendar_check",label:t._({id:"41ha49"}),copy:!0,hidden:!e.complete_date}];return s.jsxs(Ie,{children:[s.jsxs(X,{grow:!0,children:[s.jsx(Fe,{appRole:_.purchase_order,apiPath:c.company_list,src:(x=e.supplier_detail)==null?void 0:x.image,pk:e.supplier}),s.jsx(X.Col,{span:{base:12,sm:8},children:s.jsx(q,{fields:r,item:e})})]}),s.jsx(q,{fields:y,item:e}),s.jsx(q,{fields:A,item:e}),s.jsx(q,{fields:F,item:e})]})},[e,l,h]),W=n.useMemo(()=>[{name:"detail",label:t._({id:"Tol4BF"}),icon:s.jsx(de,{}),content:M},{name:"line-items",label:t._({id:"SgduFH"}),icon:s.jsx(ue,{}),content:s.jsxs(C,{multiple:!0,defaultValue:["line-items","extra-items"],children:[s.jsxs(C.Item,{value:"line-items",children:[s.jsx(C.Control,{children:s.jsx(Z,{size:"lg",children:t._({id:"SgduFH"})})}),s.jsx(C.Panel,{children:s.jsx(it,{order:e,orderDetailRefresh:b,currency:l,orderId:Number(i),supplierId:Number(e.supplier)})})]},"lineitems"),s.jsxs(C.Item,{value:"extra-items",children:[s.jsx(C.Control,{children:s.jsx(Z,{size:"lg",children:t._({id:"l11DG/"})})}),s.jsx(C.Panel,{children:s.jsx(Qe,{endpoint:c.purchase_order_extra_line_list,orderId:e.pk,orderDetailRefresh:b,currency:l,role:_.purchase_order})})]},"extraitems")]})},{name:"received-stock",label:t._({id:"b447qM"}),icon:s.jsx(pe,{}),content:s.jsx(at,{tableName:"received-stock",params:{purchase_order:i}})},Ne({model_type:o.purchaseorder,model_id:e.pk}),Le({model_type:o.purchaseorder,model_id:e.pk})],[e,i,f]),m=ie({modelType:o.purchaseorder}),v=j({url:T(c.purchase_order_issue,e.pk),title:t._({id:"keApR9"}),onFormSuccess:b,preFormWarning:t._({id:"lLiNZC"}),successMessage:t._({id:"R/WvFK"})}),I=j({url:T(c.purchase_order_cancel,e.pk),title:t._({id:"98xQHK"}),onFormSuccess:b,preFormWarning:t._({id:"MPFqR0"}),successMessage:t._({id:"H5qWhm"})}),P=j({url:T(c.purchase_order_hold,e.pk),title:t._({id:"vJaCK0"}),onFormSuccess:b,preFormWarning:t._({id:"3Wfk51"}),successMessage:t._({id:"0NH/ob"})}),N=j({url:T(c.purchase_order_complete,e.pk),title:t._({id:"CWbcdO"}),successMessage:t._({id:"W7TghJ"}),timeout:1e4,fields:{accept_incomplete:{}},onFormSuccess:b,preFormWarning:t._({id:"DYITap"})}),K=n.useMemo(()=>{const r=f.hasChangeRole(_.purchase_order),y=r&&(e.status==m.PENDING||e.status==m.ON_HOLD),A=r&&(e.status==m.PENDING||e.status==m.PLACED),F=r&&e.status==m.PLACED,g=r&&e.status!=m.CANCELLED&&e.status!=m.COMPLETE;return[s.jsx(Y,{title:t._({id:"WajCDs"}),icon:"issue",hidden:!y,color:"blue",onClick:v.open}),s.jsx(Y,{title:t._({id:"NPZqBL"}),icon:"complete",hidden:!F,color:"green",onClick:N.open}),s.jsx(he,{model:o.purchaseorder,id:e.pk}),s.jsx(Ce,{model:o.purchaseorder,pk:e.pk,hash:e==null?void 0:e.barcode_hash}),s.jsx(je,{modelType:o.purchaseorder,items:[e.pk],enableReports:!0}),s.jsx(Pe,{tooltip:t._({id:"/IKytX"}),actions:[Ae({hidden:!r,tooltip:t._({id:"mVeaUg"}),onClick:()=>{S.open()}}),Se({hidden:!f.hasAddRole(_.purchase_order),onClick:()=>D.open(),tooltip:t._({id:"oi/3Pq"})}),De({tooltip:t._({id:"20mLBC"}),hidden:!A,onClick:P.open}),ve({tooltip:t._({id:"tVJk4q"}),hidden:!g,onClick:I.open})]})]},[i,e,f,m]),U=n.useMemo(()=>h.isLoading?[]:[s.jsx(Ve,{status:e.status_custom_key,type:o.purchaseorder,options:{size:"lg"}})],[e,h]),V=n.useMemo(()=>{var y;let r=((y=e.supplier_detail)==null?void 0:y.name)||"";return e.supplier_reference&&(r+=` (${e.supplier_reference})`),r},[e]);return s.jsxs(s.Fragment,{children:[v.modal,P.modal,I.modal,N.modal,S.modal,D.modal,s.jsx(Re,{query:h,requiredRole:_.purchase_order,children:s.jsxs(me,{gap:"xs",children:[s.jsx(Me,{title:`${t._({id:"KxySMG"})}: ${e.reference}`,subtitle:V,imageUrl:(R=e.supplier_detail)==null?void 0:R.image,breadcrumbs:[{name:t._({id:"UOTpFa"}),url:"/purchasing/"}],lastCrumb:[{name:e.reference,url:`/purchasing/purchase-order/${e.pk}`}],actions:K,badges:U,editAction:S.open,editEnabled:f.hasChangePermission(o.purchaseorder)}),s.jsx(Oe,{pageKey:"purchaseorder",panels:W,model:o.purchaseorder,instance:e,reloadInstance:b,id:e.pk})]})})]})}export{Gt as default};
//# sourceMappingURL=PurchaseOrderDetail-yqKtwsK_.js.map
