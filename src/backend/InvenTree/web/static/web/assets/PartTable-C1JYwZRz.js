import{r,i as e,j as l,b9 as w,aV as A,B as c,G as I}from"./vendor-c9tu_e1b.js";import{b as R,u as E,c as M,A as F,g as u,n as L}from"./UseForm-21BEg7Md.js";import{u as V,R as N,x as q,I as B}from"./InvenTreeTable-_nPJoCLK.js";import{e as S,A as b,f as W,b as z,m as h,U as y}from"./index-C-YqHYR0.js";import{O as D}from"./OrderPartsWizard-DcOlnycT.js";import{b as G}from"./formatters-1-K9MQML.js";import{u as O}from"./DesktopAppView-Bg1vO8uy.js";import{I as v}from"./ThemeContext-CVPHi9Q7.js";import{P as Y,D as $,l as K,m as U,L as J}from"./ColumnRenderers-6-W27ey5.js";function k({create:t=!1}){const o=W();return r.useMemo(()=>{const a={category:{filters:{structural:!1}},name:{},IPN:{},description:{},revision:{},revision_of:{filters:{is_revision:!1,is_template:!1}},variant_of:{filters:{is_template:!0}},keywords:{},units:{},link:{},default_location:{filters:{structural:!1}},default_expiry:{},minimum_stock:{},responsible:{filters:{is_active:!0}},component:{},assembly:{},is_template:{},testable:{},trackable:{},purchaseable:{},salable:{},virtual:{},locked:{},active:{},starred:{field_type:"boolean",label:e._({id:"7VIaU3"}),description:e._({id:"wyHaGh"}),disabled:!1,required:!1}};return t&&(a.copy_category_parameters={},a.initial_stock={icon:l.jsx(w,{}),children:{quantity:{value:0},location:{}}},a.initial_supplier={children:{supplier:{filters:{is_supplier:!0}},sku:{},manufacturer:{filters:{is_manufacturer:!0}},mpn:{}}}),o.isSet("PART_REVISION_ASSEMBLY_ONLY")&&(a.revision_of.filters.assembly=!0),o.isSet("PART_ENABLE_REVISION")||(delete a.revision,delete a.revision_of),o.isSet("STOCK_ENABLE_EXPIRY")||delete a.default_expiry,t&&delete a.starred,a},[t,o])}function ne({create:t}){return r.useMemo(()=>{const a={parent:{description:e._({id:"oATGL2"}),required:!1},name:{},description:{},default_location:{filters:{structural:!1}},default_keywords:{},structural:{},starred:{field_type:"boolean",label:e._({id:"7VIaU3"}),description:e._({id:"8Qu8gC"}),disabled:!1,required:!1},icon:{field_type:"icon"}};return t&&delete a.starred,a},[t])}function re({editTemplate:t}){const o=O(),[a,d]=r.useState([]),[s,n]=r.useState("string");return r.useMemo(()=>({part:{disabled:!0},template:{disabled:t==!1,onValueChange:(_,i)=>{if(i!=null&&i.checkbox)d([]),n("boolean");else if(i!=null&&i.choices){const m=i.choices.split(",");m.length>0?(d(m.map(p=>({display_name:p.trim(),value:p.trim()}))),n("choice")):(d([]),n("string"))}else i!=null&&i.selectionlist?o.get(S(b.selectionlist_detail,i.selectionlist)).then(m=>{d(m.data.choices.map(p=>({value:p.value,display_name:p.label}))),n("choice")}):(d([]),n("string"))}},data:{type:s,field_type:s,choices:s==="choice"?a:void 0,default:s==="boolean"?!1:void 0,adjustValue:_=>{let i=_.toString().trim();return s==="boolean"&&i.toLowerCase()!=="true"&&(i="false"),i}},note:{}}),[t,s,a])}function de(){return{part:{hidden:!0},quantity:{},item_count:{},cost_min:{},cost_min_currency:{},cost_max:{},cost_max_currency:{},note:{}}}function Q(){return[{accessor:"name",title:e._({id:"vgP+9p"}),sortable:!0,noWrap:!0,switchable:!1,render:t=>Y({part:t})},{accessor:"IPN",sortable:!0},{accessor:"revision",sortable:!0},{accessor:"units",sortable:!0},$({}),K({accessor:"category_detail"}),U({accessor:"default_location_detail"}),{accessor:"total_in_stock",sortable:!0,render:t=>{const o=[],a=(t==null?void 0:t.total_in_stock)??0,d=((t==null?void 0:t.allocated_to_build_orders)??0)+((t==null?void 0:t.allocated_to_sales_orders)??0),s=Math.max(0,a-d),n=(t==null?void 0:t.minimum_stock)??0;let _=String(u(a)),i;return n>a&&(o.push(l.jsx(c,{c:"orange",children:`${e._({id:"Lgnuy/"})}: ${u(n)}`},"min-stock")),i="orange"),t.ordering>0&&o.push(l.jsx(c,{children:`${e._({id:"0lg3zX"})}: ${u(t.ordering)}`},"on-order")),t.building&&o.push(l.jsx(c,{children:`${e._({id:"oZd08v"})}: ${u(t.building)}`},"building")),t.allocated_to_build_orders>0&&o.push(l.jsx(c,{children:`${e._({id:"KCpl4N"})}: ${u(t.allocated_to_build_orders)}`},"bo-allocations")),t.allocated_to_sales_orders>0&&o.push(l.jsx(c,{children:`${e._({id:"DaWMWw"})}: ${u(t.allocated_to_sales_orders)}`},"so-allocations")),s!=a&&o.push(l.jsxs(c,{children:[e._({id:"csDS2L"}),": ",u(s)]},"available")),t.external_stock>0&&o.push(l.jsxs(c,{children:[e._({id:"e8fwfT"}),": ",u(t.external_stock)]},"external")),a<=0?(i="red",_=e._({id:"AbC1Px"})):s<=0?i="orange":s<n&&(i="yellow"),l.jsx(L,{value:l.jsxs(I,{gap:"xs",justify:"left",wrap:"nowrap",children:[l.jsx(c,{c:i,children:_}),t.units&&l.jsxs(c,{size:"xs",c:i,children:["[",t.units,"]"]})]}),title:e._({id:"odasNw"}),extra:o})}},{accessor:"price_range",title:e._({id:"YA4hwj"}),sortable:!0,ordering:"pricing_max",defaultVisible:!1,render:t=>G(t.pricing_min,t.pricing_max)},J({})]}function X(){return[{name:"active",label:e._({id:"F6pfE9"}),description:e._({id:"PHri/6"}),type:"boolean"},{name:"locked",label:e._({id:"G2fuEb"}),description:e._({id:"j5DYyt"}),type:"boolean"},{name:"assembly",label:e._({id:"WL36Yh"}),description:e._({id:"oQzKsK"}),type:"boolean"},{name:"bom_valid",label:e._({id:"RqzqYw"}),description:e._({id:"weW3ee"}),type:"boolean"},{name:"cascade",label:e._({id:"NgZniC"}),description:e._({id:"5JhtGd"}),type:"boolean"},{name:"component",label:e._({id:"dK3Z9j"}),description:e._({id:"oO7QIX"}),type:"boolean"},{name:"testable",label:e._({id:"bJsTOf"}),description:e._({id:"n8MVvQ"}),type:"boolean"},{name:"trackable",label:e._({id:"y6MnU0"}),description:e._({id:"MbixSq"}),type:"boolean"},{name:"has_units",label:e._({id:"YyRdJQ"}),description:e._({id:"WyFVby"}),type:"boolean"},{name:"has_ipn",label:e._({id:"c9/Fqb"}),description:e._({id:"jh/Aa+"}),type:"boolean"},{name:"has_stock",label:e._({id:"JqmfuT"}),description:e._({id:"6Kd+HK"}),type:"boolean"},{name:"low_stock",label:e._({id:"UgdO7s"}),description:e._({id:"GDYPCw"}),type:"boolean"},{name:"purchaseable",label:e._({id:"TW9g28"}),description:e._({id:"KMdl2R"}),type:"boolean"},{name:"salable",label:e._({id:"/3xNJ4"}),description:e._({id:"V5i7hf"}),type:"boolean"},{name:"virtual",label:e._({id:"ksX7Wx"}),description:e._({id:"QDTpY6"}),type:"choice",choices:[{value:"true",label:e._({id:"ksX7Wx"})},{value:"false",label:e._({id:"+SkaI8"})}]},{name:"is_template",label:e._({id:"62zyX+"}),description:e._({id:"utmCBg"}),type:"boolean"},{name:"is_variant",label:e._({id:"t/zat7"}),description:e._({id:"7xsBld"}),type:"boolean"},{name:"is_revision",label:e._({id:"wV5kLq"}),description:e._({id:"bvyXYp"})},{name:"has_revisions",label:e._({id:"uN6v7B"}),description:e._({id:"mWe3zs"})},{name:"has_pricing",label:e._({id:"T43R5B"}),description:e._({id:"/t4j0O"}),type:"boolean"},{name:"unallocated_stock",label:e._({id:"oGd3rK"}),description:e._({id:"NINff3"}),type:"boolean"},{name:"starred",label:e._({id:"7VIaU3"}),description:e._({id:"PNFIYy"}),type:"boolean"}]}function ce({props:t,defaultPartData:o}){const a=r.useMemo(()=>Q(),[]),d=r.useMemo(()=>X(),[]),s=V("part-list"),n=z(),_=r.useMemo(()=>o??t.params??{},[o,t.params]),i=R({url:b.part_list,title:e._({id:"rGfVOS"}),fields:k({create:!0}),initialData:_,follow:!0,modelType:h.part}),[m,p]=r.useState(-1),f=E({url:b.part_list,pk:m,title:e._({id:"enG3o5"}),fields:k({create:!1}),onFormSuccess:s.refreshTable}),g=M({url:b.part_list,items:s.selectedIds,title:e._({id:"JSqPHE"}),fields:{category:{}},onFormSuccess:s.refreshTable}),x=D({parts:s.selectedRecords}),C=r.useCallback(j=>{const T=n.hasChangePermission(h.part);return[N({hidden:!T,onClick:()=>{p(j.pk),f.open()}})]},[n,f]),P=r.useMemo(()=>[l.jsx(q,{tooltip:e._({id:"loB51L"}),icon:l.jsx(v,{icon:"part"}),disabled:!s.hasSelectedRecords,actions:[{name:e._({id:"JSqPHE"}),icon:l.jsx(v,{icon:"category"}),tooltip:e._({id:"AVPs2p"}),hidden:!n.hasChangeRole(y.part),disabled:!s.hasSelectedRecords,onClick:()=>{g.open()}},{name:e._({id:"3u5ICq"}),icon:l.jsx(A,{color:"blue"}),tooltip:e._({id:"RBzQBd"}),hidden:!n.hasAddRole(y.purchase_order),onClick:()=>{x.openWizard()}}]}),l.jsx(F,{hidden:!n.hasAddRole(y.part),tooltip:e._({id:"rGfVOS"}),onClick:()=>i.open()},"add-part")],[n,s.hasSelectedRecords]);return l.jsxs(l.Fragment,{children:[i.modal,f.modal,g.modal,x.wizard,l.jsx(B,{url:S(b.part_list),tableState:s,columns:a,props:{...t,enableDownload:!0,modelType:h.part,tableFilters:d,tableActions:P,rowActions:C,enableSelection:!0,enableReports:!0,enableLabels:!0,params:{...t.params,category_detail:!0,location_detail:!0}}})]})}export{ce as P,de as a,k as b,ne as p,re as u};
//# sourceMappingURL=PartTable-C1JYwZRz.js.map
