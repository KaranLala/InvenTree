import{r as l,i as s,j as m,b4 as Y}from"./vendor-c9tu_e1b.js";import{A as N}from"./ActionButton-Cn3lAMG1.js";import{u as P,L as V,n as J,R as K,a as z,I as G}from"./InvenTreeTable-_nPJoCLK.js";import{b as H,m as A,A as u,U as Q,e as Z}from"./index-C-YqHYR0.js";import{f as O}from"./formatters-1-K9MQML.js";import{a as T}from"./SalesOrderForms-DpTkhoXL.js";import{u as W,a as $,c as I}from"./UseForm-21BEg7Md.js";import{a as ee}from"./UseStockAdjustActions-PDcplZpx.js";import{R as te,D as g,S as se,P as ie,j as ae}from"./ColumnRenderers-6-W27ey5.js";function _e({partId:o,stockId:j,orderId:r,lineItemId:M,shipmentId:S,showPartInfo:n,showOrderInfo:d,allowEdit:p,isSubTable:i,modelTarget:v,modelField:x}){const _=H(),w=l.useMemo(()=>{let e="salesorderallocations";return o&&(e+="-part"),i&&(e+="-sub"),e},[o,i]),a=P(w),D=l.useMemo(()=>{const e=[{name:"outstanding",label:s._({id:"aimnwe"}),description:s._({id:"ILsgZ4"})},{name:"assigned_to_shipment",label:s._({id:"uvBviC"}),description:s._({id:"U6KGSj"})},V()];return o&&e.push(J()),e},[o]),L=l.useMemo(()=>[te({accessor:"order_detail.reference",title:s._({id:"LozYBo"}),switchable:!1,sortable:!0,hidden:d!=!0}),g({accessor:"order_detail.description",hidden:d!=!0}),se({accessor:"order_detail.status",model:A.salesorder,title:s._({id:"acIJ41"}),hidden:d!=!0}),{accessor:"part",hidden:n!=!0,title:s._({id:"vgP+9p"}),sortable:!0,switchable:!1,render:e=>ie({part:e.part_detail})},g({accessor:"part_detail.description",hidden:n!=!0}),{accessor:"part_detail.IPN",title:s._({id:"3wXEsN"}),hidden:n!=!0,sortable:!0,ordering:"IPN"},{accessor:"serial",title:s._({id:"AXeJt4"}),sortable:!0,switchable:!0,render:e=>{var t;return(t=e==null?void 0:e.item_detail)==null?void 0:t.serial}},{accessor:"batch",title:s._({id:"Vea6Aj"}),sortable:!0,switchable:!0,render:e=>{var t;return(t=e==null?void 0:e.item_detail)==null?void 0:t.batch}},{accessor:"available",title:s._({id:"I8CEek"}),sortable:!1,hidden:i,render:e=>{var t;return(t=e==null?void 0:e.item_detail)==null?void 0:t.quantity}},{accessor:"quantity",title:s._({id:"Tk6w1l"}),sortable:!0},ae({accessor:"location_detail",switchable:!0,sortable:!0}),{accessor:"shipment_detail.reference",title:s._({id:"4fws5M"}),switchable:!0,sortable:!1,render:e=>{var t;return((t=e.shipment_detail)==null?void 0:t.reference)??s._({id:"Xmnh8X"})}},{accessor:"shipment_date",title:s._({id:"MFQxyA"}),switchable:!0,sortable:!0,render:e=>{var t;return(t=e.shipment_detail)!=null&&t.shipment_date?O(e.shipment_detail.shipment_date):e.shipment?s._({id:"BVdqnq"}):s._({id:"Xmnh8X"})}}],[d,n,i]),[b,k]=l.useState(0),[q,y]=l.useState(null),E=T({orderId:r,shipment:q}),F=W({url:u.sales_order_allocation_list,pk:b,fields:E,title:s._({id:"+2kti8"}),onFormSuccess:()=>a.refreshTable()}),C=$({url:u.sales_order_allocation_list,pk:b,title:s._({id:"m9p8qY"}),onFormSuccess:()=>a.refreshTable()}),X=l.useCallback(e=>{var c;return!!((c=e.shipment_detail)!=null&&c.shipment_date)||!p?[]:[K({tooltip:s._({id:"+2kti8"}),onClick:()=>{k(e.pk),y(e.shipment),F.open()}}),z({tooltip:s._({id:"m9p8qY"}),onClick:()=>{k(e.pk),C.open()}})]},[p,_]),B=l.useMemo(()=>({items:a.selectedRecords.filter(t=>!!t.item_detail).map(t=>({...t.item_detail,part_detail:t.part_detail,location_detail:t.location_detail})),model:A.stockitem,refresh:a.refreshTable}),[a.selectedRecords,a.refreshTable]),h=ee({formProps:B,merge:!1,assign:!1,delete:!1,add:!1,count:!1,remove:!1}),f=l.useMemo(()=>{var e;return(((e=a.selectedRecords)==null?void 0:e.filter(t=>{var c;return!((c=t.shipment_detail)!=null&&c.shipment_date)}))??[]).map(t=>t.pk)},[a.selectedRecords]),R=I({url:u.sales_order_allocation_list,items:f,title:s._({id:"jLpOuT"}),fields:{shipment:{filters:{order:r,shipped:!1}}},onFormSuccess:a.refreshTable}),U=l.useMemo(()=>[h.dropdown,m.jsx(N,{tooltip:s._({id:"7m2EYK"}),icon:m.jsx(Y,{}),onClick:()=>{R.open()},disabled:f.length==0,hidden:!r||!p||!_.hasChangeRole(Q.sales_order)})],[p,f,r,_,h.dropdown]);return m.jsxs(m.Fragment,{children:[R.modal,F.modal,C.modal,!i&&h.modals.map(e=>e.modal),m.jsx(G,{url:Z(u.sales_order_allocation_list),tableState:a,columns:L,props:{params:{part_detail:n??!1,order_detail:d??!1,item_detail:!0,location_detail:!0,line:M,part:o,order:r,shipment:S,item:j},enableSearch:!i,enableRefresh:!i,enableColumnSwitching:!i,enableFilters:!i,enableDownload:!i,enableSelection:!i,minHeight:i?100:void 0,rowActions:X,tableActions:i?void 0:U,tableFilters:D,modelField:x??"order",enableReports:!i,enableLabels:!i,printingAccessor:"item",modelType:v??A.salesorder}})]})}export{_e as S};
//# sourceMappingURL=SalesOrderAllocationTable-vwtoQvXI.js.map
