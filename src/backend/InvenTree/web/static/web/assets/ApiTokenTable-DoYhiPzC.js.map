{"version":3,"file":"ApiTokenTable-DoYhiPzC.js","sources":["../../../../../../frontend/src/tables/settings/ApiTokenTable.tsx"],"sourcesContent":["import { AddItemButton } from '@lib/components/AddItemButton';\nimport type { RowAction } from '@lib/components/RowActions';\nimport { ApiEndpoints } from '@lib/enums/ApiEndpoints';\nimport { apiUrl } from '@lib/functions/Api';\nimport type { TableFilter } from '@lib/types/Filters';\nimport { t } from '@lingui/core/macro';\nimport { Trans } from '@lingui/react/macro';\nimport { Badge, Code, Flex, Modal, Paper, Text } from '@mantine/core';\nimport { useDisclosure } from '@mantine/hooks';\nimport { IconCircleX } from '@tabler/icons-react';\nimport { useCallback, useMemo, useState } from 'react';\nimport { api } from '../../App';\nimport { CopyButton } from '../../components/buttons/CopyButton';\nimport { StylishText } from '../../components/items/StylishText';\nimport { RenderUser } from '../../components/render/User';\nimport { showApiErrorMessage } from '../../functions/notifications';\nimport { useCreateApiFormModal } from '../../hooks/UseForm';\nimport { useTable } from '../../hooks/UseTable';\nimport { BooleanColumn } from '../ColumnRenderers';\nimport { UserFilter } from '../Filter';\nimport { InvenTreeTable } from '../InvenTreeTable';\n\nexport function ApiTokenTable({\n  only_myself = true\n}: Readonly<{ only_myself: boolean }>) {\n  const [token, setToken] = useState<string>('');\n  const [opened, { open, close }] = useDisclosure(false);\n\n  const generateToken = useCreateApiFormModal({\n    url: ApiEndpoints.user_tokens,\n    title: t`Generate Token`,\n    fields: { name: {} },\n    successMessage: t`Token generated`,\n    onFormSuccess: (data: any) => {\n      setToken(data.token);\n      open();\n      table.refreshTable();\n    }\n  });\n  const tableActions = useMemo(() => {\n    if (only_myself)\n      return [\n        <AddItemButton\n          key={'generate'}\n          tooltip={t`Generate Token`}\n          onClick={() => generateToken.open()}\n        />\n      ];\n    return [];\n  }, [only_myself]);\n\n  const table = useTable('api-tokens', 'id');\n\n  const tableColumns = useMemo(() => {\n    const cols = [\n      {\n        accessor: 'name',\n        title: t`Name`,\n        sortable: true\n      },\n      BooleanColumn({\n        accessor: 'active',\n        title: t`Active`,\n        sortable: false\n      }),\n      BooleanColumn({\n        accessor: 'revoked',\n        title: t`Revoked`\n      }),\n      {\n        accessor: 'token',\n        title: t`Token`,\n        render: (record: any) => {\n          return (\n            <>\n              {record.token}{' '}\n              {record.in_use ? (\n                <Badge color='green'>\n                  <Trans>In Use</Trans>\n                </Badge>\n              ) : null}\n            </>\n          );\n        }\n      },\n      {\n        accessor: 'last_seen',\n        title: t`Last Seen`,\n        sortable: true\n      },\n      {\n        accessor: 'expiry',\n        title: t`Expiry`,\n        sortable: true\n      },\n      {\n        accessor: 'created',\n        title: t`Created`,\n        sortable: true\n      }\n    ];\n    if (!only_myself) {\n      cols.push({\n        accessor: 'user',\n        title: t`User`,\n        sortable: true,\n        render: (record: any) => {\n          if (record.user_detail) {\n            return <RenderUser instance={record.user_detail} />;\n          } else {\n            return record.user;\n          }\n        }\n      });\n    }\n    return cols;\n  }, [only_myself]);\n\n  const tableFilters: TableFilter[] = useMemo(() => {\n    const filters: TableFilter[] = [\n      {\n        name: 'revoked',\n        label: t`Revoked`,\n        description: t`Show revoked tokens`\n      }\n    ];\n\n    if (!only_myself) {\n      filters.push(\n        UserFilter({\n          name: 'user',\n          label: t`User`,\n          description: t`Filter by user`\n        })\n      );\n    }\n    return filters;\n  }, [only_myself]);\n\n  const rowActions = useCallback((record: any): RowAction[] => {\n    return [\n      {\n        title: t`Revoke`,\n        color: 'red',\n        hidden: !record.active || record.in_use,\n        icon: <IconCircleX />,\n        onClick: () => {\n          revokeToken(record.id);\n        }\n      }\n    ];\n  }, []);\n\n  const revokeToken = async (id: string) => {\n    let targetUrl = apiUrl(ApiEndpoints.user_tokens, id);\n    if (!only_myself) {\n      targetUrl += '?all_users=true';\n    }\n    api\n      .delete(targetUrl)\n      .then(() => {\n        table.refreshTable();\n      })\n      .catch((error) => {\n        showApiErrorMessage({\n          error: error,\n          title: t`Error revoking token`\n        });\n      });\n  };\n\n  const urlParams = useMemo(() => {\n    if (only_myself) return {};\n    return { all_users: true };\n  }, [only_myself]);\n\n  return (\n    <>\n      {only_myself && (\n        <>\n          {generateToken.modal}\n          <Modal\n            opened={opened}\n            onClose={close}\n            title={<StylishText size='xl'>{t`Token`}</StylishText>}\n            centered\n          >\n            <Text c='dimmed'>\n              <Trans>\n                Tokens are only shown once - make sure to note it down.\n              </Trans>\n            </Text>\n            <Paper p='sm'>\n              <Flex>\n                <Code>{token}</Code>\n                <CopyButton value={token} />\n              </Flex>\n            </Paper>\n          </Modal>\n        </>\n      )}\n      <InvenTreeTable\n        tableState={table}\n        url={apiUrl(ApiEndpoints.user_tokens)}\n        columns={tableColumns}\n        props={{\n          params: urlParams,\n          rowActions: rowActions,\n          enableSearch: false,\n          enableColumnSwitching: false,\n          tableActions: tableActions,\n          tableFilters: tableFilters\n        }}\n      />\n    </>\n  );\n}\n"],"names":["ApiTokenTable","only_myself","token","setToken","useState","opened","open","close","useDisclosure","generateToken","useCreateApiFormModal","url","ApiEndpoints","user_tokens","title","_i18n","_","id","fields","name","successMessage","onFormSuccess","data","table","refreshTable","tableActions","useMemo","jsx","AddItemButton","useTable","tableColumns","cols","accessor","sortable","BooleanColumn","render","record","in_use","Badge","_Trans","push","user_detail","RenderUser","user","tableFilters","filters","label","description","UserFilter","rowActions","useCallback","color","hidden","active","icon","IconCircleX","onClick","revokeToken","targetUrl","apiUrl","api","delete","then","catch","error","showApiErrorMessage","urlParams","all_users","modal","jsxs","Modal","StylishText","Text","Paper","Flex","Code","CopyButton","InvenTreeTable","params","enableSearch","enableColumnSwitching"],"mappings":"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"}
