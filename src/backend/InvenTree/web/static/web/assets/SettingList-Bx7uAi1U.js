import{j as l,G as h,S as M,B as t,c7 as L,i as f,cv as G,Y as q,r as c,H as k,by as P,bR as F,cQ as V,n as b,bU as B,d as N,cx as D,cO as H,A as K,f2 as T}from"./vendor-c9tu_e1b.js";import{b as W,v as R,m as J,M as O,a as Q,e as C,f as X,o as Y,J as z,A,K as Z}from"./index-C-YqHYR0.js";import{a as g,S as ee,k as le}from"./ThemeContext-CVPHi9Q7.js";import{u as re}from"./DesktopAppView-Bg1vO8uy.js";import{R as ae,u as se}from"./UseForm-21BEg7Md.js";function fe({label:e,title:s,shorthand:a,subtitle:i}){const d=W(),u=g();return l.jsxs(h,{justify:"space-between",children:[l.jsxs(M,{gap:"0",ml:"sm",children:[l.jsxs(h,{children:[l.jsx(ee,{size:"xl",children:s}),a&&l.jsxs(t,{c:"dimmed",children:["(",a,")"]})]}),l.jsx(h,{children:i?l.jsx(t,{c:"dimmed",children:i}):null})]}),d.isStaff()&&l.jsx(L,{data:[{value:"user",label:f._({id:"ekfzWq"})},{value:"system",label:f._({id:"zNkWa6"})},{value:"admin",label:f._({id:"uTLn08"})}],onChange:r=>u(`/settings/${r}`),value:e})]})}function ie({setting:e,onEdit:s,onToggle:a}){const i=c.useMemo(()=>{var p;let n=e.value;if(e!=null&&e.choices&&((p=e==null?void 0:e.choices)==null?void 0:p.length)>0){const x=e.choices.find(S=>S.value==e.value);n=(x==null?void 0:x.display_name)||e.value}return e!=null&&e.units&&(n=`${n} ${e.units}`),n},[e]),[d,u]=c.useState(null),r=c.useCallback(()=>{e.read_only||s(e)},[e,s]),_=c.useCallback(n=>{e.read_only||a(e,n.currentTarget.checked)},[e,a]),m=c.useMemo(()=>{if(e.model_name){const n=e.model_name.split(".")[1];return J[n]||null}return null},[e]);if(c.useEffect(()=>{if(u(null),m&&e.value){const n=O[m].api_endpoint;Q.get(C(n,e.value)).then(p=>{p.data?u(p.data):u(null)}).catch(p=>{u(null)})}},[e,m]),d&&m&&e.value)return l.jsxs(h,{justify:"right",gap:"xs",children:[l.jsx(ae,{instance:d,model:m}),l.jsx(k,{"aria-label":`edit-setting-${e.key}`,variant:"subtle",disabled:e.read_only,onClick:r,children:l.jsx(P,{})})]});switch((e==null?void 0:e.type)||"string"){case"boolean":return l.jsx(V,{size:"sm",radius:"lg","aria-label":`toggle-setting-${e.key}`,disabled:e.read_only,checked:e.value.toString().toLowerCase()=="true",onChange:_,wrapperProps:{"aria-label":`setting-${e.key}-wrapper`},style:{paddingRight:"20px"}});default:return i?l.jsxs(h,{gap:"xs",justify:"right",children:[l.jsx(F,{}),l.jsx(k,{"aria-label":`edit-setting-${e.key}`,variant:"subtle",disabled:e.read_only,onClick:r,children:i})]}):l.jsx(k,{"aria-label":`edit-setting-${e.key}`,variant:"subtle",disabled:e.read_only,onClick:r,children:l.jsx(P,{})})}}function ce({setting:e,shaded:s,onEdit:a,onToggle:i}){const{colorScheme:d}=G(),u={paddingLeft:"8px"};return s&&(u.backgroundColor=d==="light"?R.colors.gray[1]:R.colors.gray[9]),l.jsx(q,{style:u,children:l.jsxs(h,{justify:"space-between",p:"3",children:[l.jsxs(M,{gap:"2",p:"4px",children:[l.jsxs(t,{children:[e.name,e.required?" *":""]}),l.jsx(t,{size:"xs",children:e.description})]}),l.jsx(le,{label:`setting-value-${e.key}`,children:l.jsx(ie,{setting:e,onEdit:a,onToggle:i})})]})})}function v({settingsState:e,keys:s,onChange:a,onLoaded:i}){var U,w,E;c.useEffect(()=>{e.loaded&&(i==null||i(e))},[e.loaded,e.settings]);const d=re(),u=c.useMemo(()=>{var o;return((o=e==null?void 0:e.settings)==null?void 0:o.map(j=>j.key))??[]},[e==null?void 0:e.settings]),[r,_]=c.useState(void 0),m=c.useMemo(()=>{var o;return(o=r==null?void 0:r.choices)!=null&&o.length?"choice":(r==null?void 0:r.type)!=null?r.type:"string"},[r]),n=c.useMemo(()=>(r==null?void 0:r.key)??"",[r]),p=se({url:e.endpoint,pk:n,pathParams:e.pathParams,title:f._({id:"mjN1LS"}),fields:{value:{field_type:m,required:(r==null?void 0:r.required)??!1,label:r==null?void 0:r.name,description:r==null?void 0:r.description,api_url:(r==null?void 0:r.api_url)??"",model:((U=r==null?void 0:r.model_name)==null?void 0:U.split(".")[1])??null,filters:(r==null?void 0:r.model_filters)||void 0,choices:(r==null?void 0:r.choices)??void 0}},successMessage:f._({id:"1onc6y",values:{key:n}}),onFormSuccess:()=>{e.fetchSettings(),a==null||a()}}),x=c.useCallback(o=>{_(o),p.open()},[p]),S=c.useCallback((o,j)=>{d.patch(C(e.endpoint,o.key,e.pathParams),{value:j}).then(()=>{b.hide("setting"),b.show({title:f._({id:"C3htzi"}),message:f._({id:"n/n6vh",values:{0:o.key}}),color:"green",id:"setting"}),a==null||a()}).catch(y=>{b.hide("setting"),b.show({title:f._({id:"CsUgn+"}),message:y.message,color:"red",id:"setting"})}).finally(()=>{e.fetchSettings()})},[e]);return e.isError?l.jsx(B,{color:"red",icon:l.jsx(N,{}),title:f._({id:"SlfejT"}),children:l.jsx(t,{children:f._({id:"wXadfA"})})}):e!=null&&e.loaded?l.jsxs(l.Fragment,{children:[p.modal,l.jsxs(M,{gap:"xs",children:[(w=s||u)==null?void 0:w.map((o,j)=>{var $;const y=($=e==null?void 0:e.settings)==null?void 0:$.find(I=>I.key===o);return e!=null&&e.settings&&!y&&console.error(`Setting ${o} not found`),l.jsx(H.Fragment,{children:y?l.jsx(ce,{setting:y,shaded:j%2===0,onEdit:x,onToggle:S}):l.jsxs(t,{size:"sm",style:{fontStyle:"italic"},c:"red",children:["Setting ",o," not found"]})},o)}),((E=s||u)==null?void 0:E.length)===0&&l.jsx(t,{style:{fontStyle:"italic"},children:l.jsx(K,{id:"3CUVvD"})})]})]}):l.jsx(D,{animate:!0})}function me({keys:e}){const s=Y();return l.jsx(v,{settingsState:s,keys:e})}function te({keys:e}){const s=X();return l.jsx(v,{settingsState:s,keys:e})}function he({pluginKey:e,onLoaded:s}){const a=c.useRef(z({plugin:e,endpoint:A.plugin_setting_list})).current,i=T(a);return l.jsx(v,{settingsState:i,onLoaded:s})}function xe({pluginKey:e,onLoaded:s}){const a=c.useRef(z({plugin:e,endpoint:A.plugin_user_setting_list})).current,i=T(a);return l.jsx(v,{settingsState:i,onLoaded:s})}function je({machinePk:e,configType:s,onChange:a}){const i=c.useRef(Z({machine:e,configType:s})).current,d=T(i);return l.jsx(v,{settingsState:d,onChange:a})}export{te as G,je as M,he as P,fe as S,me as U,xe as a};
//# sourceMappingURL=SettingList-Bx7uAi1U.js.map
