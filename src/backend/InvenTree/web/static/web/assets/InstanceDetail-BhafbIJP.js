import{j as i,Y as L,S as V,bQ as x,r as h,G as j,B as l,bO as A,cx as v,D as b,i as c,bS as y,dc as w,dH as P,cD as Y,C as $,z as G,L as M}from"./vendor-c9tu_e1b.js";import{r as U,P as H}from"./index-D1sX3jYA.js";import{Y as W}from"./YesNoButton-BdKeJbQO.js";import{h as _,n as K,f as R,m as F,A as g,e as I,b as O}from"./index-C-YqHYR0.js";import{u as E}from"./DesktopAppView-Bg1vO8uy.js";import{f as Q}from"./formatters-1-K9MQML.js";import{S as X,I as k,C as q,a as J}from"./ThemeContext-CVPHi9Q7.js";import{g as Z}from"./ModelType-CepomS9H.js";import{g as p,h as ee}from"./UseForm-21BEg7Md.js";import{E as T}from"./GenericErrorPage-RCGZWWhe.js";import ie from"./NotFound-Cglkc0xC.js";import{P as S}from"./PermissionDenied-D4im8ofc.js";function re(e,t){function n(s){switch(t){case"owner":return[`${s.label}: ${s.name}`,s.name,_(s.owner_model,s.pk,!0),void 0,void 0];case"user":return[`${s.first_name} ${s.last_name}`,s.username,_(F.user,s.pk,!0),s==null?void 0:s.image,i.jsxs(i.Fragment,{children:[s.is_superuser&&i.jsx(y,{color:"red",children:c._({id:"agYOFs"})}),s.is_staff&&i.jsx(y,{color:"blue",children:c._({id:"uXsB4R"})}),s.email&&c._({id:"3WlEIN"})+s.email]})];case"group":return[s.name,s.name,_(F.group,s.pk,!0),s==null?void 0:s.image,void 0];default:return"dd"}}const r=n(e);return i.jsxs(w.Dropdown,{children:[i.jsxs(j,{children:[i.jsx(P,{src:r[3],radius:"xl"}),i.jsxs(V,{gap:5,children:[i.jsx(l,{size:"sm",fw:700,style:{lineHeight:1},children:r[0]}),i.jsx(b,{href:r[2],c:"dimmed",size:"xs",style:{lineHeight:1},children:r[1]})]})]}),i.jsx(l,{size:"sm",mt:"md",children:r[4]})]})}function C({pk:e,type:t}){const n=E(),{data:r}=A({queryKey:["badge",t,e],queryFn:async()=>{let a="";switch(t){case"owner":a=g.owner_list;break;case"user":a=g.user_list;break;case"group":a=g.group_list;break;default:return{}}const u=I(a,e);return n.get(u).then(o=>{switch(o.status){case 200:return o.data;default:return{}}})}}),s=R(),d=h.useMemo(()=>r?re(r,t):i.jsx(v,{height:12,radius:"md"}),[r]);if(!r||r.isLoading||r.isFetching)return i.jsx(v,{height:12,radius:"md"});function m(){return!r||!r.pk?"":t==="user"&&s.isSet("DISPLAY_FULL_NAMES")?r.first_name||r.last_name?`${r.first_name} ${r.last_name}`:r.username:t==="user"?r.username:r.name}return i.jsxs(j,{wrap:"nowrap",gap:"sm",justify:"right",children:[i.jsx(y,{color:"dark",variant:"filled",style:{display:"flex",alignItems:"center"},children:i.jsxs(w,{width:320,shadow:"md",withArrow:!0,openDelay:200,closeDelay:400,children:[i.jsx(w.Target,{children:i.jsx("p",{children:(r==null?void 0:r.name)??m()})}),d]})}),i.jsx(k,{icon:t==="user"?t:r.label})]})}function se(e){var t;return i.jsx(l,{size:"sm",children:Q((t=e.field_value)==null?void 0:t.toString())})}function te(e){var r,s;const t=e==null?void 0:e.field_value,n=Number.parseFloat(t.toString());return t==null?i.jsx(l,{size:"sm",children:"'---'"}):i.jsxs(j,{wrap:"nowrap",gap:"xs",justify:"left",children:[i.jsx(l,{size:"sm",children:p(n)}),!!((r=e.field_data)!=null&&r.unit)&&i.jsxs(l,{size:"xs",children:["[",(s=e.field_data)==null?void 0:s.unit,"]"]})]})}function ne(e){var r,s,d;const t=e==null?void 0:e.field_value;let n=null;return(r=e.field_data)!=null&&r.badge?i.jsx(C,{pk:t,type:e.field_data.badge}):((s=e==null?void 0:e.field_data)!=null&&s.value_formatter?n=e.field_data.value_formatter():t==null?n=i.jsx(l,{size:"sm",children:"'---'"}):n=i.jsx(l,{size:"sm",children:t.toString()}),i.jsxs(j,{wrap:"nowrap",gap:"xs",justify:"space-apart",children:[i.jsxs(j,{wrap:"nowrap",gap:"xs",justify:"left",children:[n,e.field_data.unit&&i.jsx(l,{size:"xs",children:e.unit})]}),e.field_data.user&&i.jsx(C,{pk:(d=e.field_data)==null?void 0:d.user,type:"user"})]}))}function ae(e){return i.jsx(W,{value:e.field_value})}function le(e){var o,z;const t=E(),n=J(),{data:r}=A({queryKey:["detail",e.field_data.model,e.field_value],queryFn:async()=>{var B;if(!((B=e.field_data)!=null&&B.model))return{};const f=Z(e.field_data.model);if(!(f!=null&&f.api_endpoint))return{};const N=I(f.api_endpoint,e.field_value);return t.get(N,{params:e.field_data.model_filters??void 0}).then(D=>{switch(D.status){case 200:return D.data;default:return{}}})}}),s=h.useMemo(()=>{var f;return((f=e==null?void 0:e.field_data)==null?void 0:f.model)&&_(e.field_data.model,e.field_value)},[e.field_data.model,e.field_value]),d=h.useCallback(f=>{K(s,n,f)},[s]);if(!r||r.isLoading||r.isFetching)return i.jsx(v,{height:12,radius:"md"});if(e.field_data.external)return i.jsx(b,{href:`${e.field_value}`,target:"_blank",rel:"noreferrer noopener",children:i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"3px"},children:[i.jsx(l,{children:e.field_value}),i.jsx(k,{icon:"external",iconProps:{size:15}})]})});let m=((o=e.field_data)==null?void 0:o.link)??!0,a;e.field_data.model_formatter?a=e.field_data.model_formatter(r)??a:e.field_data.model_field?a=(r==null?void 0:r[e.field_data.model_field])??a:a=r==null?void 0:r.name;let u;return a===void 0&&(a=(r==null?void 0:r.name)??((z=e.field_data)==null?void 0:z.backup_value)??c._({id:"ATGKLv"}),m=!1,u="red"),i.jsx(i.Fragment,{children:m?i.jsx(b,{href:"#",onClick:d,children:i.jsx(l,{children:a})}):i.jsx(l,{c:u,children:a})})}function ue(e){return e.field_data.total<=0?i.jsx(l,{size:"sm",children:e.field_data.progress}):i.jsx(H,{size:"lg",value:e.field_data.progress,maximum:e.field_data.total,progressLabel:!0})}function de(e){return i.jsx(ee,{type:e.field_data.model,status:e.field_value})}function ce({value:e}){return i.jsx(q,{value:e})}function oe({item:e,field:t}){function n(d){switch(d){case"boolean":return ae;case"link":return le;case"progressbar":return ue;case"status":return de;case"date":return se;case"number":return te;case"text":case"string":default:return ne}}const r=n(t.type),s=h.useMemo(()=>U(e,t.name),[e,t.name]);return i.jsxs(x.Tr,{style:{verticalAlign:"top"},children:[i.jsx(x.Td,{style:{minWidth:75,lineBreak:"auto",flex:2},children:i.jsxs(j,{gap:"xs",wrap:"nowrap",children:[i.jsx(k,{icon:t.icon??t.name}),i.jsx(l,{style:{paddingLeft:10},children:t.label})]})}),i.jsx(x.Td,{style:{lineBreak:"anywhere",minWidth:100,flex:10,display:"inline-block"},children:i.jsx(r,{field_data:t,field_value:s})}),i.jsx(x.Td,{style:{width:"50"},children:t.copy&&i.jsx(ce,{value:s})})]})}function Be({item:e,fields:t,title:n}){return i.jsx(L,{p:"xs",withBorder:!0,style:{overflowX:"hidden",width:"100%",minWidth:200},children:i.jsxs(V,{gap:"xs",children:[n&&i.jsx(X,{size:"lg",children:n}),i.jsx(x,{striped:!0,verticalSpacing:5,horizontalSpacing:"sm",children:i.jsx(x.Tbody,{children:t.filter(r=>!r.hidden).map((r,s)=>i.jsx(oe,{field:r,item:e},s))})})]})})}function De(e){return i.jsx(L,{p:"xs",children:i.jsx(Y,{cols:{base:1,"900px":2},type:"container",spacing:"xs",verticalSpacing:"xs",children:e.children})})}function fe(){return i.jsx(T,{title:c._({id:"vYV5VB"}),message:c._({id:"5a3xiK"})})}function me({status:e}){switch(e){case 401:return i.jsx(fe,{});case 403:return i.jsx(S,{});case 404:return i.jsx(ie,{})}return i.jsx(T,{title:c._({id:"AOPUbq"}),message:c._({id:"yuzYd9"}),status:e})}function xe({status:e}){return i.jsx(T,{title:c._({id:"iSWuCp"}),message:c._({id:"vB3crB"}),status:e})}function Fe({query:e,children:t,requiredRole:n,requiredPermission:r}){var a;const s=O(),[d,m]=h.useState(!1);if(h.useEffect(()=>{e.isSuccess&&m(!0)},[e.isSuccess]),e.isError){const u=e.failureReason,o=((a=u==null?void 0:u.response)==null?void 0:a.status)??(u==null?void 0:u.status)??0;return o>=500?i.jsx(xe,{status:o}):i.jsx(me,{status:o})}return n&&!s.hasViewRole(n)?i.jsx(S,{}):r&&!s.hasViewPermission(r)?i.jsx(S,{}):!d||!s.isLoggedIn()?i.jsx($,{children:i.jsx(G,{children:i.jsx(M,{})})}):i.jsx(i.Fragment,{children:t})}export{Be as D,De as I,Fe as a};
//# sourceMappingURL=InstanceDetail-BhafbIJP.js.map
