import{r as l,i as t,j as e,bc as z,eN as D,b_ as B,h as P,s as U,K as F,G as m,bH as V,A as u,cJ as H,B as M,bK as N,eO as Q,bR as G,dz as g,Y as I,S as k,bP as _,bU as q}from"./vendor-c9tu_e1b.js";import{b as L,M as v,a as w,e as E,E as R,A as O,F as Z}from"./index-C-YqHYR0.js";import{R as J,d as C}from"./UseForm-21BEg7Md.js";import{a as K,S as f,v as Y}from"./ThemeContext-CVPHi9Q7.js";import{P as W}from"./PageTitle-BiZTQEW1.js";import{A as X}from"./ActionButton-Cn3lAMG1.js";import{u as $,G as ee,I as se}from"./InvenTreeTable-_nPJoCLK.js";import"./DesktopAppView-Bg1vO8uy.js";import"./index-D1sX3jYA.js";import"./QRCode-4MaRh6JQ.js";import"./browser-oJrDmCBJ.js";function te({records:o,onItemsSelected:r,onItemsDeleted:p}){const x=K(),d=L(),c=$("barcode-scan-results","id"),h=l.useMemo(()=>[{accessor:"instance",title:t._({id:"HX5SVx"}),sortable:!1,switchable:!1,render:i=>i.instance?e.jsx(J,{model:i.model,instance:i.instance}):"-"},{accessor:"model",title:t._({id:"scu3wk"}),sortable:!1},{accessor:"barcode",title:t._({id:"ap+FLU"}),sortable:!1},{accessor:"timestamp",title:t._({id:"8TMaZI"}),sortable:!1,render:i=>{var s;return(s=i.timestamp)==null?void 0:s.toLocaleString()}}],[]),b=l.useCallback(i=>{var a;const s=[];return i.model&&i.pk&&i.instance&&s.push(ee({title:t._({id:"Go4fl6"}),modelId:(a=i.instance)==null?void 0:a.pk,modelType:i.model,navigate:x,hidden:!d.hasViewPermission(i.model)})),s},[]),j=l.useMemo(()=>[e.jsx(X,{disabled:!c.hasSelectedRecords,icon:e.jsx(z,{}),color:"red",tooltip:t._({id:"QZQ+5V"}),onClick:()=>{p(c.selectedIds),c.clearSelectedRecords()}})],[c.hasSelectedRecords,c.selectedIds]);return l.useEffect(()=>{r(c.selectedIds)},[c.selectedIds]),e.jsx(e.Fragment,{children:e.jsx(se,{tableState:c,tableData:o,columns:h,props:{enableFilters:!1,enableSelection:!0,enablePagination:!1,enableSearch:!1,enableRefresh:!1,rowActions:b,tableActions:j}})})}function xe(){const[o,r]=D([]),[p,x]=B({key:"scan-history",defaultValue:[]}),[d,c]=l.useState([]),h=l.useCallback(s=>{if(!s.model||!s.pk)return;if(o.find(n=>n.model==s.model&&n.pk==s.pk)){P("duplicate-barcode"),U({id:"duplicate-barcode",title:t._({id:"euc6Ns"}),message:t._({id:"6IETQS"}),color:"orange"});return}const a=v[s.model];w.get(E(a.api_endpoint,s.pk)).then(n=>{s.instance=n.data,r.append(s)}).catch(n=>{R({error:n,title:t._({id:"DFEq8c"}),message:t._({id:"beMwe+"})})})},[w,o]),b=l.useCallback(s=>{w.post(E(O.barcode),{barcode:s}).then(a=>{var T,A;const n=(a==null?void 0:a.data)??{};let y=!1;for(const S of Object.keys(v))(T=n[S])!=null&&T.pk&&(y=!0,h({id:F(),barcode:s,data:n,timestamp:C().toDate(),source:"scan",model:S,pk:(A=n[S])==null?void 0:A.pk}));y||r.append({id:F(),barcode:s,data:n,timestamp:C().toDate(),source:"scan"})}).catch(a=>{R({error:a,message:t._({id:"I3WmwV"}),title:t._({id:"72IS8c"}),field:"error"})})},[h]);l.useEffect(()=>{o.length!==0&&x(o)},[o]),l.useEffect(()=>{r.setState(p)},[p]);const j=l.useMemo(()=>o.filter(s=>d.includes(s.id)),[d,o]),i=l.useMemo(()=>{const s=new Set(j.map(a=>a.model));return s.size===0?e.jsxs(m,{gap:0,children:[e.jsx(V,{color:"orange"}),e.jsx(u,{id:"dQStih"})]}):s.size>1?e.jsxs(m,{gap:0,children:[e.jsx(H,{color:"orange"}),e.jsx(u,{id:"Oik3bo"})]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{fz:"sm",c:"dimmed",children:e.jsx(u,{id:"9dx+P4"})}),e.jsx(m,{children:e.jsx(N,{onClick:Z,title:t._({id:"wBMjJ2"}),variant:"default",children:e.jsx(Q,{})})})]})},[j]);return e.jsxs(e.Fragment,{children:[e.jsx(W,{title:t._({id:"kSFUZe"})}),e.jsx(m,{justify:"space-between",children:e.jsx(m,{justify:"left",children:e.jsx(f,{size:"xl",children:e.jsx(u,{id:"kSFUZe"})})})}),e.jsx(G,{h:"md"}),e.jsxs(g,{maw:"100%",children:[e.jsxs(g.Col,{span:4,children:[e.jsx(I,{p:"sm",shadow:"xs",children:e.jsxs(k,{gap:"xs",children:[e.jsx(f,{size:"lg",children:t._({id:"n5kv5D"})}),e.jsx(_,{}),e.jsx(Y,{onScan:b})]})}),e.jsx(I,{p:"sm",shadow:"xs",children:e.jsxs(k,{gap:"xs",children:[e.jsx(f,{size:"lg",children:t._({id:"bwRvnp"})}),e.jsx(_,{}),d.length===0?e.jsx(q,{title:t._({id:"65vtJ8"}),color:"blue",children:e.jsx(u,{id:"mB/UHi"})}):e.jsxs(e.Fragment,{children:[e.jsx(M,{children:e.jsx(u,{id:"sQhVFe",values:{0:d.length}})}),i]})]})})]}),e.jsx(g.Col,{span:8,children:e.jsx(I,{p:"sm",shadow:"xs",children:e.jsxs(k,{gap:"xs",children:[e.jsx(m,{justify:"space-between",children:e.jsx(f,{size:"lg",children:t._({id:"Ku9qqT"})})}),e.jsx(_,{}),e.jsx(te,{records:o,onItemsSelected:s=>{c(s)},onItemsDeleted:s=>{const a=o.filter(n=>!s.includes(n.id));r.setState(a),x(a)}})]})})})]})]})}export{xe as default};
//# sourceMappingURL=Scan-CS54y6OB.js.map
