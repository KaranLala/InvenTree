import{j as e,S as A,r as u,bO as O,u as H,i as C,Y as X,bV as y,F as Y,B as Q,bP as I,bJ as k,a1 as W,G as N,bK as Z,dU as K,dV as ee,L as ne}from"./vendor-c9tu_e1b.js";import{f as ae,e as se,A as te,a as ie,u as D,C as M,p as le,r as re,n as oe,v as R,d as ce,g as de}from"./index-C-YqHYR0.js";import{k as ue}from"./UseForm-21BEg7Md.js";import{u as me}from"./PluginSource-CpS38oS9.js";import{R as xe,P as he}from"./RemoteComponent-BK_-mK5N.js";import{g as fe,h as G,j as pe,u as be,a as je,p as ge,k as B,S as Pe}from"./ThemeContext-CVPHi9Q7.js";function ve({pluginFeature:s,pluginContext:d}){return e.jsx(A,{gap:"xs",children:e.jsx(xe,{source:s.source,defaultFunctionName:"renderPanel",context:d})})}function Se({instance:s,reloadFunc:d,model:t,id:o}){const m=ae(),p=u.useMemo(()=>m.isSet("ENABLE_PLUGINS_INTERFACE"),[m]),c=O({enabled:p&&!!t&&o!==void 0,queryKey:["custom-plugin-panels",t,o],throwOnError:x=>(console.error("ERR: Failed to fetch plugin panels"),!1),queryFn:async()=>{if(!p||!t)return Promise.resolve([]);const x=se(te.plugin_ui_features_list,void 0,{feature_type:he.panel});return ie.get(x,{params:{target_model:t,target_id:o}}).then(l=>l.data)}}),b=me(),j=u.useMemo(()=>({...b,id:o,model:t,instance:s,reloadInstance:d}),[t,o,s,b]),r=u.useMemo(()=>{var x;return((x=c==null?void 0:c.data)==null?void 0:x.map(l=>{const g=(l==null?void 0:l.icon)||"ti:plug:outline",h={...j,context:l.context};return{name:l.key,pluginName:l.plugin_name,label:l.title,icon:e.jsx(ue,{name:g}),content:e.jsx(ve,{pluginFeature:l,pluginContext:h})}}))??[]},[c.data,j]);return u.useMemo(()=>({panels:r,isLoading:c.isLoading||c.isFetching,query:c}),[r,c])}var ye="vvj8hc0";function $e({pageKey:s,panels:d,groups:t,onPanelChange:o,selectedPanel:m,reloadInstance:p,instance:c,model:b,id:j,collapsible:r=!0}){const F=D(),x=be(),l=je(),{panel:g}=ge(),[h,q]=u.useState(!0),$=Se({id:j,model:b,instance:c,reloadFunc:p}),[L,z]=u.useMemo(()=>{var U;const n=[],i=[...d],a=[...d];t==null||t.forEach(f=>{var E;const P={...f,panels:[]};(E=f.panelIDs)==null||E.forEach(_=>{const w=i.findIndex(J=>J.name===_);w!==-1&&(P.panels.push(i[w]),i.splice(w,1))}),n.push(P)}),i.length>0&&n.push({id:"ungrouped",label:"",panels:i});const v=[];return(U=$.panels)==null||U.forEach(f=>{let P=f.name;d.find(_=>_.name===P)&&(P=M(`${f.pluginName}-${f.name}`)),v.push({...f,name:P}),a.push({...f,name:P})}),v.length>0&&n.push({id:"plugins",label:C._({id:"GdSEwD"}),panels:v}),[a,n]},[t,d,$]),S=u.useMemo(()=>L.filter(n=>!n.hidden&&!n.disabled),[L]),T=u.useCallback((n,i)=>{if(le(i),i&&re(i)){const a=`${x.pathname}/../${n}`;oe(a,l,i)}else l(`../${n}`);F.setLastUsedPanel(s)(n),n&&o&&o(n)},[S,l,x,o]);u.useEffect(()=>{m&&m!==g&&T(m)},[m,g]);const V=u.useMemo(()=>{var n;return S.findIndex(i=>i.name===g)===-1?((n=S[0])==null?void 0:n.name)??"":g??""},[S,g]);return e.jsx(B,{label:`PanelGroup-${s}`,children:e.jsx(X,{p:"sm",radius:"xs",shadow:"xs","aria-label":`${s}`,children:e.jsxs(y,{value:V,orientation:"vertical",keepMounted:!1,"aria-label":`panel-group-${s}`,classNames:{tab:ye},children:[e.jsxs(y.List,{justify:"left","aria-label":`panel-tabs-${s}`,children:[z.map(n=>{var i;return e.jsxs(Y,{w:"100%",children:[e.jsx(Q,{hidden:!n.label||!h,c:R.colors.primaryColors[7],style:{paddingLeft:"10px"},children:n.label},`group-label-${n.id}`),n.label&&e.jsx(I,{c:R.colors.primaryColors[7]}),(i=n.panels)==null?void 0:i.map(a=>!a.hidden&&e.jsx(k,{label:a.label??a.name,disabled:h,position:"right",children:e.jsx(y.Tab,{p:"xs",w:"100%",value:a.name,leftSection:a.icon,hidden:a.hidden,disabled:a.disabled,style:{cursor:a.disabled?"unset":"pointer"},onClick:v=>T(a.name,v),children:e.jsx(W,{component:"a",href:ce(`/${de()}${x.pathname}/${a.name}`),children:h&&a.label})},`panel-label-${a.name}`)},a.name))]},`group-${n.id}`)}),r&&e.jsx(I,{}),r&&e.jsxs(N,{wrap:"nowrap",gap:"xs",children:[e.jsx(k,{position:"right",label:h?C._({id:"vpmaDJ"}):C._({id:"L6p1/r"}),children:e.jsx(Z,{style:{paddingLeft:"10px"},onClick:()=>q(!h),variant:"transparent",size:"lg",children:h?e.jsx(K,{opacity:.75}):e.jsx(ee,{opacity:.75})})}),$.isLoading&&e.jsx(ne,{size:"xs"})]})]}),L.map(n=>!n.hidden&&e.jsx(y.Panel,{value:n.name,"aria-label":`nav-panel-${M(`${s}-${n.name}`)}`,p:"sm",style:{overflowX:"scroll",width:"100%"},children:e.jsxs(A,{gap:"md",children:[n.showHeadline!==!1&&e.jsxs(e.Fragment,{children:[e.jsxs(N,{justify:"space-between",children:[e.jsx(Pe,{size:"xl",children:n.label}),n.controls&&e.jsx(N,{justify:"right",wrap:"nowrap",children:n.controls})]}),e.jsx(I,{})]}),e.jsx(B,{label:`PanelContent-${n.name}`,children:n.content})]})},`panel-${n.name}`))]})})})}function Le({pageKey:s,selectedPanel:d,panels:t}){const o=D(H(m=>{var b,j;const p=d||m.lastUsedPanels[s]||((b=t[0])==null?void 0:b.name);return t.findIndex(r=>r.name===p&&!r.disabled&&!r.hidden)===-1?((j=t.find(r=>!r.disabled&&!r.hidden))==null?void 0:j.name)||"":p}));return e.jsx(pe,{to:o,replace:!0})}function Fe(s){return e.jsxs(fe,{children:[e.jsx(G,{index:!0,element:e.jsx(Le,{...s})}),e.jsx(G,{path:"/:panel/*",element:e.jsx($e,{...s})})]})}export{Fe as P};
//# sourceMappingURL=PanelGroup-Dx-tKZpU.js.map
