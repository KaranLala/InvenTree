import{r as d,j as t,cx as O,i,dz as j,bx as R,eF as T,S as Q}from"./vendor-c9tu_e1b.js";import{b as q,A as n,m as s,U as S,h as A}from"./index-C-YqHYR0.js";import{u as z,a as G,b as N,d as Z}from"./UseForm-21BEg7Md.js";import{P as $}from"./PrimaryActionButton-DeoSYpU2.js";import{y as H,P as K,O as L,E as V,Y as X}from"./InvenTreeTable-_nPJoCLK.js";import{I as W,D,a as J}from"./InstanceDetail-BhafbIJP.js";import{D as _}from"./DetailsBadge-D_E2hPhf.js";import{D as ee,N as te}from"./NotesPanel-B1Mm8XV0.js";import{P as ie}from"./PageDetail-UrmB-yLk.js";import{A as re}from"./AttachmentPanel-cEo4FCl5.js";import{P as se}from"./PanelGroup-Dx-tKZpU.js";import{f as F}from"./formatters-1-K9MQML.js";import{e as ae,f as oe}from"./SalesOrderForms-DpTkhoXL.js";import{u as v}from"./UseInstance-Z-QOK6WR.js";import{S as ne}from"./SalesOrderAllocationTable-vwtoQvXI.js";import{p as le,a as de}from"./ThemeContext-CVPHi9Q7.js";import"./DesktopAppView-Bg1vO8uy.js";import"./ActionButton-Cn3lAMG1.js";import"./index-D1sX3jYA.js";import"./QRCode-4MaRh6JQ.js";import"./browser-oJrDmCBJ.js";import"./YesNoButton-BdKeJbQO.js";import"./ModelType-CepomS9H.js";import"./GenericErrorPage-RCGZWWhe.js";import"./NotFound-Cglkc0xC.js";import"./PermissionDenied-D4im8ofc.js";import"./PageTitle-BiZTQEW1.js";import"./AttachmentLink-BmXuTpAy.js";import"./PluginSource-CpS38oS9.js";import"./RemoteComponent-BK_-mK5N.js";import"./RemoveRowButton-0iZczeVG.js";import"./ColumnRenderers-6-W27ey5.js";import"./UseStockAdjustActions-PDcplZpx.js";import"./UseGenerator-DwBNXut7.js";function Ne(){var y,x,g;const{id:P}=le(),m=q(),I=de(),{instance:e,instanceQuery:l,refreshInstance:p}=v({endpoint:n.sales_order_shipment_list,pk:P,params:{order_detail:!0}}),{instance:r,instanceQuery:u}=v({endpoint:n.company_list,pk:(y=e.order_detail)==null?void 0:y.customer,hasPrimaryKey:!0}),a=d.useMemo(()=>!e.shipment_date,[e]),h=d.useMemo(()=>{var k;if(l.isFetching||u.isFetching)return t.jsx(O,{});const o={...e,customer:r==null?void 0:r.pk,customer_name:r==null?void 0:r.name,customer_reference:(k=e.order_detail)==null?void 0:k.customer_reference},U=[{type:"link",model:s.salesorder,name:"order",label:i._({id:"LozYBo"}),icon:"sales_orders",model_field:"reference"},{type:"link",name:"customer",icon:"customers",label:i._({id:"876pfE"}),model:s.company,model_field:"name",hidden:!o.customer},{type:"text",name:"customer_reference",icon:"serial",label:i._({id:"ZVUe1A"}),hidden:!o.customer_reference,copy:!0},{type:"text",name:"reference",icon:"serial",label:i._({id:"Dwgrby"}),copy:!0},{type:"text",name:"allocated_items",icon:"packages",label:i._({id:"sdy17V"})}],w=[{type:"text",name:"tracking_number",label:i._({id:"DTku8S"}),icon:"trackable",value_formatter:()=>e.tracking_number||"---",copy:!!e.tracking_number},{type:"text",name:"invoice_number",label:i._({id:"MhyecB"}),icon:"serial",value_formatter:()=>e.invoice_number||"---",copy:!!e.invoice_number},{type:"text",name:"shipment_date",label:i._({id:"MFQxyA"}),icon:"calendar",value_formatter:()=>F(e.shipment_date),hidden:!e.shipment_date},{type:"text",name:"delivery_date",label:i._({id:"ovm9ir"}),icon:"calendar",value_formatter:()=>F(e.delivery_date),hidden:!e.delivery_date},{type:"link",external:!0,name:"link",label:i._({id:"yzF66j"}),copy:!0,hidden:!e.link}];return t.jsx(t.Fragment,{children:t.jsxs(W,{children:[t.jsxs(j,{grow:!0,children:[t.jsx(ee,{appRole:S.sales_order,apiPath:n.company_list,src:r==null?void 0:r.image,pk:r==null?void 0:r.pk,imageActions:{selectExisting:!1,downloadImage:!1,uploadFile:!1,deleteFile:!1}}),t.jsx(j.Col,{span:{base:12,sm:8},children:t.jsx(D,{fields:U,item:o})})]}),t.jsx(D,{fields:w,item:o})]})})},[e,l,r,u]),M=d.useMemo(()=>[{name:"detail",label:i._({id:"aaEiwW"}),icon:t.jsx(R,{}),content:h},{name:"items",label:i._({id:"MD2yP5"}),icon:t.jsx(T,{}),content:t.jsx(ne,{orderId:e.order,shipmentId:e.pk,showPartInfo:!0,allowEdit:a,modelField:"item",modelTarget:s.stockitem})},re({model_type:s.salesordershipment,model_id:e.pk}),te({model_type:s.salesordershipment,model_id:e.pk})],[a,e,h]),Y=ae({pending:a}),c=z({url:n.sales_order_shipment_list,pk:e.pk,fields:Y,title:i._({id:"rX/5YH"}),onFormSuccess:p}),f=G({url:n.sales_order_shipment_list,pk:e.pk,title:i._({id:"YAsuZ2"}),onFormSuccess:()=>{I(A(s.salesorder,e.order))}}),E=oe({}),b=N({url:n.sales_order_shipment_complete,pk:e.pk,fields:E,title:i._({id:"/IxVda"}),focus:"tracking_number",initialData:{...e,shipment_date:Z().format("YYYY-MM-DD")},onFormSuccess:p}),C=d.useMemo(()=>l.isFetching?[]:[t.jsx(_,{label:i._({id:"UbRKMZ"}),color:"gray",visible:a},"pending"),t.jsx(_,{label:i._({id:"AoOqHM"}),color:"green",visible:!a},"shipped"),t.jsx(_,{label:i._({id:"BTOhSm"}),color:"blue",visible:!!e.delivery_date},"delivered")],[a,e.deliveryDate,l.isFetching]),B=d.useMemo(()=>{const o=m.hasChangePermission(s.salesordershipment);return[t.jsx($,{title:i._({id:"1mYYQ6"}),icon:"sales_orders",hidden:!a,color:"green",onClick:()=>{b.open()}},"send-shipment"),t.jsx(H,{model:s.salesordershipment,pk:e.pk,hash:e==null?void 0:e.barcode_hash},"barcode"),t.jsx(K,{modelType:s.salesordershipment,items:[e.pk],enableLabels:!0,enableReports:!0},"print"),t.jsx(L,{tooltip:i._({id:"8ijAtN"}),actions:[V({hidden:!o,onClick:c.open,tooltip:i._({id:"rX/5YH"})}),X({hidden:!a,onClick:f.open,tooltip:i._({id:"YAsuZ2"})})]},"actions")]},[a,m,e]);return t.jsxs(t.Fragment,{children:[b.modal,c.modal,f.modal,t.jsx(J,{query:l,requiredRole:S.sales_order,children:t.jsxs(Q,{gap:"xs",children:[t.jsx(ie,{title:`${i._({id:"qGSobR"})}: ${e.reference}`,subtitle:`${i._({id:"LozYBo"})}: ${(x=e.order_detail)==null?void 0:x.reference}`,breadcrumbs:[{name:i._({id:"mUv9U4"}),url:"/sales/"},{name:(g=e.order_detail)==null?void 0:g.reference,url:A(s.salesorder,e.order)}],badges:C,imageUrl:r==null?void 0:r.image,editAction:c.open,editEnabled:m.hasChangePermission(s.salesordershipment),actions:B}),t.jsx(se,{pageKey:"salesordershipment",panels:M,model:s.salesordershipment,reloadInstance:p,instance:e,id:e.pk})]})})]})}export{Ne as default};
//# sourceMappingURL=SalesOrderShipmentDetail-LRCBeUUL.js.map
