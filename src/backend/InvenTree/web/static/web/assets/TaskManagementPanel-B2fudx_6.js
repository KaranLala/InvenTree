const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ScheduledTasksTable-hQCpYQn3.js","./vendor-c9tu_e1b.js","./index-C-YqHYR0.js","./index-UYvGlE4T.css","./InvenTreeTable-_nPJoCLK.js","./DesktopAppView-Bg1vO8uy.js","./ThemeContext-CVPHi9Q7.js","./index-D1sX3jYA.js","./UseForm-21BEg7Md.js","./ActionButton-Cn3lAMG1.js","./UseForm-DfJkRRGL.css","./QRCode-4MaRh6JQ.js","./browser-oJrDmCBJ.js"])))=>i.map(i=>d[i]);
import{b as h,e as _,A as u,U as v,a as S,L as D,_ as C}from"./index-C-YqHYR0.js";import{r,ct as E,i as s,j as e,cE as w,B as f,h as F,s as x,d as P,n as A,fA as O,aT as R,bU as y,S as B,bP as M,bW as i}from"./vendor-c9tu_e1b.js";import{S as c}from"./ThemeContext-CVPHi9Q7.js";import{e as z}from"./Alerts-DLyRnQ7x.js";import{F as U}from"./FactCollection-zrKIfWOz.js";import{u as I}from"./UseInstance-Z-QOK6WR.js";import{u as j,I as b}from"./InvenTreeTable-_nPJoCLK.js";import{A as V}from"./ActionButton-Cn3lAMG1.js";import"./links-CHCgg5t8.js";import"./DesktopAppView-Bg1vO8uy.js";import"./index-D1sX3jYA.js";import"./UseForm-21BEg7Md.js";import"./QRCode-4MaRh6JQ.js";import"./browser-oJrDmCBJ.js";function J({onRecordsUpdated:t}){const a=j("tasks-failed"),l=h(),[p,m]=r.useState(""),[n,{open:o,close:g}]=E(!1),k=r.useMemo(()=>[{accessor:"func",title:s._({id:"Q3P/4s"}),sortable:!0,switchable:!1},{accessor:"pk",title:s._({id:"YgxM31"})},{accessor:"started",title:s._({id:"JEGlfK"}),sortable:!0,switchable:!1},{accessor:"stopped",title:s._({id:"NnvXp5"}),sortable:!0,switchable:!1},{accessor:"attempt_count",title:s._({id:"BCmibk"})}],[]);return e.jsxs(e.Fragment,{children:[e.jsx(w,{opened:n,size:"xl",position:"right",title:e.jsx(c,{children:s._({id:"7Jw/XW"})}),onClose:g,children:p.split(`
`).map((d,T)=>e.jsx(f,{size:"sm",children:d},`error-${T}`))}),e.jsx(b,{url:_(u.task_failed_list),tableState:a,columns:k,props:{enableBulkDelete:l.isStaff(),afterBulkDelete:t,enableSelection:!0,onRowClick:d=>{d.result?(m(d.result),o()):(F("failed-task"),x({id:"failed-task",title:s._({id:"6RoHXm"}),message:s._({id:"OFdRJT"}),color:"red",icon:e.jsx(P,{})}))}}})]})}function N({onRecordsUpdated:t}){const a=j("tasks-pending"),l=h(),p=r.useMemo(()=>[{accessor:"func",title:s._({id:"Q3P/4s"}),switchable:!1},{accessor:"task_id",title:s._({id:"YgxM31"})},{accessor:"name",title:s._({id:"6YtxFj"})},{accessor:"lock",title:s._({id:"d+F6q9"}),sortable:!1,switchable:!1},{accessor:"args",title:s._({id:"OgB1k4"})},{accessor:"kwargs",title:s._({id:"/n/HCO"})}],[]),m=r.useMemo(()=>[e.jsx(V,{icon:e.jsx(O,{}),tooltip:s._({id:"Y1g0pp"}),onClick:()=>{S.delete(`${_(u.task_pending_list)}?all=true`).then(()=>{A.show({id:"notes",title:s._({id:"zzDlyQ"}),message:s._({id:"1B6y2p"}),color:"green"}),a.refreshTable()}).catch(n=>{var o;x({title:s._({id:"mjh4RV"}),message:((o=n.response.data)==null?void 0:o.non_field_errors)??n.message??s._({id:"29VNqC"}),color:"red",icon:e.jsx(R,{})})})},hidden:!l.hasAddRole(v.admin)},"remove-all")],[l]);return e.jsx(b,{url:_(u.task_pending_list),tableState:a,columns:p,props:{afterBulkDelete:t,enableBulkDelete:l.isStaff(),enableSelection:!0,enableSearch:!1,tableActions:m}})}const X=D(r.lazy(()=>C(()=>import("./ScheduledTasksTable-hQCpYQn3.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]),import.meta.url)));function ae(){const{instance:t,refreshInstance:a}=I({endpoint:u.task_overview,hasPrimaryKey:!1,refetchOnMount:!0,defaultValue:{},updateInterval:3e4});return e.jsxs(e.Fragment,{children:[(t==null?void 0:t.is_running)==!1&&e.jsxs(y,{title:s._({id:"Oe/dvo"}),color:"red",children:[e.jsx(f,{children:s._({id:"HkhyUV"})}),z("INVE-W5")]}),e.jsxs(B,{gap:"xs",children:[e.jsx(U,{items:[{title:s._({id:"sOEpG4"}),value:t==null?void 0:t.pending_tasks},{title:s._({id:"8OiyFS"}),value:t==null?void 0:t.scheduled_tasks},{title:s._({id:"DJ8M4D"}),value:t==null?void 0:t.failed_tasks}]}),e.jsx(M,{}),e.jsxs(i,{defaultValue:"pending",children:[e.jsxs(i.Item,{value:"pending",children:[e.jsx(i.Control,{children:e.jsx(c,{size:"lg",children:s._({id:"sOEpG4"})})}),e.jsx(i.Panel,{children:e.jsx(N,{onRecordsUpdated:a})})]},"pending-tasks"),e.jsxs(i.Item,{value:"scheduled",children:[e.jsx(i.Control,{children:e.jsx(c,{size:"lg",children:s._({id:"8OiyFS"})})}),e.jsx(i.Panel,{children:e.jsx(X,{})})]},"scheduled-tasks"),e.jsxs(i.Item,{value:"failed",children:[e.jsx(i.Control,{children:e.jsx(c,{size:"lg",children:s._({id:"DJ8M4D"})})}),e.jsx(i.Panel,{children:e.jsx(J,{onRecordsUpdated:a})})]},"failed-tasks")]})]})]})}export{ae as default};
//# sourceMappingURL=TaskManagementPanel-B2fudx_6.js.map
