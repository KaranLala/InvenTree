import{r as i,i as e,j as a,G as Ce,B as H,aV as te,cH as Ie,eM as Re,al as Ae,br as ce,Y as we,b4 as pe,cx as se,dz as ae,bx as Fe,bW as P,bw as Pe,eF as De,S as Oe}from"./vendor-c9tu_e1b.js";import{b as J,A as o,m as c,U as r,e as D,f as Ee}from"./index-C-YqHYR0.js";import{A as Me}from"./AdminButton-B4su-izZ.js";import{P as Z}from"./PrimaryActionButton-DeoSYpU2.js";import{u as me,G as ue,R as _e,Z as Te,a as Le,I as he,_ as ve,y as Ne,P as qe,O as Be,E as Ge,z as We,X as ze,Y as He}from"./InvenTreeTable-_nPJoCLK.js";import{I as Ye,D as Y,a as Ue}from"./InstanceDetail-BhafbIJP.js";import{D as Ke,N as Ve}from"./NotesPanel-B1Mm8XV0.js";import{a as be,p as Ze,S as ie}from"./ThemeContext-CVPHi9Q7.js";import{P as Qe}from"./PageDetail-UrmB-yLk.js";import{A as Xe}from"./AttachmentPanel-cEo4FCl5.js";import{P as Je}from"./PanelGroup-Dx-tKZpU.js";import{n as $e,b as x,u as $,a as xe,A as ke,x as et,d as tt,h as st}from"./UseForm-21BEg7Md.js";import{a as Q}from"./formatters-1-K9MQML.js";import{b as le,c as at,d as it,e as oe,f as lt,u as ne}from"./SalesOrderForms-DpTkhoXL.js";import{u as ot}from"./UseInstance-Z-QOK6WR.js";import{u as nt}from"./UseStatusCodes-Csh8ugV0.js";import{u as rt,B as dt}from"./BuildOrderTable-p5FINNWK.js";import{E as ct}from"./ExtraLineItemTable-D78MeQx9.js";import{S as Se}from"./SalesOrderAllocationTable-vwtoQvXI.js";import{A as re}from"./ActionButton-Cn3lAMG1.js";import{P as de}from"./index-D1sX3jYA.js";import{O as pt}from"./OrderPartsWizard-DcOlnycT.js";import{D as mt,h as ut,k as X,L as fe,P as _t}from"./ColumnRenderers-6-W27ey5.js";import{R as ht}from"./RowExpansionIcon-DqmbZUQQ.js";import{Y as bt}from"./YesNoButton-BdKeJbQO.js";import"./DesktopAppView-Bg1vO8uy.js";import"./QRCode-4MaRh6JQ.js";import"./browser-oJrDmCBJ.js";import"./ModelType-CepomS9H.js";import"./GenericErrorPage-RCGZWWhe.js";import"./NotFound-Cglkc0xC.js";import"./PermissionDenied-D4im8ofc.js";import"./PageTitle-BiZTQEW1.js";import"./AttachmentLink-BmXuTpAy.js";import"./PluginSource-CpS38oS9.js";import"./RemoteComponent-BK_-mK5N.js";import"./RemoveRowButton-0iZczeVG.js";import"./UseGenerator-DwBNXut7.js";import"./CommonForms-CCxz_oyT.js";import"./UseStockAdjustActions-PDcplZpx.js";import"./CompanyForms-DAK9mm-H.js";import"./PurchaseOrderForms-CcRoGXTZ.js";function xt({orderId:_,orderDetailRefresh:p,currency:f,customerId:t,editable:m}){const h=be(),n=J(),l=me("sales-order-line-item"),u=i.useMemo(()=>[{accessor:"part",sortable:!0,switchable:!1,render:s=>a.jsxs(Ce,{wrap:"nowrap",children:[a.jsx(ht,{enabled:s.allocated,expanded:l.isRowExpanded(s.pk)}),a.jsx(_t,{part:s.part_detail})]})},{accessor:"part_detail.IPN",title:e._({id:"3wXEsN"}),switchable:!0},mt({accessor:"part_detail.description"}),{accessor:"reference",sortable:!1,switchable:!0},ut({accessor:"quantity",sortable:!0}),{accessor:"sale_price",render:s=>Q(s.sale_price,{currency:s.sale_price_currency})},{accessor:"total_price",title:e._({id:"KyZVKD"}),render:s=>Q(s.sale_price,{currency:s.sale_price_currency,multiplier:s.quantity})},X({accessor:"target_date",sortable:!0,title:e._({id:"ZmykKo"})}),{accessor:"stock",title:e._({id:"oGd3rK"}),render:s=>{const T=(s==null?void 0:s.available_stock)??0,B=(s==null?void 0:s.available_variant_stock)??0,L=T+B,W=Math.max(s.quantity-s.allocated-s.shipped,0);let V,ee=`${L}`;const z=[];return L<=0?(V="red",ee=e._({id:"a5n/wL"})):L<W&&(V="orange"),B>0&&z.push(a.jsx(H,{size:"sm",children:e._({id:"LdvJ9e"})})),s.building>0&&z.push(a.jsxs(H,{size:"sm",children:[e._({id:"G1xXyB"}),": ",s.building]})),s.on_order>0&&z.push(a.jsxs(H,{size:"sm",children:[e._({id:"/MB+gl"}),": ",s.on_order]})),a.jsx($e,{value:a.jsx(H,{c:V,children:ee}),extra:z,title:e._({id:"odasNw"})})}},{accessor:"allocated",sortable:!0,render:s=>a.jsx(de,{progressLabel:!0,value:s.allocated,maximum:s.quantity})},{accessor:"shipped",sortable:!0,render:s=>a.jsx(de,{progressLabel:!0,value:s.shipped,maximum:s.quantity})},{accessor:"notes"},fe({accessor:"link"})],[l.isRowExpanded]),[y,k]=i.useState(0),[w,O]=i.useState(null),[j,g]=i.useState({}),E=le({orderId:_,customerId:t,create:!0}),C=x({url:o.sales_order_line_list,title:e._({id:"pwb7Yo"}),fields:E,initialData:{...j,sale_price_currency:f},onFormSuccess:p,table:l}),b=le({orderId:_,customerId:t,create:!1}),I=$({url:o.sales_order_line_list,pk:y,title:e._({id:"vgosWS"}),fields:b,onFormSuccess:p,table:l}),v=xe({url:o.sales_order_line_list,pk:y,title:e._({id:"tpKh8C"}),onFormSuccess:p,table:l}),U=at({itemId:y,orderId:_}),G=x({url:o.sales_order_allocate_serials,pk:_,title:e._({id:"AZE5KS"}),preFormContent:w?a.jsx(we,{withBorder:!0,p:"sm",children:a.jsx(et,{instance:w})}):void 0,initialData:j,fields:U,table:l}),K=rt({create:!0,modalId:"build-order-create-from-sales-order"}),N=x({url:o.build_order_list,title:e._({id:"UcPKar"}),modalId:"build-order-create-from-sales-order",fields:K,initialData:j,follow:!0,modelType:c.build}),[d,S]=i.useState([]),F=it({orderId:_,lineItems:d,onFormSuccess:()=>{l.refreshTable(),l.clearSelectedRecords()}}),[q,R]=i.useState([]),A=pt({parts:q}),M=i.useMemo(()=>[{name:"allocated",label:e._({id:"A/ybx7"}),description:e._({id:"Rk+ZGQ"})},{name:"completed",label:e._({id:"qqWcBV"}),description:e._({id:"x7Nm8D"})}],[]),ye=i.useMemo(()=>[a.jsx(ke,{tooltip:e._({id:"pwb7Yo"}),onClick:()=>{g({order:_}),C.open()},hidden:!m||!n.hasAddRole(r.sales_order)},"add-line-item"),a.jsx(re,{hidden:!n.hasAddRole(r.purchase_order),disabled:!l.hasSelectedRecords,tooltip:e._({id:"3u5ICq"}),icon:a.jsx(te,{}),color:"blue",onClick:()=>{R(l.selectedRecords.map(s=>s.part_detail)),A.openWizard()}},"order-parts"),a.jsx(re,{tooltip:e._({id:"L1LMmH"}),icon:a.jsx(Ie,{}),disabled:!l.hasSelectedRecords,color:"green",onClick:()=>{S(l.selectedRecords.filter(s=>s.allocated<s.quantity)),F.open()}},"allocate-stock")],[n,_,l.hasSelectedRecords,l.selectedRecords]),je=i.useCallback(s=>{var B,L,W;const T=((s==null?void 0:s.allocated)??0)>((s==null?void 0:s.quantity)??0);return[ue({title:e._({id:"4BxQBj"}),modelType:c.part,modelId:s.part,navigate:h,hidden:!n.hasViewRole(r.part)}),{hidden:T||!m||!n.hasChangeRole(r.sales_order),title:e._({id:"L1LMmH"}),icon:a.jsx(Re,{}),color:"green",onClick:()=>{S([s]),F.open()}},{hidden:!((B=s==null?void 0:s.part_detail)!=null&&B.trackable)||T||!m||!n.hasChangeRole(r.sales_order),title:e._({id:"EIkxpC"}),icon:a.jsx(Ae,{}),color:"green",onClick:()=>{k(s.pk),O((s==null?void 0:s.part_detail)??null),g({quantity:s.quantity-s.allocated}),G.open()}},{hidden:T||!n.hasAddRole(r.build)||!((L=s==null?void 0:s.part_detail)!=null&&L.assembly),title:e._({id:"NH34YB"}),icon:a.jsx(ce,{}),color:"blue",onClick:()=>{g({part:s.part,quantity:((s==null?void 0:s.quantity)??1)-((s==null?void 0:s.allocated)??0),sales_order:_}),N.open()}},{hidden:T||!n.hasAddRole(r.purchase_order)||!((W=s==null?void 0:s.part_detail)!=null&&W.purchaseable),title:e._({id:"G4SnGh"}),icon:a.jsx(te,{}),color:"blue",onClick:()=>{R([s.part_detail]),A.openWizard()}},_e({hidden:!m||!n.hasChangeRole(r.sales_order),onClick:()=>{k(s.pk),I.open()}}),Te({hidden:!m||!n.hasAddRole(r.sales_order),onClick:()=>{g(s),C.open()}}),Le({hidden:!m||!n.hasDeleteRole(r.sales_order),onClick:()=>{k(s.pk),v.open()}})]},[h,n,m]),ge=i.useMemo(()=>({allowMultiple:!0,expandable:({record:s})=>l.isRowExpanded(s.pk)||s.allocated>0,content:({record:s})=>a.jsx(Se,{showOrderInfo:!1,showPartInfo:!1,orderId:_,lineItemId:s.pk,partId:s.part,allowEdit:!0,modelTarget:c.stockitem,modelField:"item",isSubTable:!0})}),[_,l.isRowExpanded]);return a.jsxs(a.Fragment,{children:[I.modal,v.modal,C.modal,N.modal,G.modal,F.modal,A.wizard,a.jsx(he,{url:D(o.sales_order_line_list),tableState:l,columns:u,props:{enableSelection:!0,enableDownload:!0,params:{order:_,part_detail:!0},rowActions:je,tableActions:ye,tableFilters:M,rowExpansion:ge}})]})}function kt({orderId:_}){const p=J(),f=be(),t=me("sales-order-shipment"),[m,h]=i.useState({}),n=oe({}),l=oe({}),u=lt({}),y=x({url:o.sales_order_shipment_list,fields:n,title:e._({id:"qU3Y7+"}),table:t,initialData:{order:_}}),k=xe({url:o.sales_order_shipment_list,pk:m.pk,title:e._({id:"YAsuZ2"}),table:t}),w=$({url:o.sales_order_shipment_list,pk:m.pk,fields:l,title:e._({id:"rX/5YH"}),table:t}),O=x({url:o.sales_order_shipment_complete,pk:m.pk,fields:u,title:e._({id:"/IxVda"}),table:t,focus:"tracking_number",initialData:{...m,shipment_date:tt().format("YYYY-MM-DD")}}),j=i.useMemo(()=>[{accessor:"reference",title:e._({id:"Dwgrby"}),switchable:!1,sortable:!0},{accessor:"allocated_items",sortable:!0,switchable:!1,title:e._({id:"BzfzPK"})},{accessor:"shipped",title:e._({id:"AoOqHM"}),switchable:!0,sortable:!1,render:b=>a.jsx(bt,{value:!!b.shipment_date})},X({accessor:"shipment_date",title:e._({id:"MFQxyA"})}),X({accessor:"delivery_date",title:e._({id:"ovm9ir"})}),{accessor:"tracking_number"},{accessor:"invoice_number"},fe({accessor:"link"})],[]),g=i.useCallback(b=>{const I=!!b.shipment_date;return[ue({title:e._({id:"GtJdx7"}),modelType:c.salesordershipment,modelId:b.pk,navigate:f}),{hidden:I||!p.hasChangeRole(r.sales_order),title:e._({id:"/IxVda"}),color:"green",icon:a.jsx(pe,{}),onClick:()=>{h(b),O.open()}},_e({hidden:!p.hasChangeRole(r.sales_order),tooltip:e._({id:"MPjEsC"}),onClick:()=>{h(b),w.open()}}),ve({hidden:I||!p.hasDeleteRole(r.sales_order),tooltip:e._({id:"whI1i/"}),onClick:()=>{h(b),k.open()}})]},[p]),E=i.useMemo(()=>[a.jsx(ke,{tooltip:e._({id:"77d67d"}),hidden:!p.hasAddRole(r.sales_order),onClick:()=>{y.open()}},"add-shipment")],[p]),C=i.useMemo(()=>[{name:"shipped",label:e._({id:"AoOqHM"}),description:e._({id:"zxYkrg"})},{name:"delivered",label:e._({id:"BTOhSm"}),description:e._({id:"DOexmc"})}],[]);return a.jsxs(a.Fragment,{children:[y.modal,w.modal,k.modal,O.modal,a.jsx(he,{url:D(o.sales_order_shipment_list),tableState:t,columns:j,props:{tableActions:E,tableFilters:C,modelType:c.salesordershipment,enableSelection:!0,enableReports:!0,rowActions:g,params:{order:_}}})]})}function ns(){var N;const{id:_}=Ze(),p=J(),f=Ee(),{instance:t,instanceQuery:m,refreshInstance:h}=ot({endpoint:o.sales_order_list,pk:_,params:{customer_detail:!0}}),n=i.useMemo(()=>{var d;return t.order_currency||((d=t.customer_detail)==null?void 0:d.currency)||f.getSetting("INVENTREE_DEFAULT_CURRENCY")},[t,f]),l=i.useMemo(()=>{var R,A,M;if(m.isFetching)return a.jsx(se,{});const d=[{type:"text",name:"reference",label:e._({id:"N2C89m"}),copy:!0},{type:"text",name:"customer_reference",label:e._({id:"ZVUe1A"}),copy:!0,icon:"reference",hidden:!t.customer_reference},{type:"link",name:"customer",icon:"customers",label:e._({id:"876pfE"}),model:c.company},{type:"text",name:"description",label:e._({id:"Nu4oKW"}),copy:!0},{type:"status",name:"status",label:e._({id:"uAQUqI"}),model:c.salesorder},{type:"status",name:"status_custom_key",label:e._({id:"4DvUAJ"}),model:c.salesorder,icon:"status",hidden:!t.status_custom_key||t.status_custom_key==t.status}],S=[{type:"progressbar",name:"completed",icon:"progress",label:e._({id:"qgs95u"}),total:t.line_items,progress:t.completed_lines,hidden:!t.line_items},{type:"progressbar",name:"shipments",icon:"shipment",label:e._({id:"polrQd"}),total:t.shipments_count,progress:t.completed_shipments_count,hidden:!t.shipments_count},{type:"text",name:"currency",label:e._({id:"0UZTSq"}),value_formatter:()=>n},{type:"text",name:"total_price",label:e._({id:"A6C0pv"}),value_formatter:()=>Q(t==null?void 0:t.total_price,{currency:n})}],F=[{type:"link",external:!0,name:"link",label:e._({id:"yzF66j"}),copy:!0,hidden:!t.link},{type:"text",name:"contact_detail.name",label:e._({id:"jfC/xh"}),icon:"user",copy:!0,hidden:!t.contact},{type:"text",name:"contact_detail.email",label:e._({id:"41BQ3k"}),icon:"email",copy:!0,hidden:!((R=t.contact_detail)!=null&&R.email)},{type:"text",name:"contact_detail.phone",label:e._({id:"P1x5uo"}),icon:"phone",copy:!0,hidden:!((A=t.contact_detail)!=null&&A.phone)},{type:"text",name:"project_code_label",label:e._({id:"Sdfr6G"}),icon:"reference",copy:!0,hidden:!t.project_code},{type:"text",name:"responsible",label:e._({id:"XQACoK"}),badge:"owner",hidden:!t.responsible}],q=[{type:"date",name:"creation_date",label:e._({id:"FNcMGM"}),copy:!0,hidden:!t.creation_date},{type:"date",name:"issue_date",label:e._({id:"M1cChr"}),icon:"calendar",copy:!0,hidden:!t.issue_date},{type:"date",name:"start_date",label:e._({id:"D3iCkb"}),icon:"calendar",hidden:!t.start_date,copy:!0},{type:"date",name:"target_date",label:e._({id:"ZmykKo"}),hidden:!t.target_date,copy:!0},{type:"date",name:"shipment_date",label:e._({id:"41ha49"}),hidden:!t.shipment_date,copy:!0}];return a.jsxs(Ye,{children:[a.jsxs(ae,{grow:!0,children:[a.jsx(Ke,{appRole:r.purchase_order,apiPath:o.company_list,src:(M=t.customer_detail)==null?void 0:M.image,pk:t.customer}),a.jsx(ae.Col,{span:{base:12,sm:8},children:a.jsx(Y,{fields:d,item:t})})]}),a.jsx(Y,{fields:S,item:t}),a.jsx(Y,{fields:F,item:t}),a.jsx(Y,{fields:q,item:t})]})},[t,n,m]),u=nt({modelType:c.salesorder}),y=ne({}),k=$({url:o.sales_order_list,pk:t.pk,title:e._({id:"nEK4wx"}),fields:y,onFormSuccess:()=>{h()}}),w=ne({duplicateOrderId:t.pk}),O=i.useMemo(()=>{const d={...t};return delete d.reference,d},[t]),j=x({url:o.sales_order_list,title:e._({id:"VzdnWM"}),fields:w,initialData:O,follow:!0,modelType:c.salesorder}),g=i.useMemo(()=>[{name:"detail",label:e._({id:"Tol4BF"}),icon:a.jsx(Fe,{}),content:l},{name:"line-items",label:e._({id:"SgduFH"}),icon:a.jsx(Pe,{}),content:a.jsxs(P,{multiple:!0,defaultValue:["line-items","extra-items"],children:[a.jsxs(P.Item,{value:"line-items",children:[a.jsx(P.Control,{children:a.jsx(ie,{size:"lg",children:e._({id:"SgduFH"})})}),a.jsx(P.Panel,{children:a.jsx(xt,{orderId:t.pk,orderDetailRefresh:h,currency:n,customerId:t.customer,editable:t.status!=u.COMPLETE&&t.status!=u.CANCELLED})})]},"lineitems"),a.jsxs(P.Item,{value:"extra-items",children:[a.jsx(P.Control,{children:a.jsx(ie,{size:"lg",children:e._({id:"l11DG/"})})}),a.jsx(P.Panel,{children:a.jsx(ct,{endpoint:o.sales_order_extra_line_list,orderId:t.pk,orderDetailRefresh:h,currency:n,role:r.sales_order})})]},"extraitems")]})},{name:"shipments",label:e._({id:"aljM0q"}),icon:a.jsx(pe,{}),content:a.jsx(kt,{orderId:t.pk})},{name:"allocations",label:e._({id:"MD2yP5"}),icon:a.jsx(De,{}),content:a.jsx(Se,{orderId:t.pk,showPartInfo:!0,allowEdit:!0,modelField:"item",modelTarget:c.stockitem})},{name:"build-orders",label:e._({id:"RCVhIP"}),icon:a.jsx(ce,{}),hidden:!p.hasViewRole(r.build),content:t!=null&&t.pk?a.jsx(dt,{salesOrderId:t.pk}):a.jsx(se,{})},Xe({model_type:c.salesorder,model_id:t.pk}),Ve({model_type:c.salesorder,model_id:t.pk})],[t,_,p,u,p]),E=x({url:D(o.sales_order_issue,t.pk),title:e._({id:"Zk75Wf"}),onFormSuccess:h,preFormWarning:e._({id:"lLiNZC"}),successMessage:e._({id:"R/WvFK"})}),C=x({url:D(o.sales_order_cancel,t.pk),title:e._({id:"GYdhXE"}),onFormSuccess:h,preFormWarning:e._({id:"MPFqR0"}),successMessage:e._({id:"H5qWhm"})}),b=x({url:D(o.sales_order_hold,t.pk),title:e._({id:"Pgi6wT"}),onFormSuccess:h,preFormWarning:e._({id:"3Wfk51"}),successMessage:e._({id:"0NH/ob"})}),I=x({url:D(o.sales_order_complete,t.pk),title:e._({id:"tMUAZW"}),onFormSuccess:h,preFormWarning:e._({id:"huukBM"}),successMessage:e._({id:"NloAZ8"}),fields:{accept_incomplete:{}}}),v=x({url:D(o.sales_order_complete,t.pk),title:e._({id:"O1h5Uc"}),onFormSuccess:h,preFormWarning:e._({id:"DYITap"}),successMessage:e._({id:"W7TghJ"}),fields:{accept_incomplete:{}}}),U=i.useMemo(()=>{const d=p.hasChangeRole(r.sales_order),S=d&&(t.status==u.PENDING||t.status==u.ON_HOLD),F=d&&(t.status==u.PENDING||t.status==u.ON_HOLD||t.status==u.IN_PROGRESS),q=d&&(t.status==u.PENDING||t.status==u.IN_PROGRESS),R=f.isSet("SALESORDER_SHIP_COMPLETE"),A=!R&&d&&t.status==u.IN_PROGRESS,M=d&&(t.status==u.SHIPPED||R&&t.status==u.IN_PROGRESS);return[a.jsx(Z,{title:e._({id:"WajCDs"}),icon:"issue",hidden:!S,color:"blue",onClick:E.open}),a.jsx(Z,{title:e._({id:"7I7mfp"}),icon:"deliver",hidden:!A,color:"blue",onClick:I.open}),a.jsx(Z,{title:e._({id:"NPZqBL"}),icon:"complete",hidden:!M,color:"green",onClick:v.open}),a.jsx(Me,{model:c.salesorder,id:t.pk}),a.jsx(Ne,{model:c.salesorder,pk:t.pk,hash:t==null?void 0:t.barcode_hash}),a.jsx(qe,{modelType:c.salesorder,items:[t.pk],enableReports:!0}),a.jsx(Be,{tooltip:e._({id:"/IKytX"}),actions:[Ge({hidden:!d,onClick:k.open,tooltip:e._({id:"mVeaUg"})}),We({hidden:!p.hasAddRole(r.sales_order),onClick:j.open,tooltip:e._({id:"oi/3Pq"})}),ze({tooltip:e._({id:"20mLBC"}),hidden:!q,onClick:b.open}),He({tooltip:e._({id:"tVJk4q"}),hidden:!F,onClick:C.open})]})]},[p,t,u,f]),G=i.useMemo(()=>m.isLoading?[]:[a.jsx(st,{status:t.status_custom_key,type:c.salesorder,options:{size:"lg"}},t.pk)],[t,m]),K=i.useMemo(()=>{var S;let d=((S=t.customer_detail)==null?void 0:S.name)||"";return t.customer_reference&&(d+=` (${t.customer_reference})`),d},[t]);return a.jsxs(a.Fragment,{children:[E.modal,C.modal,b.modal,I.modal,v.modal,k.modal,j.modal,a.jsx(Ue,{query:m,requiredRole:r.sales_order,children:a.jsxs(Oe,{gap:"xs",children:[a.jsx(Qe,{title:`${e._({id:"LozYBo"})}: ${t.reference}`,subtitle:K,imageUrl:(N=t.customer_detail)==null?void 0:N.image,badges:G,actions:U,breadcrumbs:[{name:e._({id:"mUv9U4"}),url:"/sales/"}],lastCrumb:[{name:t.reference,url:`/sales/sales-order/${t.pk}`}],editAction:k.open,editEnabled:p.hasChangePermission(c.salesorder)}),a.jsx(Je,{pageKey:"salesorder",panels:g,model:c.salesorder,reloadInstance:h,instance:t,id:t.pk})]})})]})}export{ns as default};
//# sourceMappingURL=SalesOrderDetail-Be4I81-4.js.map
