{"version":3,"file":"ImportSessionTable-CW7Yn3cR.js","sources":["../../../../../../frontend/src/tables/settings/ImportSessionTable.tsx"],"sourcesContent":["import { t } from '@lingui/core/macro';\nimport { useCallback, useMemo, useState } from 'react';\n\nimport { AddItemButton } from '@lib/components/AddItemButton';\nimport { ProgressBar } from '@lib/components/ProgressBar';\nimport { type RowAction, RowDeleteAction } from '@lib/components/RowActions';\nimport { ApiEndpoints } from '@lib/enums/ApiEndpoints';\nimport { ModelType } from '@lib/enums/ModelType';\nimport { apiUrl } from '@lib/functions/Api';\nimport type { TableFilter } from '@lib/types/Filters';\nimport type { TableColumn } from '@lib/types/Tables';\nimport ImporterDrawer from '../../components/importer/ImporterDrawer';\nimport { AttachmentLink } from '../../components/items/AttachmentLink';\nimport { RenderUser } from '../../components/render/User';\nimport { dataImporterSessionFields } from '../../forms/ImporterForms';\nimport { useFilters } from '../../hooks/UseFilter';\nimport {\n  useCreateApiFormModal,\n  useDeleteApiFormModal\n} from '../../hooks/UseForm';\nimport { useTable } from '../../hooks/UseTable';\nimport { DateColumn, StatusColumn } from '../ColumnRenderers';\nimport { StatusFilterOptions, UserFilter } from '../Filter';\nimport { InvenTreeTable } from '../InvenTreeTable';\n\nexport default function ImportSessionTable() {\n  const table = useTable('importsession');\n\n  const [opened, setOpened] = useState<boolean>(false);\n\n  const [selectedSession, setSelectedSession] = useState<number | undefined>(\n    undefined\n  );\n\n  const deleteSession = useDeleteApiFormModal({\n    url: ApiEndpoints.import_session_list,\n    pk: selectedSession,\n    title: t`Delete Import Session`,\n    table: table\n  });\n\n  const newImportSession = useCreateApiFormModal({\n    url: ApiEndpoints.import_session_list,\n    title: t`Create Import Session`,\n    fields: dataImporterSessionFields(),\n    onFormSuccess: (response: any) => {\n      setSelectedSession(response.pk);\n      setOpened(true);\n      table.refreshTable();\n    }\n  });\n\n  const columns: TableColumn[] = useMemo(() => {\n    return [\n      {\n        accessor: 'model_type',\n        sortable: true\n      },\n      StatusColumn({ model: ModelType.importsession, accessor: 'status' }),\n      {\n        accessor: 'data_file',\n        render: (record: any) => (\n          <AttachmentLink attachment={record.data_file} />\n        ),\n        sortable: false,\n        noContext: true\n      },\n      DateColumn({\n        accessor: 'timestamp',\n        title: t`Uploaded`\n      }),\n      {\n        accessor: 'user',\n        sortable: false,\n        title: t`User`,\n        render: (record: any) => RenderUser({ instance: record.user_detail })\n      },\n      {\n        sortable: false,\n        accessor: 'row_count',\n        title: t`Imported Rows`,\n        render: (record: any) => (\n          <ProgressBar\n            progressLabel={true}\n            value={record.completed_row_count}\n            maximum={record.row_count}\n          />\n        )\n      }\n    ];\n  }, []);\n\n  const modelTypeFilters = useFilters({\n    url: apiUrl(ApiEndpoints.import_session_list),\n    method: 'OPTIONS',\n    accessor: 'data.actions.POST.model_type.choices',\n    transform: (item: any) => {\n      return {\n        value: item.value,\n        label: item.display_name\n      };\n    }\n  });\n\n  const tableFilters: TableFilter[] = useMemo(() => {\n    return [\n      {\n        name: 'model_type',\n        label: t`Model Type`,\n        description: t`Filter by target model type`,\n        choices: modelTypeFilters.choices\n      },\n      {\n        name: 'status',\n        label: t`Status`,\n        description: t`Filter by import session status`,\n        choiceFunction: StatusFilterOptions(ModelType.importsession)\n      },\n      UserFilter({})\n    ];\n  }, [modelTypeFilters.choices]);\n\n  const tableActions = useMemo(() => {\n    return [\n      <AddItemButton\n        key='create-import-session'\n        tooltip={t`Create Import Session`}\n        onClick={() => newImportSession.open()}\n      />\n    ];\n  }, []);\n\n  const rowActions = useCallback((record: any): RowAction[] => {\n    return [\n      RowDeleteAction({\n        onClick: () => {\n          setSelectedSession(record.pk);\n          deleteSession.open();\n        }\n      })\n    ];\n  }, []);\n\n  return (\n    <>\n      {newImportSession.modal}\n      {deleteSession.modal}\n      <InvenTreeTable\n        url={apiUrl(ApiEndpoints.import_session_list)}\n        tableState={table}\n        columns={columns}\n        props={{\n          rowActions: rowActions,\n          tableActions: tableActions,\n          tableFilters: tableFilters,\n          enableBulkDelete: true,\n          enableSelection: true,\n          onRowClick: (record: any) => {\n            setSelectedSession(record.pk);\n            setOpened(true);\n          }\n        }}\n      />\n      <ImporterDrawer\n        sessionId={selectedSession ?? -1}\n        opened={selectedSession !== undefined && opened}\n        onClose={() => {\n          setSelectedSession(undefined);\n          setOpened(false);\n          table.refreshTable();\n        }}\n      />\n    </>\n  );\n}\n"],"names":["ImportSessionTable","table","useTable","opened","setOpened","useState","selectedSession","setSelectedSession","undefined","deleteSession","useDeleteApiFormModal","url","ApiEndpoints","import_session_list","pk","title","_i18n","_","id","newImportSession","useCreateApiFormModal","fields","dataImporterSessionFields","onFormSuccess","response","refreshTable","columns","useMemo","accessor","sortable","StatusColumn","model","ModelType","importsession","render","record","AttachmentLink","data_file","noContext","DateColumn","RenderUser","instance","user_detail","jsx","ProgressBar","completed_row_count","row_count","modelTypeFilters","useFilters","apiUrl","method","transform","item","value","label","display_name","tableFilters","name","description","choices","choiceFunction","StatusFilterOptions","UserFilter","tableActions","AddItemButton","open","rowActions","useCallback","RowDeleteAction","onClick","modal","InvenTreeTable","enableBulkDelete","enableSelection","onRowClick","ImporterDrawer"],"mappings":"8xBAyBA,SAAwBA,GAAqB,CACrCC,MAAAA,EAAQC,EAAS,eAAe,EAEhC,CAACC,EAAQC,CAAS,EAAIC,EAAAA,SAAkB,EAAK,EAE7C,CAACC,EAAiBC,CAAkB,EAAIF,EAAAA,SAC5CG,MACF,EAEMC,EAAgBC,EAAsB,CAC1CC,IAAKC,EAAaC,oBAClBC,GAAIR,EACJS,MAAKC,EAAAC,EAAE,CAAAC,GAAA,QAAA,CAAwB,EAC/BjB,MAAAA,CAAAA,CACD,EAEKkB,EAAmBC,EAAsB,CAC7CT,IAAKC,EAAaC,oBAClBE,MAAKC,EAAAC,EAAE,CAAAC,GAAA,QAAA,CAAwB,EAC/BG,OAAQC,EAA0B,EAClCC,cAAgBC,GAAkB,CAChCjB,EAAmBiB,EAASV,EAAE,EAC9BV,EAAU,EAAI,EACdH,EAAMwB,aAAa,CAAA,CACrB,CACD,EAEKC,EAAyBC,EAAAA,QAAQ,IAC9B,CACL,CACEC,SAAU,aACVC,SAAU,IAEZC,EAAa,CAAEC,MAAOC,EAAUC,cAAeL,SAAU,QAAA,CAAU,EACnE,CACEA,SAAU,YACVM,OAASC,SACNC,EAAe,CAAA,WAAYD,EAAOE,UACpC,EACDR,SAAU,GACVS,UAAW,IAEbC,EAAW,CACTX,SAAU,YACVb,MAAKC,EAAAC,EAAE,CAAAC,GAAA,QAAA,CAAU,CAAC,CACnB,EACD,CACEU,SAAU,OACVC,SAAU,GACVd,MAAKC,EAAAC,EAAE,CAAAC,GAAA,QAAA,CAAO,EACdgB,OAASC,GAAgBK,EAAW,CAAEC,SAAUN,EAAOO,WAAa,CAAA,CAAA,EAEtE,CACEb,SAAU,GACVD,SAAU,YACVb,MAAKC,EAAAC,EAAE,CAAAC,GAAA,QAAA,CAAgB,EACvBgB,OAASC,GACPQ,MAACC,EACC,CAAA,cAAe,GACf,MAAOT,EAAOU,oBACd,QAASV,EAAOW,SAAU,CAAA,CAAA,CAG/B,EAEF,EAAE,EAECC,EAAmBC,EAAW,CAClCrC,IAAKsC,EAAOrC,EAAaC,mBAAmB,EAC5CqC,OAAQ,UACRtB,SAAU,uCACVuB,UAAYC,IACH,CACLC,MAAOD,EAAKC,MACZC,MAAOF,EAAKG,YACd,EACF,CACD,EAEKC,EAA8B7B,EAAAA,QAAQ,IACnC,CACL,CACE8B,KAAM,aACNH,MAAKtC,EAAAC,EAAE,CAAAC,GAAA,QAAA,CAAa,EACpBwC,YAAW1C,EAAAC,EAAE,CAAAC,GAAA,QAAA,CAA8B,EAC3CyC,QAASZ,EAAiBY,OAAAA,EAE5B,CACEF,KAAM,SACNH,MAAKtC,EAAAC,EAAE,CAAAC,GAAA,QAAA,CAAS,EAChBwC,YAAW1C,EAAAC,EAAE,CAAAC,GAAA,QAAA,CAAkC,EAC/C0C,eAAgBC,EAAoB7B,EAAUC,aAAa,CAAA,EAE7D6B,EAAW,CAAA,CAAE,CAAC,EAEf,CAACf,EAAiBY,OAAO,CAAC,EAEvBI,EAAepC,EAAAA,QAAQ,IACpB,CACLgB,EAAAA,IAACqB,EAEC,CAAA,QAAQhD,EAAAC,EAAC,CAAAC,GAAA,QAAA,CAAuB,EAChC,QAAS,IAAMC,EAAiB8C,KAAK,CAAA,EAFjC,wBAGJ,EAEH,EAAE,EAECC,EAAaC,cAAahC,GACvB,CACLiC,EAAgB,CACdC,QAASA,IAAM,CACb9D,EAAmB4B,EAAOrB,EAAE,EAC5BL,EAAcwD,KAAK,CAAA,CACrB,CACD,CAAC,EAEH,EAAE,EAEL,OAEK9C,EAAAA,KAAAA,WAAAA,CAAAA,SAAAA,CAAiBmD,EAAAA,MACjB7D,EAAc6D,MACf3B,EAAAA,IAAC4B,EACC,CAAA,IAAKtB,EAAOrC,EAAaC,mBAAmB,EAC5C,WAAYZ,EACZ,QAAAyB,EACA,MAAO,CACLwC,WAAAA,EACAH,aAAAA,EACAP,aAAAA,EACAgB,iBAAkB,GAClBC,gBAAiB,GACjBC,WAAavC,GAAgB,CAC3B5B,EAAmB4B,EAAOrB,EAAE,EAC5BV,EAAU,EAAI,CAAA,CAChB,EACA,EAEJuC,EAAAA,IAACgC,EACC,CAAA,UAAWrE,GAAmB,GAC9B,OAAQA,IAAoBE,QAAaL,EACzC,QAAS,IAAM,CACbI,EAAmBC,MAAS,EAC5BJ,EAAU,EAAK,EACfH,EAAMwB,aAAa,CAAA,CACnB,CAAA,CAAA,EAEN,CAEJ"}
