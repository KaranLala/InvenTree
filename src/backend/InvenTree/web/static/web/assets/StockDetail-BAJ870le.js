import{i as t,r as o,j as s,a8 as Ve,cx as O,bO as ve,G as B,B as X,bJ as $,bS as be,bx as Te,s as ke,I as Le,as as Oe,bQ as L,bR as We,H as he,eg as Ge,a4 as He,cH as Qe,dz as xe,a6 as Ye,bW as F,eF as Je,eG as Xe,eH as $e,ah as Ze,aV as et,b9 as tt,S as st,n as at}from"./vendor-c9tu_e1b.js";import{A as it}from"./ActionButton-Cn3lAMG1.js";import{b as ae,e as w,A as _,m as l,U as f,f as Ce,h as E}from"./index-C-YqHYR0.js";import{a as Re,p as lt,S as fe,w as nt,I as ye}from"./ThemeContext-CVPHi9Q7.js";import{A as ot}from"./AdminButton-B4su-izZ.js";import{u as ie,I as le,R as rt,a as dt,K as ct,U as ut,y as pt,P as mt,x as _t,O as bt,z as kt,E as ht,D as xt}from"./InvenTreeTable-_nPJoCLK.js";import{I as ft,D as J,a as yt}from"./InstanceDetail-BhafbIJP.js";import{D as C}from"./DetailsBadge-D_E2hPhf.js";import{D as jt,N as gt}from"./NotesPanel-B1Mm8XV0.js";import{N as St}from"./NavigationTree-K03eJObs.js";import{P as At}from"./PageDetail-UrmB-yLk.js";import{A as It}from"./AttachmentPanel-cEo4FCl5.js";import{P as wt}from"./PanelGroup-Dx-tKZpU.js";import{L as vt}from"./LocateItemButton-bK-E8FnL.js";import{b as W,A as Me,q as De,u as Fe,a as Pe,z as je,h as qe,g as se,x as Tt,G as Ct,H as Rt,I as Mt,J as Dt,K as Ft,L as Pt}from"./UseForm-21BEg7Md.js";import{O as qt}from"./OrderPartsWizard-DcOlnycT.js";import{u as ze}from"./DesktopAppView-Bg1vO8uy.js";import{f as ge,a as Se}from"./formatters-1-K9MQML.js";import{c as zt,d as Et,e as Ae,b as Bt,u as Ie,a as Ut,f as Kt}from"./UseStockAdjustActions-PDcplZpx.js";import{u as we}from"./UseInstance-Z-QOK6WR.js";import{B as Nt}from"./BuildAllocatedStockTable-B94pFMpl.js";import{S as Vt}from"./SalesOrderAllocationTable-vwtoQvXI.js";import{P as Lt,S as Ot,D as Ee,N as Wt,k as Be}from"./ColumnRenderers-6-W27ey5.js";import{S as Gt}from"./StockItemTable-BNURu3dq.js";import{q as Ht}from"./index-D1sX3jYA.js";import{P as Qt}from"./YesNoButton-BdKeJbQO.js";import{A as Yt}from"./AttachmentLink-BmXuTpAy.js";import{R as Jt}from"./RowExpansionIcon-DqmbZUQQ.js";import"./QRCode-4MaRh6JQ.js";import"./browser-oJrDmCBJ.js";import"./ModelType-CepomS9H.js";import"./GenericErrorPage-RCGZWWhe.js";import"./NotFound-Cglkc0xC.js";import"./PermissionDenied-D4im8ofc.js";import"./PageTitle-BiZTQEW1.js";import"./PluginSource-CpS38oS9.js";import"./RemoteComponent-BK_-mK5N.js";import"./CompanyForms-DAK9mm-H.js";import"./PurchaseOrderForms-CcRoGXTZ.js";import"./RemoveRowButton-0iZczeVG.js";import"./UseGenerator-DwBNXut7.js";import"./SalesOrderForms-DpTkhoXL.js";function Xt({stockItem:c}){var v;const d=ie("stock_item_install"),p=ae(),j=zt({stockItem:c}),u=W({url:w(_.stock_install),pk:c.pk,title:t._({id:"erPDED"}),table:d,successMessage:t._({id:"g+zcGQ"}),fields:j}),[A,h]=o.useState({}),n=Et(),e=W({url:w(_.stock_uninstall),pk:A.pk,title:t._({id:"q2BZiX"}),table:d,successMessage:t._({id:"ibtYlF"}),fields:n,initialData:{location:c.location??((v=c.part_detail)==null?void 0:v.default_location)}}),x=o.useMemo(()=>[{accessor:"part",switchable:!1,render:b=>Lt({part:b==null?void 0:b.part_detail})},{accessor:"quantity",switchable:!1,render:b=>{let R=b.quantity;return b.serial&&b.quantity==1&&(R=`# ${b.serial}`),R}},{accessor:"batch",switchable:!1},Ot({model:l.stockitem})],[]),I=o.useMemo(()=>{var b;return[s.jsx(Me,{tooltip:t._({id:"erPDED"}),onClick:()=>{u.open()},hidden:!p.hasChangeRole(f.stock)||c.is_building||((b=c.part_detail)==null?void 0:b.assembly)!=!0},"install")]},[c,p]),y=o.useCallback(b=>[{title:t._({id:"fo0VXg"}),tooltip:t._({id:"mGSvSz"}),onClick:()=>{h(b),e.open()},icon:s.jsx(Ve,{}),hidden:!p.hasChangeRole(f.stock)}],[p]);return s.jsxs(s.Fragment,{children:[u.modal,e.modal,c.pk?s.jsx(le,{url:w(_.stock_item_list),tableState:d,columns:x,props:{tableActions:I,enableSelection:!0,enableLabels:!0,enableReports:!0,rowActions:y,modelType:l.stockitem,params:{belongs_to:c.pk,part_detail:!0}}}):s.jsx(O,{})]})}function $t({partId:c,itemId:d}){const p=ze(),j=ae(),u=ie("stocktests"),A=Ce(),h=o.useMemo(()=>A.isSet("TEST_STATION_DATA"),[A]),{data:n}=ve({queryKey:["stocktesttemplates",c,d],queryFn:async()=>c?p.get(w(_.part_test_template_list),{params:{part:c,include_inherited:!0,enabled:!0}}).then(r=>r.data):[]});o.useEffect(()=>{u.refreshTable()},[n]);const e=o.useCallback(r=>{const a=(n==null?void 0:n.map(k=>({...k,templateId:k.pk,results:[]})))??[];return r.forEach(k=>{a.find(g=>g.templateId==k.template)||a.push({...k.template_detail,templateId:k.template,results:[]})}),r.sort((k,g)=>k.pk>g.pk?1:-1).forEach(k=>{const g=a.findIndex(D=>D.templateId==k.template);g>=0&&(a[g]={...a[g],...k},a[g].results.push(k))}),a},[c,d,n]),x=o.useCallback(r=>[{accessor:"test",title:t._({id:"NnH3pK"}),switchable:!1,sortable:!0,render:a=>{var Q,N;const k=a.enabled??((Q=a.template_detail)==null?void 0:Q.enabled),g=a.stock_item!=null&&a.stock_item!=d,D=a.results&&a.results.length>1;return s.jsxs(B,{justify:"space-between",wrap:"nowrap",children:[!r&&s.jsx(Jt,{enabled:D,expanded:u.isRowExpanded(a.pk)}),s.jsxs(X,{style:{fontStyle:g?"italic":void 0},c:k?void 0:"red",children:[!a.templateId&&"- ",a.test_name??((N=a.template_detail)==null?void 0:N.test_name)]}),s.jsxs(B,{justify:"right",children:[a.results&&a.results.length>1&&s.jsx($,{label:t._({id:"isbwWo"}),children:s.jsx(be,{color:"lightblue",variant:"filled",children:a.results.length})}),g&&s.jsx($,{label:t._({id:"yd1WJ/"}),children:s.jsx(Te,{size:16,color:"blue"})})]})]})}},{accessor:"result",title:t._({id:"RD6AE9"}),switchable:!1,sortable:!0,render:a=>a.result===void 0?s.jsx(be,{color:"lightblue",variant:"filled",children:t._({id:"4bobEy"})}):s.jsx(Qt,{value:a.result})},Ee({}),{accessor:"value",title:t._({id:"wMHvYH"})},{accessor:"attachment",title:t._({id:"UY1vmE"}),render:a=>a.attachment&&s.jsx(Yt,{attachment:a.attachment}),noContext:!0},Wt({}),Be({}),{accessor:"user",title:t._({id:"7PzzBU"}),sortable:!1,render:a=>a.user_detail&&s.jsx(De,{instance:a.user_detail})},{accessor:"test_station",sortable:!0,title:t._({id:"18Lf3c"}),hidden:!h},{accessor:"started_datetime",sortable:!0,title:t._({id:"JEGlfK"}),hidden:!h,render:a=>s.jsx(B,{justify:"space-between",children:ge(a.started_datetime,{showTime:!0,showSeconds:!0})})},{accessor:"finished_datetime",sortable:!0,title:t._({id:"4dQFvz"}),hidden:!h,render:a=>s.jsx(B,{justify:"space-between",children:ge(a.finished_datetime,{showTime:!0,showSeconds:!0})})}],[d,h,u.expandedRecords]),I=o.useMemo(()=>x(!1),[d,h,u.expandedRecords]),[y,v]=o.useState(void 0),b=Ae({partId:c,itemId:d,templateId:y,editing:!1}),R=Ae({partId:c,itemId:d,templateId:y,editing:!0}),M=W({url:_.stock_test_result_list,fields:o.useMemo(()=>({...b}),[b]),initialData:{template:y,result:!0},title:t._({id:"VzkBcq"}),table:u,successMessage:t._({id:"VivtT0"})}),[P,q]=o.useState(0),U=Fe({url:_.stock_test_result_list,pk:P,fields:o.useMemo(()=>({...R}),[R]),title:t._({id:"1HKt5e"}),onFormSuccess:()=>u.refreshTable,successMessage:t._({id:"G0v/SO"})}),G=Pe({url:_.stock_test_result_list,pk:P,title:t._({id:"381PhV"}),table:u,successMessage:t._({id:"xbuMqN"})}),Z=o.useCallback(r=>{p.post(w(_.stock_test_result_list),{template:r,stock_item:d,result:!0}).then(()=>{u.refreshTable(),ke({title:t._({id:"uUlW4e"}),message:t._({id:"uiR3yF"}),color:"green"})}).catch(()=>{ke({title:t._({id:"SlfejT"}),message:t._({id:"VjER3N"}),color:"red"})})},[d]),H=o.useCallback(r=>r.stock_item!=null&&r.stock_item!=d?[]:[{title:t._({id:"up/ozE"}),color:"green",icon:s.jsx(Le,{}),hidden:!r.templateId||(r==null?void 0:r.requires_attachment)||(r==null?void 0:r.requires_value)||r.result,onClick:()=>Z(r.templateId)},{title:t._({id:"m16xKo"}),tooltip:t._({id:"VzkBcq"}),color:"green",icon:s.jsx(Oe,{}),hidden:!j.hasAddRole(f.stock)||!r.templateId,onClick:()=>{v(r.templateId),M.open()}},rt({tooltip:t._({id:"1HKt5e"}),hidden:!j.hasChangeRole(f.stock)||!r.template_detail,onClick:()=>{q(r.pk),U.open()}}),dt({tooltip:t._({id:"381PhV"}),hidden:!j.hasDeleteRole(f.stock)||!r.template_detail,onClick:()=>{q(r.pk),G.open()}})],[j,d]),K=o.useMemo(()=>[{name:"required",label:t._({id:"TMLAx2"}),description:t._({id:"sKK8za"})},{name:"include_installed",label:t._({id:"TD72EF"}),description:t._({id:"BYeSw1"})},{name:"result",label:t._({id:"nqMwPi"}),description:t._({id:"bcwRe2"})},{name:"enabled",label:t._({id:"RxzN1M"}),description:t._({id:"+kMQXd"})}],[]),ee=o.useMemo(()=>[s.jsx(Me,{tooltip:t._({id:"VzkBcq"}),onClick:()=>{v(void 0),M.open()},hidden:!j.hasAddRole(f.stock)},"add-test-result")],[j]),te=o.useMemo(()=>{const r=[...x(!0),{accessor:"actions",title:"  ",hidden:!1,switchable:!1,width:50,render:a=>s.jsx(ct,{actions:H(a)??[]})}];return{allowMultiple:!0,expandable:({record:a})=>u.isRowExpanded(a.pk)||a.results&&a.results.length>1,content:({record:a})=>{if(!a||!a.results||a.results.length<2)return null;const k=(a==null?void 0:a.results)??[];return s.jsx(Ht,{idAccessor:"test",noHeader:!0,columns:r,records:k.slice(0,-1)},a.pk)}}},[x,u.isRowExpanded]);return s.jsxs(s.Fragment,{children:[M.modal,U.modal,G.modal,s.jsx(le,{url:w(_.stock_test_result_list),tableState:u,columns:I,props:{dataFormatter:e,enablePagination:!1,tableActions:ee,tableFilters:K,rowActions:H,rowExpansion:te,params:{stock_item:d,user_detail:!0,attachment_detail:!0,template_detail:!0}}})]})}function Zt({itemId:c}){const d=Re(),p=ie("stock_tracking"),j=o.useCallback(h=>{const n=(h==null?void 0:h.deltas)??{},e=[{label:t._({id:"igx8Og"}),key:"stockitem",details:n.stockitem_detail&&je({instance:n.stockitem_detail,link:!0})},{label:t._({id:"igx8Og"}),key:"item",details:n.item_detail&&je({instance:n.item_detail,link:!0})},{label:t._({id:"uAQUqI"}),key:"status",details:n.status&&qe({status:n.status,type:l.stockitem})},{label:t._({id:"VbWX2u"}),key:"quantity",details:se(n.quantity)},{label:t._({id:"hp8OtS"}),key:"added",details:n.added},{label:t._({id:"eps54V"}),key:"removed",details:n.removed},{label:t._({id:"vgP+9p"}),key:"part",details:n.part_detail&&Tt({instance:n.part_detail,link:!0,navigate:d})},{label:t._({id:"wJijgU"}),key:"location",details:n.location_detail&&Ct({instance:n.location_detail,link:!0,navigate:d})},{label:t._({id:"YxwWvi"}),key:"buildorder",details:n.buildorder_detail&&Rt({instance:n.buildorder_detail,link:!0,navigate:d})},{label:t._({id:"KxySMG"}),key:"purchaseorder",details:n.purchaseorder_detail&&Mt({instance:n.purchaseorder_detail,link:!0,navigate:d})},{label:t._({id:"LozYBo"}),key:"salesorder",details:n.salesorder_detail&&Dt({instance:n.salesorder_detail,link:!0,navigate:d})},{label:t._({id:"Z6ve1w"}),key:"returnorder",details:n.returnorder_detail&&Ft({instance:n.returnorder_detail,link:!0,navigate:d})},{label:t._({id:"876pfE"}),key:"customer",details:n.customer_detail&&Pt({instance:n.customer_detail,link:!0,navigate:d})}];return s.jsx(L,{striped:!0,children:s.jsx(L.Tbody,{children:e.map(x=>x.details&&s.jsxs(L.Tr,{children:[s.jsx(L.Td,{children:s.jsx(X,{children:x.label})}),s.jsx(L.Td,{children:x.details})]},x.key))})})},[d]),u=o.useMemo(()=>[ut({name:"user",label:t._({id:"7PzzBU"}),description:t._({id:"FVjW63"})})],[]),A=o.useMemo(()=>[Be({switchable:!1}),Ee({accessor:"label"}),{accessor:"details",title:t._({id:"URmyfc"}),switchable:!1,render:j},{accessor:"notes",title:t._({id:"1DBGsz"}),sortable:!1,switchable:!0},{accessor:"user",title:t._({id:"7PzzBU"}),render:h=>h.user_detail?De({instance:h.user_detail}):s.jsx(X,{size:"sm",fs:"italic",children:t._({id:"L5d7xh"})})}],[]);return s.jsx(le,{tableState:p,url:w(_.stock_tracking_list),columns:A,props:{params:{item:c,user_detail:!0},enableDownload:!0,tableFilters:u}})}function Vs(){var re,de,ce,ue;const{id:c}=lt(),d=ze(),p=ae(),j=Ce(),u=o.useMemo(()=>j.isSet("STOCK_ENABLE_EXPIRY"),[j]),A=Re(),[h,n]=o.useState(!1),{instance:e,refreshInstance:x,instanceQuery:I}=we({endpoint:_.stock_item_list,pk:c,params:{part_detail:!0,location_detail:!0,path_detail:!0}}),{instance:y,instanceQuery:v}=we({endpoint:_.stock_serial_info,pk:c}),b=Bt({partId:e.part}),R=o.useMemo(()=>{var pe,me;const i={...e},m=(e==null?void 0:e.part_detail)??{};if(i.available_stock=Math.max(0,i.quantity-i.allocated),I.isFetching)return s.jsx(O,{});const T=[{name:"part",label:t._({id:"mY+KgP"}),type:"link",model:l.part},{name:"part_detail.IPN",label:t._({id:"3wXEsN"}),type:"text",copy:!0,icon:"part",hidden:!m.IPN},{name:"status",type:"status",label:t._({id:"uAQUqI"}),model:l.stockitem},{name:"status_custom_key",type:"status",label:t._({id:"4DvUAJ"}),model:l.stockitem,icon:"status",hidden:!e.status_custom_key||e.status_custom_key==e.status},{type:"text",name:"updated",icon:"calendar",label:t._({id:"K7P0jz"})},{type:"text",name:"stocktake",icon:"calendar",label:t._({id:"whZ7zT"}),hidden:!e.stocktake}],z=[{type:"text",name:"serial",label:t._({id:"AXeJt4"}),hidden:!e.serial,value_formatter:()=>{var S,V;return s.jsxs(B,{gap:"xs",justify:"space-apart",children:[s.jsx(X,{children:e.serial}),s.jsx(We,{flex:10}),s.jsxs(B,{gap:2,justify:"right",children:[((S=y.previous)==null?void 0:S.pk)&&s.jsx($,{label:t._({id:"6nb2iE"}),position:"top",children:s.jsx(he,{p:3,"aria-label":"previous-serial-number",leftSection:s.jsx(Ge,{}),variant:"transparent",size:"sm",onClick:()=>{A(E(l.stockitem,y.previous.pk))},children:y.previous.serial})}),s.jsx(it,{icon:s.jsx(He,{size:18}),tooltip:t._({id:"jfMcvL"}),tooltipAlignment:"top",variant:"transparent",onClick:b.open}),((V=y.next)==null?void 0:V.pk)&&s.jsx($,{label:t._({id:"TVYdHj"}),position:"top",children:s.jsx(he,{p:3,"aria-label":"next-serial-number",rightSection:s.jsx(Qe,{}),variant:"transparent",size:"sm",onClick:()=>{A(E(l.stockitem,y.next.pk))},children:y.next.serial})})]})]})}},{type:"number",name:"quantity",label:t._({id:"VbWX2u"}),unit:m==null?void 0:m.units,hidden:!!e.serial&&e.quantity==1},{type:"number",name:"available_stock",label:t._({id:"csDS2L"}),unit:m==null?void 0:m.units,icon:"stock"},{type:"number",name:"allocated",label:t._({id:"8oSGoC"}),unit:m==null?void 0:m.units,icon:"tick_off",hidden:!e.allocated},{type:"text",name:"batch",label:t._({id:"Vea6Aj"}),hidden:!e.batch}],Y=[{name:"supplier_part",label:t._({id:"nne72x"}),type:"link",model_field:"SKU",model:l.supplierpart,hidden:!e.supplier_part},{type:"link",name:"location",label:t._({id:"wJijgU"}),model:l.stocklocation,hidden:!e.location},{type:"link",name:"belongs_to",label:t._({id:"QPoAhl"}),model_filters:{part_detail:!0},model_formatter:S=>{var _e;let V=((_e=S==null?void 0:S.part_detail)==null?void 0:_e.full_name)??(S==null?void 0:S.name);return S.serial&&S.quantity==1&&(V+=` # ${S.serial}`),V},icon:"stock",model:l.stockitem,hidden:!e.belongs_to},{type:"link",name:"parent",icon:"sitemap",label:t._({id:"0o0T0n"}),model:l.stockitem,hidden:!e.parent,model_formatter:S=>t._({id:"94QKKW"})},{type:"link",name:"consumed_by",label:t._({id:"H00rnl"}),model:l.build,hidden:!e.consumed_by,icon:"build",model_field:"reference"},{type:"link",name:"build",label:t._({id:"YxwWvi"}),model:l.build,hidden:!e.build,model_field:"reference"},{type:"link",name:"purchase_order",label:t._({id:"KxySMG"}),model:l.purchaseorder,hidden:!e.purchase_order,icon:"purchase_orders",model_field:"reference"},{type:"link",name:"sales_order",label:t._({id:"LozYBo"}),model:l.salesorder,hidden:!e.sales_order,icon:"sales_orders",model_field:"reference"},{type:"link",name:"customer",label:t._({id:"876pfE"}),model:l.company,hidden:!e.customer}],Ne=[{type:"date",name:"expiry_date",label:t._({id:"uaSvqt"}),hidden:!u||!e.expiry_date,icon:"calendar"},{type:"text",name:"purchase_price",label:t._({id:"vWelsN"}),icon:"currency",hidden:!e.purchase_price,value_formatter:()=>Se(e.purchase_price,{currency:e.purchase_price_currency})},{type:"text",name:"stock_value",label:t._({id:"g9RfVq"}),icon:"currency",hidden:!e.purchase_price||e.quantity==1||e.quantity==0,value_formatter:()=>Se(e.purchase_price,{currency:e.purchase_price_currency,multiplier:e.quantity})},{type:"text",name:"packaging",icon:"part",label:t._({id:"pD/Ew0"}),hidden:!e.packaging}];return s.jsxs(ft,{children:[s.jsxs(xe,{grow:!0,children:[s.jsx(jt,{appRole:f.part,apiPath:_.part_list,src:((pe=e.part_detail)==null?void 0:pe.image)??((me=e==null?void 0:e.part_detail)==null?void 0:me.thumbnail),pk:e.part}),s.jsx(xe.Col,{span:{base:12,sm:8},children:s.jsx(J,{fields:T,item:i})})]}),s.jsx(J,{fields:z,item:i}),s.jsx(J,{fields:Y,item:i}),s.jsx(J,{fields:Ne,item:i})]})},[e,y,v.isFetching,I.isFetching,u]),M=o.useMemo(()=>{var i;return((i=e==null?void 0:e.part_detail)==null?void 0:i.component)&&!(e!=null&&e.sales_order)&&!(e!=null&&e.belongs_to)},[e]),P=o.useMemo(()=>{var i;return(i=e==null?void 0:e.part_detail)==null?void 0:i.salable},[e]),q=ve({queryKey:["tracked-bom-item",e.pk,e.part],queryFn:()=>{var i;return!e.pk||!e.part||!((i=e.part_detail)!=null&&i.assembly)?!1:d.get(w(_.bom_list),{params:{part:e.part,sub_part_trackable:!0,limit:1}}).then(m=>m.status==200?m.data.count>0:null)}}),U=o.useMemo(()=>{var i;return e!=null&&e.installed_items?!0:q.data?q.data:(i=e==null?void 0:e.part_detail)==null?void 0:i.assembly},[q,e]),G=o.useMemo(()=>{var i;return[{name:"details",label:t._({id:"hBG+yp"}),icon:s.jsx(Te,{}),content:R},{name:"tracking",label:t._({id:"IdrYoA"}),icon:s.jsx(Ye,{}),content:e.pk?s.jsx(Zt,{itemId:e.pk}):s.jsx(O,{})},{name:"allocations",label:t._({id:"KwhnxF"}),icon:s.jsx(Je,{}),hidden:!e.in_stock||!P&&!M,content:s.jsxs(F,{multiple:!0,defaultValue:["buildAllocations","salesAllocations"],children:[M&&s.jsxs(F.Item,{value:"buildAllocations",children:[s.jsx(F.Control,{children:s.jsx(fe,{size:"lg",children:t._({id:"KCpl4N"})})}),s.jsx(F.Panel,{children:s.jsx(Nt,{stockId:e.pk,modelField:"build",modelTarget:l.build,showBuildInfo:!0})})]},"buildAllocations"),P&&s.jsxs(F.Item,{value:"salesAllocations",children:[s.jsx(F.Control,{children:s.jsx(fe,{size:"lg",children:t._({id:"DaWMWw"})})}),s.jsx(F.Panel,{children:s.jsx(Vt,{stockId:e.pk,modelField:"order",modelTarget:l.salesorder,showOrderInfo:!0})})]},"salesAllocations")]})},{name:"testdata",label:t._({id:"dljGeD"}),icon:s.jsx(Xe,{}),hidden:!((i=e==null?void 0:e.part_detail)!=null&&i.testable),content:e!=null&&e.pk?s.jsx($t,{itemId:e.pk,partId:e.part}):s.jsx(O,{})},{name:"installed_items",label:t._({id:"xnskHi"}),icon:s.jsx($e,{}),hidden:!U,content:s.jsx(Xt,{stockItem:e})},{name:"child_items",label:t._({id:"K4v96J"}),icon:s.jsx(Ze,{}),hidden:((e==null?void 0:e.child_items)??0)==0,content:e!=null&&e.pk?s.jsx(Gt,{tableName:"child-stock",params:{ancestor:e.pk}}):s.jsx(O,{})},It({model_type:l.stockitem,model_id:e.pk}),gt({model_type:l.stockitem,model_id:e.pk})]},[P,M,U,e,y,v,c,p]),Z=o.useMemo(()=>[{name:t._({id:"blbbPS"}),url:"/stock"},...(e.location_path??[]).map(i=>({name:i.name,url:E(l.stocklocation,i.pk)}))],[e]),H=Ie({create:!1,stockItem:e,partId:e.part,modalId:"edit-stock-item"}),K=Fe({url:_.stock_item_list,pk:e.pk,title:t._({id:"gQgYNs"}),modalId:"edit-stock-item",fields:H,onFormSuccess:x}),ee=Ie({create:!0,modalId:"duplicate-stock-item"}),te=o.useMemo(()=>{const i={...e,serial_numbers:e.serial};return delete i.serial,i},[e]),r=W({url:_.stock_item_list,title:t._({id:"bJLEQT"}),modalId:"duplicate-stock-item",fields:ee,initialData:{...te},follow:!0,successMessage:null,modelType:l.stockitem,onFormSuccess:i=>{var m;if(Array.isArray(i)&&i.length>0)if(i.length==1)A(E(l.stockitem,(m=i[0])==null?void 0:m.pk));else{const T=i.length;at.show({title:t._({id:"7Vas0a"}),message:t._({id:"DHdcSX",values:{n:T}}),color:"green"})}}}),a=o.useMemo(()=>{},[e]),k=Pe({url:_.stock_item_list,pk:e.pk,title:t._({id:"BJoa27"}),preFormContent:a,onFormSuccess:()=>{A(E(l.part,e.part))}}),g=o.useMemo(()=>({items:[e],model:l.stockitem,refresh:x,filters:{in_stock:!0}}),[e]),D=Ut({formProps:g,delete:!1,assign:!!e.in_stock,return:!!e.consumed_by||!!e.customer,merge:!1}),Q=Kt({partId:e.part,trackable:(re=e.part_detail)==null?void 0:re.trackable,modalId:"stock-item-serialize"}),N=W({url:_.stock_serialize,pk:e.pk,title:t._({id:"ETKLHa"}),modalId:"stock-item-serialize",fields:Q,initialData:{quantity:e.quantity,destination:e.location??((de=e.part_detail)==null?void 0:de.default_location)},onFormSuccess:i=>{i.length>=e.quantity?A(E(l.stockitem,i[0].pk)):x()},successMessage:t._({id:"Hkw/xj"})}),ne=qt({parts:e.part_detail?[e.part_detail]:[]}),oe=nt({title:t._({id:"kiz1mM"}),modelType:l.stocklocation,callback:async(i,m)=>{const T=m.stocklocation.pk;return d.post(w(_.stock_transfer),{location:T,items:[{pk:e.pk,quantity:e.quantity}]}).then(()=>(x(),{success:t._({id:"vdb1YW"})})).catch(z=>(console.log("Error scanning stock item:",z),{error:t._({id:"TL3ZFM"})}))}}),Ue=o.useMemo(()=>{var T,z,Y;p.hasChangeRole(f.stock)&&!e.sales_order&&!e.belongs_to&&!e.customer&&e.consumed_by,e.is_building;const i=e.serial,m=i!=null&&i!=null&&i!=""&&e.quantity==1;return[s.jsx(ot,{model:l.stockitem,id:e.pk}),s.jsx(vt,{stockId:e.pk}),s.jsx(pt,{model:l.stockitem,pk:e.pk,hash:e==null?void 0:e.barcode_hash,perm:p.hasChangeRole(f.stock),actions:[{name:t._({id:"MeG2ih"}),icon:s.jsx(ye,{icon:"location"}),tooltip:t._({id:"8Otzst"}),onClick:oe.open}]}),s.jsx(mt,{modelType:l.stockitem,items:[e.pk],enableReports:!0,enableLabels:!0}),s.jsx(_t,{tooltip:t._({id:"ClJC3x"}),icon:s.jsx(tt,{}),actions:[...D.menuActions,{name:t._({id:"Wlr+mY"}),tooltip:t._({id:"Vmnyam"}),hidden:m||(e==null?void 0:e.quantity)<1||((T=e==null?void 0:e.part_detail)==null?void 0:T.trackable)!=!0,icon:s.jsx(ye,{icon:"serial",iconProps:{color:"blue"}}),onClick:()=>{N.open()}},{name:t._({id:"UYUgdb"}),tooltip:t._({id:"cUzrZK"}),hidden:!p.hasAddRole(f.purchase_order)||!((z=e.part_detail)!=null&&z.active)||!((Y=e.part_detail)!=null&&Y.purchaseable),icon:s.jsx(et,{color:"blue"}),onClick:()=>{ne.openWizard()}}]}),s.jsx(bt,{tooltip:t._({id:"oPF3fX"}),actions:[kt({hidden:!p.hasAddRole(f.stock),onClick:()=>r.open()}),ht({hidden:!p.hasChangeRole(f.stock),onClick:()=>K.open()}),xt({hidden:!p.hasDeleteRole(f.stock),onClick:()=>k.open()})]})]},[c,e,p,D.menuActions]),Ke=o.useMemo(()=>{let i=((e==null?void 0:e.quantity)??0)-((e==null?void 0:e.allocated)??0);return i=Math.max(0,i),I.isLoading?[]:[s.jsx(C,{color:"yellow",label:t._({id:"BE5Q6v"}),visible:e.is_building}),s.jsx(C,{color:"blue",label:`${t._({id:"AXeJt4"})}: ${e.serial}`,visible:!!e.serial},"serial"),s.jsx(C,{color:"blue",label:`${t._({id:"VbWX2u"})}: ${se(e.quantity)}`,visible:!e.serial},"quantity"),s.jsx(C,{color:"yellow",label:`${t._({id:"csDS2L"})}: ${se(i)}`,visible:e.in_stock&&!e.serial&&i!=e.quantity},"available"),s.jsx(C,{color:"blue",label:`${t._({id:"Vea6Aj"})}: ${e.batch}`,visible:!!e.batch},"batch"),s.jsx(qe,{status:e.status_custom_key||e.status,type:l.stockitem,options:{size:"lg"}},"status"),s.jsx(C,{color:"yellow",label:t._({id:"1ba70W"}),visible:u&&e.stale&&!e.expired},"stale"),s.jsx(C,{color:"orange",label:t._({id:"M1RnFv"}),visible:u&&e.expired},"expired"),s.jsx(C,{color:"red",label:t._({id:"jqzUyM"}),visible:e.in_stock==!1},"unavailable")]},[e,I,u]);return s.jsxs(s.Fragment,{children:[b.modal,oe.dialog,s.jsx(yt,{query:I,requiredPermission:l.stockitem,children:s.jsxs(st,{children:[p.hasViewRole(f.stock_location)&&s.jsx(St,{title:t._({id:"1eBWAw"}),modelType:l.stocklocation,endpoint:_.stock_location_tree,opened:h,onClose:()=>n(!1),selectedId:e==null?void 0:e.location}),s.jsx(At,{title:t._({id:"igx8Og"}),subtitle:(ce=e.part_detail)==null?void 0:ce.full_name,imageUrl:(ue=e.part_detail)==null?void 0:ue.thumbnail,editAction:K.open,editEnabled:p.hasChangePermission(l.stockitem),badges:Ke,breadcrumbs:p.hasViewRole(f.stock_location)?Z:void 0,lastCrumb:[{name:e.name,url:`/stock/item/${e.pk}/`}],breadcrumbAction:()=>{n(!0)},actions:Ue}),s.jsx(wt,{pageKey:"stockitem",panels:G,model:l.stockitem,id:e.pk,instance:e})]})}),K.modal,r.modal,k.modal,N.modal,D.modals.map(i=>i.modal),ne.wizard]})}export{Vs as default};
//# sourceMappingURL=StockDetail-BAJ870le.js.map
