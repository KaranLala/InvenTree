import{b$ as ln,r,s as Le,bO as $,j as n,i as t,n as Z,d as Oe,I as an,du as cn,by as Be,bc as he,ae as Ie,cw as v,cN as ae,bJ as z,H as ee,cy as dn,aA as ze,aG as un,a8 as mn,dC as fn,dD as pn,au as hn,cH as He,bK as q,aw as gn,b7 as xn,b_ as _n,K as Cn,cI as jn,c5 as Pe,cY as qe,a4 as bn,dE as yn,bP as ge,cL as Fn,cE as kn,bR as Ue,S as K,B as U,Y as Ne,G,bS as wn,c0 as Ve,aB as Tn,bU as Re,cs as vn,bd as An,dc as oe,dF as In,dG as Rn,F as En}from"./vendor-c9tu_e1b.js";import{u as xe,a as Mn}from"./DesktopAppView-Bg1vO8uy.js";import{e as D,A as L,d as Sn,C as Ee,o as Ge,f as _e,a as Dn,h as ce,n as de,p as ne,m as N,y as Ln,z as ue,u as On,E as Me}from"./index-C-YqHYR0.js";import{I as Ke,q as Bn,S as Ce,k as me,r as zn,a as Hn,t as Pn}from"./ThemeContext-CVPHi9Q7.js";import{P as Se,I as qn,q as Un}from"./index-D1sX3jYA.js";import{b as fe,e as je,d as Nn,D as Vn,S as Gn,a as Kn,m as Yn}from"./UseForm-21BEg7Md.js";import{A as Qn}from"./ActionButton-Cn3lAMG1.js";import{I as $n,Q as Jn,a as Xn}from"./QRCode-4MaRh6JQ.js";function pe({title:s,id:e}){const i=xe(),c=ln(),[o,u]=r.useState(!1);r.useEffect(()=>{e?(u(!0),Le({id:`data-output-${e}`,title:s,loading:!0,autoClose:!1,withCloseButton:!1,message:n.jsx(Se,{size:"lg",value:0,progressLabel:!0})})):u(!1)},[e,s]),$({enabled:!!e&&o&&c==="visible",refetchInterval:500,queryKey:["data-output",e,s],queryFn:()=>i.get(D(L.data_output,e)).then(p=>{var x;const m=(p==null?void 0:p.data)??{};if(m.errors||m.error){u(!1);const l=(m==null?void 0:m.error)??((x=m==null?void 0:m.errors)==null?void 0:x.error)??t._({id:"gzjOvt"});Z.update({id:`data-output-${e}`,loading:!1,icon:n.jsx(Oe,{}),autoClose:2500,title:s,message:l,color:"red"})}else if(m.complete){if(u(!1),Z.update({id:`data-output-${e}`,loading:!1,autoClose:2500,title:s,message:t._({id:"TCOQbo"}),color:"green",icon:n.jsx(an,{})}),m.output){const l=Sn(m.output);window.open(l.toString(),"_blank")}}else Z.update({id:`data-output-${e}`,loading:!0,autoClose:!1,withCloseButton:!1,message:n.jsx(Se,{size:"lg",maximum:m.total,value:m.progress,progressLabel:m.total>0,animated:!0})});return m}).catch(()=>(u(!1),Z.update({id:`data-output-${e}`,loading:!1,autoClose:2500,title:s,message:t._({id:"gzjOvt"}),color:"red"}),{}))})}function be({icon:s,tooltip:e,tooltipPosition:i,actions:c,disabled:o=!1,hidden:u=!1,noindicator:p=!1}){const m=r.useMemo(()=>c.some(h=>!h.hidden),[c]),x=r.useMemo(()=>c.find(h=>h.indicator),[c]),l=r.useMemo(()=>Ee(`action-menu-${e}`),[e]);return!u&&m?n.jsxs(v,{position:"bottom-end",children:[n.jsx(ae,{disabled:!x,...x==null?void 0:x.indicator,children:n.jsx(v.Target,{children:n.jsx(z,{label:e,hidden:!e,position:i??"bottom",children:n.jsx(ee,{variant:p?"transparent":"light",disabled:o,"aria-label":l,p:"0",size:"sm",rightSection:p?null:n.jsx(dn,{stroke:1.5}),styles:{section:{margin:0}},children:s})})})}),n.jsx(v.Dropdown,{children:c.map(h=>{const y=Ee(`${l}-${h.name}`);return h.hidden?null:r.createElement(ae,{disabled:!h.indicator,...h.indicator,key:h.name},n.jsx(z,{label:h.tooltip,hidden:!h.tooltip,position:"left",children:n.jsx(v.Item,{"aria-label":y,leftSection:h.icon,onClick:h.onClick,disabled:h.disabled,children:h.name})}))})})]},l):null}function Ft({actions:s=[],tooltip:e=t._({id:"0zpgxV"}),hidden:i=!1}){return n.jsx(be,{icon:n.jsx(cn,{}),tooltip:e,actions:s,hidden:i,noindicator:!0})}function kt({model:s,pk:e,hash:i=null,actions:c=[],perm:o=!0}){const u=i===null,p={model:s,pk:e,hash:i};return n.jsx(be,{tooltip:t._({id:"heU0Hk"}),icon:n.jsx(Ie,{}),actions:[le({mdl_prop:p,title:t._({id:"mYTVOy"}),icon:n.jsx(Ie,{}),tooltip:t._({id:"PuPuVa"}),ChildItem:$n}),le({hidden:u||i||!o,mdl_prop:p,title:t._({id:"3Bbgw2"}),icon:n.jsx(un,{}),tooltip:t._({id:"utafdp"}),ChildItem:Jn}),le({hidden:u||!i||!o,mdl_prop:p,title:t._({id:"ut1J8k"}),icon:n.jsx(mn,{}),tooltip:t._({id:"AlfG1i"}),ChildItem:Xn}),...c]})}function le({hidden:s=!1,mdl_prop:e,title:i,icon:c,tooltip:o,ChildItem:u}){return{icon:c,name:i,tooltip:o,onClick:()=>{Bn.open({title:n.jsx(Ce,{size:"xl",children:i}),children:n.jsx(u,{mdl_prop:e})})},hidden:s}}function wt(s){return{...s,icon:n.jsx(Be,{color:"blue"}),name:t._({id:"ePK91l"}),tooltip:s.tooltip??t._({id:"Qpg4KV"})}}function Tt(s){return{...s,icon:n.jsx(he,{color:"red"}),name:t._({id:"cnGeoo"}),tooltip:s.tooltip??t._({id:"ZatbPe"})}}function vt(s){return{...s,icon:n.jsx(Ke,{icon:"hold",iconProps:{color:"orange"}}),name:t._({id:"YJMNeo"}),tooltip:s.tooltip??t._({id:"YJMNeo"})}}function At(s){return{...s,icon:n.jsx(Ke,{icon:"cancel",iconProps:{color:"red"}}),name:t._({id:"dEgA5A"}),tooltip:s.tooltip??t._({id:"dEgA5A"})}}function It(s){return{...s,icon:n.jsx(ze,{color:"green"}),name:t._({id:"euc6Ns"}),tooltip:s.tooltip??t._({id:"QXHPgY"})}}function Wn({items:s,hidden:e,enableLabels:i,enableReports:c,modelType:o}){const u=Ge(),p=_e(),m=r.useMemo(()=>s.length>0,[s]),[x,l]=r.useState(""),h=r.useMemo(()=>i&&p.isSet("LABEL_ENABLE"),[i,p]),y=r.useMemo(()=>c&&p.isSet("REPORT_ENABLE"),[c,p]),[I,_]=r.useState(void 0),[b,F]=r.useState(void 0);pe({title:t._({id:"5cY8gX"}),id:I}),pe({title:t._({id:"T6GYw9"}),id:b});const A=$({enabled:h,queryKey:["printingFields",o,x],gcTime:500,queryFn:()=>Dn.options(D(L.label_print),{params:{plugin:x||void 0}}).then(w=>je(w,"POST")||{})}),H=r.useMemo(()=>{const w=A.data||{};return w.template={...w.template,autoFill:!0,filters:{enabled:!0,model_type:o,items:s.join(",")}},w.items={...w.items,value:s,hidden:!0},w.plugin={...w.plugin,value:u.getSetting("LABEL_DEFAULT_PRINTER"),filters:{active:!0,mixin:"labels"},onValueChange:(k,C)=>{C!=null&&C.key&&(C==null?void 0:C.key)!=x&&l(C.key)}},w},[A.data,s]),O=fe({url:D(L.label_print),title:t._({id:"kjqRDg"}),fields:H,timeout:5e3,onClose:()=>{l("")},submitText:t._({id:"BZz12Q"}),successMessage:null,onFormSuccess:w=>{l(""),_(w.pk)}}),B=fe({title:t._({id:"qsurSb"}),url:D(L.report_print),timeout:5e3,fields:{template:{autoFill:!0,filters:{enabled:!0,model_type:o,items:s.join(",")}},items:{hidden:!0,value:s}},submitText:t._({id:"BZz12Q"}),successMessage:null,onFormSuccess:w=>{F(w.pk)}});return!o||!h&&!y?null:!e&&n.jsxs(n.Fragment,{children:[B.modal,O.modal,n.jsx(be,{tooltip:t._({id:"/oz6DG"}),icon:n.jsx(hn,{}),disabled:!m,actions:[{name:t._({id:"Y93N6T"}),icon:n.jsx(fn,{}),onClick:()=>O.open(),hidden:!h},{name:t._({id:"ClULGR"}),icon:n.jsx(pn,{}),onClick:()=>B.open(),hidden:!y}]})]})}function Rt(s){return{...s,color:void 0,icon:n.jsx(He,{}),onClick:e=>{const i=ce(s.modelType,s.modelId);de(i,s.navigate,e)}}}function Et(s){return{...s,title:t._({id:"euc6Ns"}),color:"green",icon:n.jsx(ze,{})}}function Mt(s){return{...s,title:t._({id:"ePK91l"}),color:"blue",icon:n.jsx(Be,{})}}function St(s){return{...s,title:t._({id:"cnGeoo"}),color:"red",icon:n.jsx(he,{})}}function Dt(s){return{...s,title:t._({id:"dEgA5A"}),color:"red",icon:n.jsx(xn,{})}}function Zn({title:s,actions:e,disabled:i=!1,index:c}){function o(l){ne(l),p(!u)}const[u,p]=r.useState(!1),m=r.useMemo(()=>e.filter(l=>!l.hidden),[e]);function x(l){return n.jsx(z,{withinPortal:!0,label:l.tooltip??l.title,position:"left",children:n.jsx(v.Item,{color:l.color,leftSection:l.icon,onClick:h=>{var y;ne(h),(y=l.onClick)==null||y.call(l,h),p(!1)},disabled:l.disabled||!1,children:l.title})},l.title)}return m.length>0&&n.jsxs(v,{withinPortal:!0,disabled:i,position:"bottom-end",opened:u,onChange:p,children:[n.jsx(v.Target,{children:n.jsx(z,{withinPortal:!0,label:s||t._({id:"7L01XJ"}),children:n.jsx(q,{"aria-label":`row-action-menu-${c??""}`,onClick:o,disabled:i,variant:"subtle",color:"gray",children:n.jsx(gn,{})},`row-action-menu-${c??""}`)})}),n.jsx(v.Dropdown,{children:m.map(l=>n.jsx(x,{...l},l.title))})]})}function et(s){const[e,i]=_n({key:`inventree-filterset-${s}`,defaultValue:[],sync:!1,getInitialValueInEffect:!1}),c=r.useCallback(()=>{i([])},[]);return{filterKey:s,activeFilters:e,setActiveFilters:i,clearActiveFilters:c}}function Lt(s,e="pk"){function i(){return`${s.replaceAll("-","")}-${Cn()}`}const[c,o]=Mn(),u=r.useCallback(()=>{o({})},[]),[p,m]=r.useState(i()),x=r.useCallback(R=>{m(i()),R&&O()},[i]),l=et(`table-${s}`),[h,y]=r.useState([]),I=r.useCallback(R=>h.includes(R),[h]),[_,b]=r.useState([]),[F,A]=r.useState([]),H=r.useMemo(()=>F.map(R=>R[e||"pk"]),[F]),O=r.useCallback(()=>{A([])},[]),B=r.useMemo(()=>F.length>0,[F]),[w,k]=r.useState(0),[C,f]=r.useState(1),[E,J]=r.useState(""),[Y,X]=r.useState([]),P=r.useCallback(R=>{const M=[...Y],V=M.findIndex(se=>se[e||"pk"]===R.pk);V>=0?M[V]={...M[V],...R}:M.push(R),X(M)},[Y]),[te,Q]=r.useState(!1);return{tableKey:p,refreshTable:x,isLoading:te,setIsLoading:Q,filterSet:l,queryFilters:c,setQueryFilters:o,clearQueryFilters:u,expandedRecords:h,setExpandedRecords:y,isRowExpanded:I,selectedRecords:F,selectedIds:H,setSelectedRecords:A,clearSelectedRecords:O,hasSelectedRecords:B,searchTerm:E,setSearchTerm:J,recordCount:w,setRecordCount:k,hiddenColumns:_,setHiddenColumns:b,page:C,setPage:f,records:Y,setRecords:X,updateRecord:P,idAccessor:e}}function nt({icon:s,actions:e,tooltip:i="",label:c=""}){return n.jsxs(v,{shadow:"xs",children:[n.jsx(v.Target,{children:n.jsx(q,{variant:"default",children:n.jsx(z,{label:i,children:s})})}),n.jsxs(v.Dropdown,{children:[c&&n.jsx(v.Label,{children:c}),e.map((o,u)=>n.jsx(v.Item,{children:o},`${u}-${o}`))]})]})}function tt({disabled:s,debounce:e,placeholder:i,searchCallback:c}){const[o,u]=r.useState(""),[p]=jn(o,e??500);return r.useEffect(()=>{c(p)},[p]),n.jsx(Pe,{value:o,disabled:s,"aria-label":"table-search-input",leftSection:n.jsx(bn,{}),placeholder:i??t._({id:"A1taO8"}),onChange:m=>u(m.target.value),rightSection:o.length>0?n.jsx(qe,{size:"xs",onClick:()=>{u(""),c("")}}):null})}function st({url:s,enabled:e,filters:i,searchTerm:c}){const o=xe(),[u,p]=r.useState("inventree-exporter"),[m,x]=r.useState(void 0);pe({title:t._({id:"gAwkCm"}),id:m});const l=r.useMemo(()=>{const _={export:!0};u&&(_.export_plugin=u);for(const[b,F]of Object.entries(i??{}))F!=null&&(_[b]=F);return c&&(_.search=c),_},[u,i,c]),h=$({enabled:!!s&&e,queryKey:["export-fields",u,s,l],gcTime:500,queryFn:()=>o.options(s,{params:l}).then(_=>je(_,"GET")||{})}),y=r.useMemo(()=>{const _=h.data||{},b={export_format:{},export_plugin:{},..._};return b.export_format={...b.export_format,required:!0},b.export_plugin={...b.export_plugin,required:!0,onValueChange:F=>{F&&p(F)}},b},[h]);return fe({url:s,queryParams:new URLSearchParams(l),title:t._({id:"CEVW38"}),method:"GET",fields:y,submitText:t._({id:"GS+Mus"}),successMessage:null,timeout:30*1e3,onFormSuccess:_=>{x(_.pk),p("inventree-exporter")}})}function it({columns:s,onToggleColumn:e}){return n.jsxs(v,{shadow:"xs",closeOnItemClick:!1,children:[n.jsx(v.Target,{children:n.jsx(q,{variant:"transparent","aria-label":"table-select-columns",children:n.jsx(z,{label:t._({id:"kCTFU8"}),position:"top-end",children:n.jsx(yn,{})})})}),n.jsxs(v.Dropdown,{style:{maxHeight:"400px",overflowY:"auto"},children:[n.jsx(v.Label,{children:t._({id:"kCTFU8"})}),n.jsx(ge,{}),s.filter(i=>i.switchable??!0).map(i=>n.jsx(v.Item,{children:n.jsx(Fn,{checked:!i.hidden,label:i.title||i.accessor,onChange:()=>e(i.accessor),radius:"sm"})},i.accessor))]})]})}function rt(s){return s.choices?s.choices:s.choiceFunction?s.choiceFunction():[{value:"true",label:t._({id:"l75CjT"})},{value:"false",label:t._({id:"1UzENP"})}]}function ot(s){return()=>{const e=Ln.getState().status;if(!e)return[];const i=e[s];return i?Object.keys(i.values).map(c=>{var u;const o=i.values[c];return{value:o.key.toString(),label:((u=o.label)==null?void 0:u.toString())??o.key.toString()}}):[]}}function Ot(){return{name:"has_batch",label:t._({id:"qPCbMt"}),description:t._({id:"rc/Y1E"})}}function Bt(){return{name:"batch",label:t._({id:"Vea6Aj"}),description:t._({id:"Y/SfF6"}),type:"text"}}function zt(){return{name:"serialized",label:t._({id:"SkCY/+"}),description:t._({id:"S5yS1f"})}}function Ht(){return{name:"serial",label:t._({id:"ypfsn/"}),description:t._({id:"hFRTeN"}),type:"text"}}function Pt(){return{name:"serial_lte",label:t._({id:"sQUbHe"}),description:t._({id:"yLzTzA"}),type:"text"}}function qt(){return{name:"serial_gte",label:t._({id:"TiS4AP"}),description:t._({id:"Gnj5CL"}),type:"text"}}function Ut(){return{name:"assigned_to_me",type:"boolean",label:t._({id:"iU3XRS"}),description:t._({id:"BnF3ID"})}}function Nt(){return{name:"outstanding",label:t._({id:"aimnwe"}),description:t._({id:"5Dr8AX"})}}function Vt(){return{name:"overdue",label:t._({id:"ddrz1m"}),description:t._({id:"eoAfY+"})}}function Gt(){return{name:"min_date",label:t._({id:"vhCfRp"}),description:t._({id:"g6o1nx"}),type:"date"}}function Kt(){return{name:"max_date",label:t._({id:"dogwLN"}),description:t._({id:"/Is0Q9"}),type:"date"}}function Yt(){return{name:"created_before",label:t._({id:"XIK9k0"}),description:t._({id:"BVOUXI"}),type:"date"}}function Qt(){return{name:"created_after",label:t._({id:"pQfuT0"}),description:t._({id:"5D7LoD"}),type:"date"}}function $t(){return{name:"start_date_before",label:t._({id:"MpyljM"}),description:t._({id:"YgY+H6"}),type:"date"}}function Jt(){return{name:"start_date_after",label:t._({id:"8IA8ke"}),description:t._({id:"5gLRm5"}),type:"date"}}function Xt(){return{name:"target_date_before",label:t._({id:"SsUIID"}),description:t._({id:"Ey6gw7"}),type:"date"}}function Wt(){return{name:"target_date_after",label:t._({id:"a8vo2j"}),description:t._({id:"wvwgPk"}),type:"date"}}function Zt(){return{name:"completed_before",label:t._({id:"7Ul+eL"}),description:t._({id:"qR6hn8"}),type:"date"}}function es(){return{name:"completed_after",label:t._({id:"cFFv89"}),description:t._({id:"liohcD"}),type:"date"}}function ns(){const e=_e.getState().isSet("PROJECT_CODES_ENABLED",!0);return{name:"has_project_code",type:"boolean",label:t._({id:"e7gdBS"}),description:t._({id:"gW+vYR"}),active:e}}function ts(){return{name:"include_variants",type:"boolean",label:t._({id:"/g9i/Z"}),description:t._({id:"yDiGmv"})}}function ss({model:s}){return{name:"status",label:t._({id:"uAQUqI"}),description:t._({id:"OIH7WF"}),choiceFunction:ot(s)}}function is(){const e=_e.getState().isSet("PROJECT_CODES_ENABLED",!0);return{name:"project_code",label:t._({id:"Sdfr6G"}),description:t._({id:"8sHFLc"}),active:e,type:"api",apiUrl:D(L.project_code_list),model:N.projectcode,modelRenderer:i=>i.code}}function lt({name:s,label:e,description:i}){return{name:s,label:e,description:i,type:"api",apiUrl:D(L.owner_list),model:N.owner,modelRenderer:c=>c.name}}function rs(){return lt({name:"assigned_to",label:t._({id:"XQACoK"}),description:t._({id:"OVVPn5"})})}function Ye({name:s,label:e,description:i}){return{name:s??"user",label:e??t._({id:"7PzzBU"}),description:i??t._({id:"FVjW63"}),type:"api",apiUrl:D(L.user_list),model:N.user,modelRenderer:c=>c.username}}function os(){return{name:"manufacturer",label:t._({id:"+m9/3S"}),description:t._({id:"ZbKIR3"}),type:"api",apiUrl:D(L.company_list),model:N.company,modelRenderer:s=>s.name,apiFilter:{is_manufacturer:!0}}}function ls(){return{name:"supplier",label:t._({id:"PYTEl0"}),description:t._({id:"L+0p0h"}),type:"api",apiUrl:D(L.company_list),model:N.company,modelRenderer:s=>s.name,apiFilter:{is_supplier:!0}}}function as(){return Ye({name:"created_by",label:t._({id:"egTba/"}),description:t._({id:"cX/tzW"})})}function cs(){return Ye({name:"issued_by",label:t._({id:"kmUN8p"}),description:t._({id:"QFznVK"})})}function ds(){return{name:"category",label:t._({id:"QXANxH"}),description:t._({id:"/zwgG7"}),apiUrl:D(L.category_list),model:N.partcategory,modelRenderer:s=>s.name}}function us(){return{name:"location",label:t._({id:"wJijgU"}),description:t._({id:"Bp02Dg"}),apiUrl:D(L.stock_location_list),model:N.stocklocation,modelRenderer:s=>s.name}}function at({flt:s,filterSet:e}){const i=r.useCallback(()=>{const c=e.activeFilters.filter(o=>o.name!==s.name);e.setActiveFilters(c)},[s]);return n.jsx(Ne,{p:"sm",shadow:"sm",radius:"xs",children:n.jsxs(G,{justify:"space-between",wrap:"nowrap",children:[n.jsxs(K,{gap:"xs",children:[n.jsx(U,{size:"sm",children:s.label}),n.jsx(U,{size:"xs",children:s.description})]}),n.jsxs(G,{justify:"right",children:[n.jsx(wn,{children:s.displayValue??s.value}),n.jsx(z,{label:t._({id:"rn2/2V"}),withinPortal:!0,children:n.jsx(qe,{size:"md",color:"red",onClick:i})})]})]},s.name)})}function ct({filterName:s,filterProps:e,valueOptions:i,onValueChange:c}){const o=r.useCallback(m=>{if(m){const x=m.toString();c(Nn(x).format("YYYY-MM-DD"))}else c("")},[c]),[u,p]=r.useState("");switch(e.type){case"api":return n.jsx(Gn,{fieldName:`filter-${s}`,fieldDefinition:{field_type:"related field",api_url:e.apiUrl,filters:e.apiFilter,placeholder:t._({id:"Fo55lj"}),model:e.model,label:t._({id:"Fo55lj"}),onValueChange:(m,x)=>{var l;c(m,(l=e.modelRenderer)==null?void 0:l.call(e,x))}}});case"text":return n.jsx(Pe,{label:t._({id:"wMHvYH"}),value:u,placeholder:t._({id:"Q//Mlp"}),rightSection:n.jsx(q,{"aria-label":"apply-text-filter",variant:"transparent",onClick:()=>c(u),children:n.jsx(Tn,{})}),onChange:m=>p(m.currentTarget.value),onKeyDown:m=>{m.key==="Enter"&&c(u)}});case"date":return n.jsx(Vn,{label:t._({id:"wMHvYH"}),placeholder:t._({id:"A63fc7"}),onChange:o});case"choice":case"boolean":default:return n.jsx(Ve,{data:i,searchable:e.type=="choice",label:t._({id:"wMHvYH"}),withScrollArea:!1,placeholder:t._({id:"Fo55lj"}),onChange:m=>c(m),maxDropdownHeight:800})}}function dt({filterSet:s,availableFilters:e}){const i=r.useMemo(()=>{var h,y,I;let l=[];return s.activeFilters&&s.activeFilters.length>0&&(l=((h=s.activeFilters)==null?void 0:h.map(_=>_.name))??[]),((I=(y=e==null?void 0:e.filter(_=>!l.includes(_.name)))==null?void 0:y.sort((_,b)=>_.label.localeCompare(b.label)))==null?void 0:I.map(_=>({value:_.name,label:_.label,description:_.description})))??[]},[s.activeFilters,e]),[c,o]=r.useState(null),u=r.useMemo(()=>{const l=e==null?void 0:e.find(h=>h.name===c);return l?rt(l):[]},[c]),p=l=>l.type?l.type:l.apiUrl&&l.model?"api":l.choices||l.choiceFunction?"choice":"boolean",m=r.useMemo(()=>{const l=e==null?void 0:e.find(h=>h.name===c);return l&&(l.type=p(l)),l},[e,c]),x=r.useCallback((l,h)=>{var b,F;const y=e.find(A=>A.name===c);if(!y)return;const I=((b=s.activeFilters)==null?void 0:b.filter(A=>A.name!==c))??[],_={...y,value:l,displayValue:h??((F=u.find(A=>A.value===l))==null?void 0:F.label)};s.setActiveFilters([...I,_]),o(null)},[c]);return n.jsxs(K,{gap:"xs",children:[n.jsx(Ve,{data:i,searchable:!0,placeholder:t._({id:"hpMOSe"}),label:t._({id:"o7J4JM"}),onChange:l=>o(l),maxDropdownHeight:400}),c&&m&&n.jsx(ct,{filterName:c,filterProps:m,valueOptions:u,onValueChange:x})]})}function ut({title:s,availableFilters:e,filterSet:i,opened:c,onClose:o}){var x;const[u,p]=r.useState(!1);r.useEffect(()=>{p(!1)},[i.activeFilters]);const m=r.useMemo(()=>((i==null?void 0:i.activeFilters)??[]).length>0,[i.activeFilters]);return n.jsxs(kn,{size:"sm",position:"right",withCloseButton:!0,opened:c,onClose:o,closeButtonProps:{"aria-label":"filter-drawer-close"},title:n.jsx(Ce,{size:"lg",children:s??t._({id:"l34cnu"})}),children:[n.jsx(ge,{}),n.jsx(Ue,{h:"sm"}),n.jsxs(K,{gap:"xs",children:[m&&((x=i.activeFilters)==null?void 0:x.map(l=>n.jsx(at,{flt:l,filterSet:i},l.name))),u&&n.jsx(K,{gap:"xs",children:n.jsx(dt,{filterSet:i,availableFilters:e})}),u&&n.jsx(ee,{onClick:()=>p(!1),color:"orange",variant:"subtle",children:n.jsx(U,{children:t._({id:"dEgA5A"})})}),!u&&i.activeFilters.length<e.length&&n.jsx(ee,{onClick:()=>p(!0),color:"green",variant:"subtle",children:n.jsx(U,{children:t._({id:"PzFzS+"})})}),!u&&i.activeFilters.length>0&&n.jsx(ee,{onClick:i.clearActiveFilters,color:"red",variant:"subtle",children:n.jsx(U,{children:t._({id:"J8ECgX"})})})]})]})}function mt({tableUrl:s,tableState:e,tableProps:i,hasSwitchableColumns:c,columns:o,filters:u,toggleColumn:p}){var F,A,H,O,B,w,k;const[m,x]=r.useState(!1),l=r.useMemo(()=>{const C={};for(const[f,E]of Object.entries(i.params??{}))E!=null&&(C[f]=E);if(e.filterSet.activeFilters&&e.filterSet.activeFilters.forEach(f=>{C[f.name]=f.value}),e.queryFilters)for(const[f,E]of e.queryFilters)E!=null&&(C[f]=E);return C},[i.params,e.filterSet,e.queryFilters]),h=st({url:s??"",enabled:!!s&&(i==null?void 0:i.enableDownload)!=!1,filters:l,searchTerm:e.searchTerm}),y=Kn({url:s??"",title:t._({id:"NEGzXb"}),preFormContent:n.jsx(Re,{color:"red",title:t._({id:"3kYcuM"}),children:t._({id:"U99rVM"})}),initialData:{items:e.selectedIds},fields:{items:{hidden:!0}},successMessage:t._({id:"B7s1hd"}),onFormError:C=>{Le({id:"bulk-delete-error",title:t._({id:"SlfejT"}),message:t._({id:"NO2Qmx"}),color:"red",icon:n.jsx(Oe,{}),autoClose:5e3})},onFormSuccess:()=>{e.clearSelectedRecords(),e.refreshTable(),i.afterBulkDelete&&i.afterBulkDelete()}}),I=r.useMemo(()=>e.queryFilters.has("search"),[e.queryFilters]),_=r.useMemo(()=>{var C;return(((C=e==null?void 0:e.queryFilters)==null?void 0:C.size)??0)>0},[e.queryFilters]),b=r.useMemo(()=>{var C;return((C=e.selectedRecords)==null?void 0:C.map(f=>ue(f,i.printingAccessor??"pk")))??[]},[i.printingAccessor,e.selectedRecords]);return n.jsxs(n.Fragment,{children:[h.modal,y.modal,i.enableFilters&&(u.length??0)>0&&n.jsx(me,{label:`InvenTreeTableFilterDrawer-${e.tableKey}`,children:n.jsx(ut,{availableFilters:u,filterSet:e.filterSet,opened:m,onClose:()=>x(!1)})}),(_||I)&&n.jsx(Re,{color:"yellow",withCloseButton:!0,title:t._({id:"VUTcDq"}),onClose:()=>e.clearQueryFilters()}),n.jsxs(G,{justify:"apart",grow:!0,wrap:"nowrap",children:[n.jsxs(G,{justify:"left",gap:5,wrap:"nowrap",children:[n.jsx(Wn,{items:b,modelType:i.modelType,enableLabels:i.enableLabels,enableReports:i.enableReports}),(((F=i.barcodeActions)==null?void 0:F.length)??0)>0&&n.jsx(nt,{icon:n.jsx(vn,{}),label:t._({id:"heU0Hk"}),tooltip:t._({id:"heU0Hk"}),actions:i.barcodeActions??[]},"barcode-actions"),i.enableBulkDelete&&n.jsx(Qn,{disabled:!e.hasSelectedRecords,icon:n.jsx(he,{}),color:"red",tooltip:t._({id:"QZQ+5V"}),onClick:()=>{y.open()}}),(A=i.tableActions)==null?void 0:A.map((C,f)=>n.jsx(n.Fragment,{children:C},f))]},"custom-actions"),n.jsx(Ue,{}),n.jsxs(G,{justify:"right",gap:5,wrap:"nowrap",children:[i.enableSearch&&n.jsx(tt,{disabled:I,searchCallback:C=>e.setSearchTerm(C)}),i.enableRefresh&&n.jsx(q,{variant:"transparent","aria-label":"table-refresh",children:n.jsx(z,{label:t._({id:"8RYNR1"}),position:"top-end",children:n.jsx(An,{onClick:()=>{e.refreshTable(),e.clearSelectedRecords()}})})}),c&&n.jsx(it,{columns:o,onToggleColumn:p}),i.enableFilters&&u.length>0&&n.jsx(ae,{size:"xs",label:((H=e.filterSet.activeFilters)==null?void 0:H.length)??0,disabled:((O=e.filterSet.activeFilters)==null?void 0:O.length)==0,children:n.jsx(q,{disabled:_,variant:"transparent","aria-label":"table-select-filters",children:n.jsxs(oe,{position:"bottom-end",withinPortal:!0,disabled:!((B=e.filterSet.activeFilters)!=null&&B.length),children:[n.jsx(oe.Target,{children:n.jsx(z,{label:t._({id:"l34cnu"}),position:"top-end",disabled:!!((w=e.filterSet.activeFilters)!=null&&w.length),children:n.jsx(In,{onClick:()=>x(!m)})})}),n.jsx(oe.Dropdown,{children:n.jsx(Ne,{p:"sm",withBorder:!0,children:n.jsxs(K,{gap:"xs",children:[n.jsx(Ce,{size:"md",children:t._({id:"GhOy5V"})}),n.jsx(ge,{}),(k=e.filterSet.activeFilters)==null?void 0:k.map(C=>n.jsxs(G,{justify:"space-between",gap:"xl",wrap:"nowrap",children:[n.jsx(U,{size:"sm",children:C.label}),n.jsx(U,{size:"xs",children:C.displayValue})]},C.name))]})})})]})})}),s&&i.enableDownload&&n.jsx(q,{variant:"transparent","aria-label":"table-export-data",children:n.jsx(z,{label:t._({id:"ECXmiK"}),position:"top-end",children:n.jsx(Rn,{onClick:h.open})})})]})]})]})}const De="--actions--",ft=[10,15,20,25,50,100,500],pt={params:{},noRecordsText:t._({id:"EqGTpW"}),enableDownload:!1,enableLabels:!1,enableReports:!1,enableFilters:!0,enablePagination:!0,enableRefresh:!0,enableSearch:!0,enableSelection:!1,defaultSortColumn:"",barcodeActions:[],printingAccessor:"pk",tableFilters:[],tableActions:[]};function ms({url:s,tableState:e,tableData:i,columns:c,props:o}){const{userTheme:u}=On(),{pageSize:p,setPageSize:m,getHiddenColumns:x,setHiddenColumns:l,getTableColumnNames:h,setTableColumnNames:y,getTableSorting:I,setTableSorting:_}=zn(),[b,F]=r.useState({}),A=xe(),H=Hn(),{showContextMenu:O}=Pn(),B=Ge(),w=r.useMemo(()=>B.isSet("STICKY_TABLE_HEADER"),[B]),k=r.useMemo(()=>{const a=`table-${e.tableKey}`,d=a.indexOf("-mantine");return d>=0?a.substring(0,d):a},[e.tableKey]),C=r.useMemo(()=>{var a,d;return((d=(a=o.tableFilters)==null?void 0:a.filter(g=>g.active!=!1))==null?void 0:d.map(g=>({...g,label:g.label??b[g.name]??`${g.name}`})))??[]},[o.tableFilters,b]),f=r.useMemo(()=>({...pt,...o}),[o]),E=$({enabled:!!s&&!i,queryKey:["options",s,k,f.params,o.enableColumnCaching],retry:5,retryDelay:a=>(1+a)*250,throwOnError:a=>(Me({error:a,title:t._({id:"0uyCkG"})}),!0),refetchOnMount:!0,gcTime:5e3,queryFn:async()=>!s||o.enableColumnCaching==!1||b&&Object.keys(b).length>0?null:A.options(s,{params:f.params}).then(a=>{if(a.status==200){const d={},g=je(a,"GET",!0)||{};Yn(g,(j,T)=>{T.label&&(d[j]=T.label)}),F(d),y(k)(d)}return null})});r.useEffect(()=>{if(o.enableColumnCaching==!1)return;const a=h(k);if(a!=null){F(a);return}},[]);const J=r.useMemo(()=>f.enableSelection||f.enableBulkDelete||!1,[f]),Y=r.useMemo(()=>o.enableColumnSwitching==!1?!1:c.some(a=>a.hidden==!0?!1:a.switchable!=!1),[c,o.enableColumnSwitching]),X=r.useCallback(a=>{e.setSelectedRecords(a)},[e.setSelectedRecords]),P=r.useMemo(()=>{let a=c.filter(d=>(d==null?void 0:d.hidden)!=!0);return a=a.map(d=>{var j;const g=d.switchable==!1?!1:((j=e.hiddenColumns)==null?void 0:j.includes(d.accessor))??!1;return{...d,hidden:g,resizable:d.resizable??!0,title:d.title??b[d.accessor]??`${d.accessor}`}}),f.rowActions&&a.push({accessor:De,title:"   ",hidden:!1,resizable:!1,switchable:!1,width:50,render:(d,g)=>{var j;return n.jsx(Zn,{actions:((j=f.rowActions)==null?void 0:j.call(f,d))??[],disabled:e.selectedRecords.length>0,index:g})}}),a},[c,b,f.rowActions,e.hiddenColumns,e.selectedRecords]),te=r.useCallback(a=>{const d=[...P],g=d.findIndex(T=>T.accessor==a);g>=0&&g<d.length&&(d[g].hidden=!d[g].hidden);const j=d.filter(T=>T.hidden).map(T=>T.accessor);e.setHiddenColumns(j),l(k)(j)},[k,P]),Q=qn({key:k,columns:P,getInitialValueInEffect:!1}),R=r.useMemo(()=>P.map(a=>a.accessor),[P]);r.useEffect(()=>{JSON.stringify(Q.columnsOrder)!=JSON.stringify(R)&&Q.setColumnsOrder(R)},[k,R]),r.useEffect(()=>{e.setPage(1)},[e.searchTerm]);const[M,V]=r.useState({columnAccessor:f.defaultSortColumn??"",direction:"asc"}),se=r.useCallback((a=!1)=>{const d={...f.params};if(e.queryFilters&&e.queryFilters.size>0)for(const[j,T]of e.queryFilters)d[j]=T;else e.filterSet.activeFilters&&e.filterSet.activeFilters.forEach(j=>{d[j.name]=j.value});e.searchTerm&&(d.search=e.searchTerm),f.enablePagination&&a&&(d.limit=p,d.offset=(e.page-1)*p);const g=Fe();return g&&(M.direction=="asc"?d.ordering=g:d.ordering=`-${g}`),d},[M,f.params,f.enablePagination,e.filterSet.activeFilters,e.queryFilters,e.searchTerm,Fe]),[ye,Qe]=r.useState(!1);r.useEffect(()=>{const a=I(k);a&&a.columnAccessor&&a.direction&&V(a);const d=x(k);if(d==null){const g=c.filter(j=>j.switchable!=!1&&j.defaultVisible==!1).map(j=>j.accessor);l(k)(g),e.setHiddenColumns(g)}else e.setHiddenColumns(d);Qe(!0)},[k]);function Fe(){const a=M.columnAccessor;if(a=="")return"";const d=P.find(g=>g.accessor==a);return(d==null?void 0:d.ordering)||a}const[$e,Je]=r.useState(f.noRecordsText??t._({id:"EqGTpW"})),Xe=r.useCallback(a=>{e.setPage(1),V(a),_(k)(a)},[k]),We=async()=>{const a=se(!0);return s?ye?A.get(s,{params:a,timeout:10*1e3}).then(d=>{var j,T;let g=((j=d.data)==null?void 0:j.results)??d.data??[];return o.dataFormatter&&(g=o.dataFormatter(g)),Array.isArray(g)||(Je(t._({id:"3o3AAs"})),g=[]),e.setRecordCount(((T=d.data)==null?void 0:T.count)??g.length),g}):[]:[]},{data:ke,isFetching:ie,isLoading:we,refetch:Ze}=$({queryKey:["tabledata",s,e.page,o.params,ye,M.columnAccessor,M.direction,e.tableKey,e.filterSet.activeFilters,e.searchTerm],retry:5,retryDelay:a=>(1+a)*250,throwOnError:a=>(Me({error:a,title:t._({id:"UJqwtM"})}),!0),enabled:!!s&&!i,queryFn:We});r.useEffect(()=>{Ze()},[e.queryFilters]),r.useEffect(()=>{const a=ie||we||E.isFetching||E.isLoading;a!=e.isLoading&&e.setIsLoading(a)},[ie,we,E.isFetching,E.isLoading,e.isLoading]);const Te=r.useMemo(()=>f.enablePagination!=!1?p:e.recordCount,[f.enablePagination,p,e.recordCount]);r.useEffect(()=>{e.setRecords(i??ke??[])},[i,ke]);const en=r.useCallback(({event:a,record:d,index:g,column:j,columnIndex:T})=>{if(j.accessor!=De){if(o.onCellClick)o.onCellClick({event:a,record:d,index:g,column:j,columnIndex:T});else if(o.onRowClick)o.onRowClick(d,g,a);else if(f.modelType){const S=f.modelField??"pk",W=ue(d,S);if(W){ne(a);const re=ce(f.modelType,W);de(re,H,a)}}}},[o.onRowClick,o.onCellClick]),nn=r.useMemo(()=>!!o.onCellContextMenu||!!o.rowActions||!!o.modelType,[o.onCellContextMenu,o.rowActions,o.modelType]),tn=({record:a,column:d,event:g})=>{if((d==null?void 0:d.noContext)===!0)return;if(o.onCellContextMenu)return o.onCellContextMenu(a,g);const j=()=>{};let T=[];if(o.rowActions&&(T=o.rowActions(a).map(S=>({key:S.title??"",title:S.title??"",color:S.color,icon:S.icon,onClick:S.onClick??j,hidden:S.hidden,disabled:S.disabled}))),o.modelType){const S=o.modelField??"pk",W=ue(a,S),re=ce(o.modelType,W);T.push({key:"detail",title:t._({id:"2Eoi/a"}),icon:n.jsx(He,{}),onClick:Ae=>{ne(Ae),de(re,H,Ae)}})}return O(T)(g)},ve=r.useCallback(a=>{m(a),e.setPage(1),e.refreshTable()},[]),sn=r.useMemo(()=>{if(o.rowExpansion)return{...o.rowExpansion,expanded:{recordIds:e.expandedRecords,onRecordIdsChange:a=>{e.setExpandedRecords(a)}}}},[e.expandedRecords,e.setExpandedRecords,o.rowExpansion]),rn=r.useMemo(()=>{let a={};return f.enablePagination&&(a={...a,totalRecords:e.recordCount,recordsPerPage:Te,page:e.page,onPageChange:e.setPage,recordsPerPageOptions:ft,onRecordsPerPageChange:ve}),a},[Te,f.enablePagination,e.recordCount,e.page,e.setPage,ve]),on=r.useMemo(()=>!!(f.onCellClick||f.onRowClick||f.modelType),[f.onCellClick,f.onRowClick,f.modelType]);return n.jsx(n.Fragment,{children:n.jsxs(K,{gap:"xs",children:[!f.noHeader&&n.jsx(me,{label:`InvenTreeTableHeader-${k}`,children:n.jsx(mt,{tableUrl:s,tableState:e,tableProps:f,hasSwitchableColumns:Y,columns:P,filters:C,toggleColumn:te})}),n.jsx(me,{label:`InvenTreeTable-${k}`,children:n.jsx(En,{pos:"relative",children:n.jsx(Un,{style:{stickyHeader:w?"top":void 0},height:w?"80vh":void 0,withTableBorder:!f.noHeader,withColumnBorders:!0,striped:!0,highlightOnHover:!0,loaderType:u.loader,pinLastColumn:f.rowActions!=null,idAccessor:e.idAccessor??"pk",minHeight:f.minHeight??300,sortStatus:M,onSortStatusChange:Xe,selectedRecords:J?e.selectedRecords:void 0,onSelectedRecordsChange:J?X:void 0,rowExpansion:sn,fetching:ie,noRecordsText:$e,records:e.records,storeColumnsKey:k,columns:Q.effectiveColumns,onCellClick:on?en:void 0,noHeader:f.noHeader??!1,defaultColumnProps:{textAlign:"left"},onCellContextMenu:nn?tn:void 0,...rn})})})]})})}export{Ut as A,Bt as B,Yt as C,Tt as D,wt as E,ds as F,Rt as G,ns as H,ms as I,cs as J,Zn as K,us as L,Gt as M,et as N,Ft as O,Wn as P,st as Q,Mt as R,$t as S,Xt as T,Ye as U,ut as V,tt as W,vt as X,At as Y,Et as Z,Dt as _,St as a,ss as b,Nt as c,Vt as d,Kt as e,Qt as f,Wt as g,Jt as h,Zt as i,es as j,is as k,rs as l,as as m,ts as n,ot as o,ls as p,os as q,Ot as r,zt as s,Ht as t,Lt as u,Pt as v,qt as w,be as x,kt as y,It as z};
//# sourceMappingURL=InvenTreeTable-_nPJoCLK.js.map
