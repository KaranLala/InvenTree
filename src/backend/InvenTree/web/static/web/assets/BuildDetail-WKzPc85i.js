import{bO as ne,r as n,i as t,j as e,G as ce,bS as Ve,bJ as Ge,bK as We,as as Ce,B as O,bU as le,d as He,ct as Ke,I as Te,b7 as Ye,S as ue,bp as Qe,cE as Je,bP as Ze,Y as Xe,bR as Ie,cx as U,dz as Se,bx as Re,eL as $e,bw as et,eA as tt,aD as st,ab as at,aV as it,ah as lt,eG as ot}from"./vendor-c9tu_e1b.js";import{e as C,A as _,p as rt,m as c,b as Pe,U as E,f as nt,h as dt}from"./index-C-YqHYR0.js";import{A as ct}from"./AdminButton-B4su-izZ.js";import{P as Fe}from"./PrimaryActionButton-DeoSYpU2.js";import{u as we,I as ve,o as ut,L as pt,r as mt,B as _t,s as bt,t as ht,v as ft,w as xt,G as kt,R as jt,y as gt,P as yt,O as Ct,E as It,z as St,X as Ft,Y as Ot}from"./InvenTreeTable-_nPJoCLK.js";import{I as At,D as ie,a as Bt}from"./InstanceDetail-BhafbIJP.js";import{D as Tt}from"./DetailsBadge-D_E2hPhf.js";import{D as Rt,N as Pt}from"./NotesPanel-B1Mm8XV0.js";import{P as wt}from"./PageDetail-UrmB-yLk.js";import{A as vt}from"./AttachmentPanel-cEo4FCl5.js";import{P as Dt}from"./PanelGroup-Dx-tKZpU.js";import{b as A,q as Et,n as de,A as De,u as Ee,h as qt}from"./UseForm-21BEg7Md.js";import{b as Mt,c as Lt,d as Nt,e as zt,B as Ut,u as Oe}from"./BuildOrderTable-p5FINNWK.js";import{u as oe}from"./UseInstance-Z-QOK6WR.js";import{u as qe}from"./UseStatusCodes-Csh8ugV0.js";import{B as Vt}from"./BuildAllocatedStockTable-B94pFMpl.js";import{a as Me}from"./BuildLineTable-QUZrvzoJ.js";import{P as Gt}from"./YesNoButton-BdKeJbQO.js";import{u as Le}from"./DesktopAppView-Bg1vO8uy.js";import{f as Wt}from"./formatters-1-K9MQML.js";import{e as Ht,u as Kt,f as Yt,a as Qt}from"./UseStockAdjustActions-PDcplZpx.js";import{j as Ne,P as ze,S as Jt}from"./ColumnRenderers-6-W27ey5.js";import{A as re}from"./ActionButton-Cn3lAMG1.js";import{P as Ae}from"./index-D1sX3jYA.js";import{a as Zt,I as w,S as Xt,p as $t}from"./ThemeContext-CVPHi9Q7.js";import{P as es}from"./PurchaseOrderTable-Ba7yiiQb.js";import{S as Be}from"./StockItemTable-BNURu3dq.js";import"./QRCode-4MaRh6JQ.js";import"./browser-oJrDmCBJ.js";import"./ModelType-CepomS9H.js";import"./GenericErrorPage-RCGZWWhe.js";import"./NotFound-Cglkc0xC.js";import"./PermissionDenied-D4im8ofc.js";import"./PageTitle-BiZTQEW1.js";import"./AttachmentLink-BmXuTpAy.js";import"./PluginSource-CpS38oS9.js";import"./RemoteComponent-BK_-mK5N.js";import"./RemoveRowButton-0iZczeVG.js";import"./UseGenerator-DwBNXut7.js";import"./OrderPartsWizard-DcOlnycT.js";import"./CompanyForms-DAK9mm-H.js";import"./PurchaseOrderForms-CcRoGXTZ.js";import"./RowExpansionIcon-DqmbZUQQ.js";function ts({buildId:a,partId:r}){const p=we("build-tests"),d=Le(),{data:j}=ne({queryKey:["build-test-templates",r,a],queryFn:async()=>r?d.get(C(_.part_test_template_list),{params:{part:r,include_inherited:!0,enabled:!0,required:!0}}).then(o=>o.data):[]});n.useEffect(()=>{p.refreshTable()},[j]);const[l,s]=n.useState(0),[b,I]=n.useState(void 0),u=Ht({partId:r,itemId:l,templateId:b}),v=A({url:C(_.stock_test_result_list),title:t._({id:"VzkBcq"}),fields:u,initialData:{template:b,result:!0},onFormSuccess:()=>p.refreshTable(),successMessage:t._({id:"VivtT0"})}),q=n.useMemo(()=>{const o={...u};return delete o.attachment,delete o.stock_item,o.template.disabled=!1,o},[r,u]),f=n.useCallback((o,k)=>p.selectedRecords.map(h=>({...o,stock_item:h.pk})),[p.selectedIds]),B=A({url:C(_.stock_test_result_list),title:t._({id:"t+Eo6q"}),fields:q,initialData:{result:!0},onFormSuccess:()=>{p.clearSelectedRecords(),p.refreshTable()},processFormData:f,successMessage:t._({id:"1QgWBV"})}),g=n.useMemo(()=>!j||j.length==0?[]:j.map(o=>({accessor:`test_${o.pk}`,title:o.test_name,sortable:!1,switchable:!0,render:k=>{const h=(k.tests||[]).filter(F=>F.template==o.pk).sort((F,L)=>L.pk-F.pk).shift();if(!h||h.result===void 0)return e.jsxs(ce,{gap:"xs",wrap:"nowrap",justify:"space-between",children:[e.jsx(Ve,{color:"lightblue",variant:"filled",children:t._({id:"4bobEy"})}),e.jsx(Ge,{label:t._({id:"VzkBcq"}),children:e.jsx(We,{size:"lg",color:"green","aria-label":"add-test-result",variant:"transparent",onClick:F=>{rt(F),s(k.pk),I(o.pk),v.open()},children:e.jsx(Ce,{})})})]});const T=[];return h.value&&T.push(e.jsxs(O,{size:"sm",children:[t._({id:"wMHvYH"}),": ",h.value]},"value")),h.notes&&T.push(e.jsxs(O,{size:"sm",children:[t._({id:"1DBGsz"}),": ",h.notes]},"notes")),h.date&&T.push(e.jsxs(O,{size:"sm",children:[t._({id:"mYGY3B"}),": ",Wt(h.date)]},"date")),h.user_detail&&T.push(e.jsx(Et,{instance:h.user_detail},"user")),e.jsx(de,{value:e.jsx(Gt,{value:h.result}),title:o.test_name,extra:T})}})),[j]),G=n.useMemo(()=>[...[{accessor:"stock",title:t._({id:"gILim+"}),sortable:!0,switchable:!1,render:k=>{if(k.serial)return`# ${k.serial}`;{const S=[];return k.batch&&S.push(e.jsxs(O,{size:"sm",children:[t._({id:"Vea6Aj"}),": ",k.batch]},"batch")),e.jsx(de,{value:e.jsxs(O,{children:[t._({id:"VbWX2u"}),": ",k.quantity]}),title:t._({id:"gILim+"}),extra:S})}}},Ne({accessor:"location_detail"})],...g],[g]),W=n.useMemo(()=>[{name:"is_building",label:t._({id:"BE5Q6v"}),description:t._({id:"AO8gAN"})}],[]),M=n.useMemo(()=>[e.jsx(De,{tooltip:t._({id:"VzkBcq"}),disabled:!p.hasSelectedRecords,onClick:o=>{B.open()}},"add-test-result")],[p.hasSelectedRecords]),x=n.useCallback(o=>[{icon:e.jsx(Ce,{}),color:"green",title:t._({id:"VzkBcq"}),onClick:k=>{s(o.pk),I(void 0),v.open()}}],[]);return e.jsxs(e.Fragment,{children:[v.modal,B.modal,e.jsx(ve,{url:C(_.stock_item_list),tableState:p,columns:G,props:{params:{part_detail:!0,location_detail:!0,tests:!0,build:a},enableSelection:!0,rowActions:x,tableFilters:W,tableActions:M,modelType:c.stockitem}})]})}function ss({build:a,output:r,opened:p,close:d}){return e.jsxs(Je,{position:"bottom",size:"lg",title:e.jsxs(ce,{p:"md",wrap:"nowrap",justify:"space-apart",children:[e.jsx(Xt,{size:"lg",children:t._({id:"XqhL5S"})}),e.jsx(Ie,{h:"lg"}),e.jsx(ze,{part:a.part_detail}),(r==null?void 0:r.serial)&&e.jsxs(O,{size:"sm",children:[t._({id:"AXeJt4"}),": ",r.serial]}),(r==null?void 0:r.batch)&&e.jsxs(O,{size:"sm",children:[t._({id:"Vea6Aj"}),": ",r.batch]}),e.jsx(Ie,{h:"lg"})]}),opened:p,onClose:d,withCloseButton:!0,closeOnEscape:!0,closeOnClickOutside:!0,styles:{header:{width:"100%"},title:{width:"100%"}},children:[e.jsx(Ze,{}),e.jsx(Xe,{p:"md",children:e.jsx(Me,{build:a,output:r,params:{tracked:!0}})})]})}function as({build:a,refreshBuild:r}){var pe,me,_e,be,he,fe,xe,ke,je;const p=Le(),d=Pe(),j=Zt(),l=we("build-outputs"),s=n.useMemo(()=>a.pk??-1,[a.pk]),b=n.useMemo(()=>a.part??-1,[a.part]),I=qe({modelType:c.build}),{data:u,refetch:v}=ne({queryKey:["buildoutputtests",b,a],queryFn:async()=>{var i;return!b||b<0?[]:(i=a==null?void 0:a.part_detail)!=null&&i.testable?p.get(C(_.part_test_template_list),{params:{part:b,include_inherited:!0,enabled:!0,required:!0}}).then(y=>y.data):[]}}),q=n.useMemo(()=>((u==null?void 0:u.length)??0)>0,[b,u]),{data:f,refetch:B}=ne({queryKey:["trackeditems",s],queryFn:async()=>!s||s<0?[]:p.get(C(_.build_line_list),{params:{build:s,tracked:!0}}).then(i=>i.data)}),g=n.useMemo(()=>((f==null?void 0:f.length)??0)>0,[f]);n.useEffect(()=>{l.refreshTable()},[u,f,g,q]);const G=n.useCallback(i=>(i==null||i.forEach((y,R)=>{const z=[];let ge=0;u==null||u.forEach(D=>{var X;const P=(X=y.tests)==null?void 0:X.filter(V=>V.template==D.pk).sort((V,$)=>V.pk<$.pk?1:-1).shift();D!=null&&D.required&&(P!=null&&P.result)&&(ge+=1),z.push({name:D.test_name,result:(P==null?void 0:P.result)??!1})}),i[R].passCount=ge,i[R].results=z;let ye=0;f==null||f.forEach(D=>{var X,V;let P=0;(V=(X=D.allocations)==null?void 0:X.filter($=>$.install_into==y.pk))==null||V.forEach($=>{P+=$.quantity}),P>=D.bom_item_detail.quantity&&(ye+=1)}),i[R].fullyAllocated=ye}),i),[b,s,u,f]),W=Mt({build:a,modalId:"add-build-output"}),M=A({url:C(_.build_output_create,s),title:t._({id:"jgrPxc"}),modalId:"add-build-output",fields:W,successMessage:t._({id:"U3Kfc5"}),timeout:1e4,initialData:{batch_code:a.batch,location:a.destination??((pe=a.part_detail)==null?void 0:pe.default_location)},onFormSuccess:()=>{B(),v(),l.refreshTable(!0)}}),[x,o]=n.useState([]),k=Lt({build:a,outputs:x,onFormSuccess:()=>{l.refreshTable(!0),r()}}),S=Nt({build:a,outputs:x,onFormSuccess:()=>{l.refreshTable(!0),r()}}),h=zt({build:a,outputs:x,onFormSuccess:()=>{l.refreshTable(!0),r()}}),T=Kt({create:!1,partId:b,stockItem:x[0],modalId:"edit-build-output"}),F=Ee({url:_.stock_item_list,pk:(me=x[0])==null?void 0:me.pk,title:t._({id:"yP367G"}),modalId:"edit-build-output",fields:T,table:l}),L=A({url:_.build_order_deallocate,pk:a.pk,title:t._({id:"ZZL0Jx"}),preFormContent:e.jsx(le,{color:"yellow",icon:e.jsx(He,{}),title:t._({id:"ZZL0Jx"}),children:t._({id:"1s7aZ2"})}),fields:{output:{hidden:!0}},initialData:{output:(_e=x[0])==null?void 0:_e.pk},onFormSuccess:()=>{B()}}),ee=Yt({partId:(be=x[0])==null?void 0:be.part,trackable:(fe=(he=x[0])==null?void 0:he.part_detail)==null?void 0:fe.trackable,modalId:"build-output-serialize"}),H=A({url:_.stock_serialize,pk:(xe=x[0])==null?void 0:xe.pk,title:t._({id:"euHSRJ"}),modalId:"build-output-serialize",fields:ee,initialData:{quantity:((ke=x[0])==null?void 0:ke.quantity)??1,destination:((je=x[0])==null?void 0:je.location)??a.destination},onFormSuccess:()=>{l.refreshTable(!0),r()}}),m=n.useMemo(()=>[{name:"status",label:t._({id:"uAQUqI"}),description:t._({id:"+Jr1e4"}),choiceFunction:ut(c.stockitem)},pt(),mt(),_t(),bt(),ht(),ft(),xt()],[]),K=n.useMemo(()=>({items:l.selectedRecords,model:c.stockitem,refresh:l.refreshTable,filters:{}}),[l.selectedRecords,l.refreshTable]),N=Qt({formProps:K,merge:!1,assign:!1,delete:!1,add:!1,count:!1,remove:!1}),Y=n.useMemo(()=>[N.dropdown,e.jsx(re,{tooltip:t._({id:"jNuqfk"}),icon:e.jsx(w,{icon:"success"}),color:"green",disabled:!l.hasSelectedRecords,onClick:()=>{o(l.selectedRecords),k.open()}},"complete-selected-outputs"),e.jsx(re,{tooltip:t._({id:"ps+JBt"}),icon:e.jsx(w,{icon:"delete"}),color:"red",disabled:!l.hasSelectedRecords,onClick:()=>{o(l.selectedRecords),S.open()}},"scrap-selected-outputs"),e.jsx(re,{tooltip:t._({id:"MXiIO4"}),icon:e.jsx(w,{icon:"cancel"}),color:"red",disabled:!l.hasSelectedRecords,onClick:()=>{o(l.selectedRecords),h.open()}},"cancel-selected-outputs"),e.jsx(De,{tooltip:t._({id:"jgrPxc"}),hidden:a.external||!d.hasAddRole(E.build),onClick:M.open},"add-build-output")],[a,d,l.selectedRecords,l.hasSelectedRecords,N.dropdown]),Q=n.useCallback(i=>{var R;const y=(a==null?void 0:a.status)==I.PRODUCTION;return[kt({title:t._({id:"MeORpZ"}),modelId:i.pk,modelType:c.stockitem,navigate:j}),{title:t._({id:"9X8lAk"}),tooltip:t._({id:"kHgU4C"}),color:"blue",hidden:!y||!g||!d.hasChangeRole(E.build),icon:e.jsx(w,{icon:"plus"}),onClick:()=>{o([i]),J()}},{title:t._({id:"kp5oT9"}),tooltip:t._({id:"NLp8ve"}),color:"red",hidden:!y||!g||!d.hasChangeRole(E.build),icon:e.jsx(w,{icon:"minus"}),onClick:()=>{o([i]),L.open()}},{title:t._({id:"Wlr+mY"}),tooltip:t._({id:"+as741"}),color:"blue",hidden:!((R=i.part_detail)!=null&&R.trackable)||!!i.serial,icon:e.jsx(w,{icon:"serial"}),onClick:()=>{o([i]),H.open()}},{title:t._({id:"bD8I7O"}),tooltip:t._({id:"BdMeIY"}),color:"green",icon:e.jsx(w,{icon:"success"}),onClick:()=>{o([i]),k.open()}},jt({tooltip:t._({id:"yP367G"}),onClick:()=>{o([i]),F.open()}}),{title:t._({id:"5mspUE"}),tooltip:t._({id:"oise/z"}),icon:e.jsx(w,{icon:"delete"}),color:"red",onClick:()=>{o([i]),S.open()}},{title:t._({id:"dEgA5A"}),tooltip:t._({id:"ewDpt2"}),icon:e.jsx(w,{icon:"cancel"}),color:"red",onClick:()=>{o([i]),h.open()}}]},[I,d,b,g]),te=n.useMemo(()=>[{accessor:"part",sortable:!0,render:i=>ze({part:i==null?void 0:i.part_detail})},{accessor:"quantity",ordering:"stock",sortable:!0,switchable:!1,title:t._({id:"gILim+"}),render:i=>{let y=i.quantity;return i.serial&&(y=`# ${i.serial}`),y}},{accessor:"batch",sortable:!0},Jt({accessor:"status",sortable:!0,model:c.stockitem}),Ne({accessor:"location_detail"}),{accessor:"allocations",sortable:!1,switchable:!1,hidden:!g,title:t._({id:"/b62hy"}),render:i=>e.jsx(Ae,{progressLabel:!0,value:i.fullyAllocated??0,maximum:(f==null?void 0:f.length)??0})},{accessor:"tests",sortable:!1,switchable:!1,title:t._({id:"E4lFEY"}),hidden:!q,render:i=>{var R;const y=((R=i.results)==null?void 0:R.map(z=>z&&e.jsxs(ce,{justify:"left",wrap:"nowrap",children:[z.result?e.jsx(Te,{color:"green"}):e.jsx(Ye,{color:"red"}),e.jsx(O,{children:z.name})]},z.name)))??[];return e.jsx(de,{value:e.jsx(Ae,{progressLabel:!0,value:i.passCount??0,maximum:(u==null?void 0:u.length)??0}),extra:y,title:t._({id:"isbwWo"})})}}],[s,b,q,g,u,f]),[se,{open:J,close:Z}]=Ke(!1),ae=n.useCallback(()=>{Z(),B()},[Z,B]);return e.jsxs(e.Fragment,{children:[M.modal,k.modal,S.modal,F.modal,L.modal,h.modal,H.modal,N.modals.map(i=>i.modal),e.jsx(ss,{build:a,output:x[0],opened:se,close:ae}),e.jsxs(ue,{gap:"xs",children:[a.external&&e.jsx(le,{color:"blue",icon:e.jsx(Qe,{}),title:t._({id:"ckc7Jf"}),children:t._({id:"5pH9Hn"})}),e.jsx(ve,{tableState:l,url:C(_.stock_item_list),columns:te,props:{params:{part_detail:!0,location_detail:!0,tests:!0,is_building:!0,build:s},enableLabels:!0,enableReports:!0,modelType:c.stockitem,dataFormatter:G,tableFilters:m,tableActions:Y,rowActions:Q,enableSelection:!0,onRowClick:i=>{g&&i.serial&&(o([i]),J())}}})]})]})}function Ue(){return e.jsx(le,{color:"blue",icon:e.jsx(Re,{}),title:t._({id:"RBkcix"}),children:e.jsxs(ue,{gap:"xs",children:[e.jsx(O,{children:t._({id:"bcmsL1"})}),e.jsx(O,{children:t._({id:"qMpNaN"})})]})})}function is({build:a,isLoading:r,hasItems:p}){return r||!a.pk?e.jsx(U,{w:"100%",h:400,animate:!0}):p?e.jsx(Me,{build:a}):e.jsx(Ue,{})}function ls({build:a,isLoading:r,hasItems:p}){return r||!a.pk?e.jsx(U,{w:"100%",h:400,animate:!0}):p?e.jsx(Vt,{buildId:a.pk,showPartInfo:!0,allowEdit:!0}):e.jsx(Ue,{})}function Qs(){var L,ee,H;const{id:a}=$t(),r=Pe(),p=nt(),{instance:d,instanceQuery:j}=oe({endpoint:_.build_line_list,params:{build:a,allocations:!1,part_detail:!1,build_detail:!1,bom_item_detail:!1,limit:1},disabled:!a,hasPrimaryKey:!1,defaultValue:{}}),l=qe({modelType:c.build}),{instance:s,refreshInstance:b,instanceQuery:I}=oe({endpoint:_.build_order_list,pk:a,params:{part_detail:!0},refetchOnMount:!0}),{instance:u,instanceQuery:v}=oe({endpoint:_.part_requirements,pk:s==null?void 0:s.part,hasPrimaryKey:!0,defaultValue:{}}),q=n.useMemo(()=>{var te,se,J,Z,ae;if(I.isFetching)return e.jsx(U,{});const m={...s,can_build:(u==null?void 0:u.can_build)??0},K=[{type:"link",name:"part",label:t._({id:"vgP+9p"}),model:c.part},{type:"text",name:"part_detail.IPN",icon:"part",label:t._({id:"3wXEsN"}),hidden:!((te=s.part_detail)!=null&&te.IPN),copy:!0},{type:"string",name:"part_detail.revision",icon:"revision",label:t._({id:"6LTyxl"}),hidden:!((se=s.part_detail)!=null&&se.revision),copy:!0},{type:"status",name:"status",label:t._({id:"uAQUqI"}),model:c.build},{type:"status",name:"status_custom_key",label:t._({id:"4DvUAJ"}),model:c.build,icon:"status",hidden:!s.status_custom_key||s.status_custom_key==s.status},{type:"boolean",name:"external",label:t._({id:"bVhrVt"}),icon:"manufacturers",hidden:!s.external},{type:"text",name:"purchase_order",label:t._({id:"KxySMG"}),icon:"purchase_orders",copy:!0,hidden:!s.external,value_formatter:()=>"TODO: external PO"},{type:"text",name:"reference",label:t._({id:"N2C89m"}),copy:!0},{type:"text",name:"title",label:t._({id:"Nu4oKW"}),icon:"description",copy:!0},{type:"link",name:"parent",icon:"builds",label:t._({id:"jqsG41"}),model_field:"reference",model:c.build,hidden:!s.parent}],N=[{type:"number",name:"quantity",label:t._({id:"Ee+3kG"})},{type:"number",name:"can_build",unit:(J=s.part_detail)==null?void 0:J.units,label:t._({id:"S/9nwz"}),hidden:v.isFetching},{type:"progressbar",name:"completed",icon:"progress",total:s.quantity,progress:s.completed,label:t._({id:"Mzv4va"})},{type:"link",name:"sales_order",label:t._({id:"LozYBo"}),icon:"sales_orders",model:c.salesorder,model_field:"reference",hidden:!s.sales_order}],Y=[{type:"text",name:"issued_by",label:t._({id:"kmUN8p"}),icon:"user",badge:"user",hidden:!s.issued_by},{type:"text",name:"responsible",label:t._({id:"XQACoK"}),badge:"owner",hidden:!s.responsible},{type:"text",name:"project_code_label",label:t._({id:"Sdfr6G"}),icon:"reference",copy:!0,hidden:!s.project_code},{type:"link",name:"take_from",icon:"location",model:c.stocklocation,label:t._({id:"/00Ond"}),backup_value:t._({id:"aZD9Yv"})},{type:"link",name:"destination",icon:"location",model:c.stocklocation,label:t._({id:"o35LCI"}),hidden:!s.destination},{type:"text",name:"batch",label:t._({id:"Vea6Aj"}),hidden:!s.batch,copy:!0}],Q=[{type:"date",name:"creation_date",label:t._({id:"d+F6q9"}),icon:"calendar",copy:!0,hidden:!s.creation_date},{type:"date",name:"start_date",label:t._({id:"D3iCkb"}),icon:"calendar",copy:!0,hidden:!s.start_date},{type:"date",name:"target_date",label:t._({id:"ZmykKo"}),icon:"calendar",copy:!0,hidden:!s.target_date},{type:"date",name:"completion_date",label:t._({id:"qqWcBV"}),icon:"calendar",copy:!0,hidden:!s.completion_date}];return e.jsxs(At,{children:[e.jsxs(Se,{grow:!0,children:[e.jsx(Rt,{appRole:E.part,apiPath:_.part_list,src:((Z=s.part_detail)==null?void 0:Z.image)??((ae=s.part_detail)==null?void 0:ae.thumbnail),pk:s.part}),e.jsx(Se.Col,{span:{base:12,sm:8},children:e.jsx(ie,{fields:K,item:m})})]}),e.jsx(ie,{fields:N,item:m}),e.jsx(ie,{fields:Y,item:m}),e.jsx(ie,{fields:Q,item:m})]})},[s,I,u,v.isFetching]),f=n.useMemo(()=>{var m;return[{name:"details",label:t._({id:"98Q4bz"}),icon:e.jsx(Re,{}),content:q},{name:"line-items",label:t._({id:"T2s1M7"}),icon:e.jsx($e,{}),content:e.jsx(is,{build:s,isLoading:j.isFetching||j.isLoading,hasItems:(d==null?void 0:d.count)>0})},{name:"allocated-stock",label:t._({id:"MD2yP5"}),icon:e.jsx(et,{}),hidden:s.status==l.COMPLETE||s.status==l.CANCELLED||((d==null?void 0:d.count)??0)<=0,content:e.jsx(ls,{build:s,isLoading:j.isFetching||j.isLoading,hasItems:(d==null?void 0:d.count)>0})},{name:"consumed-stock",label:t._({id:"US3GCq"}),icon:e.jsx(tt,{}),hidden:((d==null?void 0:d.count)??0)<=0,content:e.jsx(Be,{allowAdd:!1,tableName:"build-consumed",showLocation:!1,allowReturn:!0,params:{consumed_by:a}})},{name:"incomplete-outputs",label:t._({id:"E9en8O"}),icon:e.jsx(st,{}),content:s.pk?e.jsx(as,{build:s,refreshBuild:b}):e.jsx(U,{}),hidden:s.status==l.COMPLETE||s.status==l.CANCELLED},{name:"complete-outputs",label:t._({id:"Mzv4va"}),icon:e.jsx(at,{}),content:e.jsx(Be,{allowAdd:!1,tableName:"completed-build-outputs",params:{build:a,is_building:!1}})},{name:"external-purchase-orders",label:t._({id:"X0hvRl"}),icon:e.jsx(it,{}),content:s.pk?e.jsx(es,{externalBuildId:s.pk}):e.jsx(U,{}),hidden:!r.hasViewRole(E.purchase_order)||!s.external||!p.isSet("BUILDORDER_EXTERNAL_BUILDS")},{name:"child-orders",label:t._({id:"CVlgqS"}),icon:e.jsx(lt,{}),content:s.pk?e.jsx(Ut,{parentBuildId:s.pk}):e.jsx(U,{})},{name:"test-results",label:t._({id:"isbwWo"}),icon:e.jsx(ot,{}),hidden:!((m=s.part_detail)!=null&&m.testable),content:s.pk?e.jsx(ts,{buildId:s.pk,partId:s.part}):e.jsx(U,{})},vt({model_type:c.build,model_id:s.pk}),Pt({model_type:c.build,model_id:s.pk})]},[s,a,r,l,p,j.isFetching,j.isLoading,d]),B=Oe({create:!1,modalId:"edit-build-order"}),g=Ee({url:_.build_order_list,pk:s.pk,title:t._({id:"B7ynKf"}),modalId:"edit-build-order",fields:B,onFormSuccess:b}),G=n.useMemo(()=>{const m={...s};return delete m.reference,m},[s]),W=Oe({create:!1,modalId:"duplicate-build-order"}),M=A({url:_.build_order_list,title:t._({id:"59jtLx"}),modalId:"duplicate-build-order",fields:W,initialData:G,follow:!0,modelType:c.build}),x=A({url:C(_.build_order_cancel,s.pk),title:t._({id:"MTYJu1"}),onFormSuccess:b,successMessage:t._({id:"H5qWhm"}),preFormWarning:t._({id:"MPFqR0"}),fields:{remove_allocated_stock:{},remove_incomplete_outputs:{}}}),o=A({url:C(_.build_order_hold,s.pk),title:t._({id:"hZIvSn"}),onFormSuccess:b,preFormWarning:t._({id:"3Wfk51"}),successMessage:t._({id:"0NH/ob"})}),k=A({url:C(_.build_order_issue,s.pk),title:t._({id:"Z4Rl+B"}),onFormSuccess:b,preFormWarning:t._({id:"lLiNZC"}),successMessage:t._({id:"R/WvFK"})}),S=n.useMemo(()=>{const m=((d==null?void 0:d.count)??0)>0;return{accept_overallocated:{hidden:!m},accept_unallocated:{hidden:!m},accept_incomplete:{}}},[d.count]),h=A({url:C(_.build_order_complete,s.pk),title:t._({id:"Q/TP3B"}),onFormSuccess:b,preFormContent:e.jsx(le,{color:"green",icon:e.jsx(Te,{}),title:t._({id:"DYITap"})}),successMessage:t._({id:"W7TghJ"}),fields:S}),T=n.useMemo(()=>{const m=r.hasChangeRole(E.build),K=m&&(s.status==l.PENDING||s.status==l.ON_HOLD),N=m&&s.status==l.PRODUCTION,Y=m&&(s.status==l.PENDING||s.status==l.PRODUCTION),Q=m&&(s.status==l.PENDING||s.status==l.ON_HOLD||s.status==l.PRODUCTION);return[e.jsx(Fe,{title:t._({id:"WajCDs"}),icon:"issue",hidden:!K,color:"blue",onClick:k.open}),e.jsx(Fe,{title:t._({id:"NPZqBL"}),icon:"complete",hidden:!N,color:"green",onClick:h.open}),e.jsx(ct,{model:c.build,id:s.pk}),e.jsx(gt,{model:c.build,pk:s.pk,hash:s==null?void 0:s.barcode_hash}),e.jsx(yt,{modelType:c.build,items:[s.pk],enableReports:!0}),e.jsx(Ct,{tooltip:t._({id:"tDgG1Y"}),actions:[It({onClick:()=>g.open(),hidden:!m,tooltip:t._({id:"mVeaUg"})}),St({onClick:()=>M.open(),tooltip:t._({id:"oi/3Pq"}),hidden:!r.hasAddRole(E.build)}),Ft({tooltip:t._({id:"20mLBC"}),hidden:!Y,onClick:o.open}),Ot({tooltip:t._({id:"tVJk4q"}),onClick:x.open,hidden:!Q})]})]},[a,s,r,l]),F=n.useMemo(()=>I.isFetching?[]:[e.jsx(qt,{status:s.status_custom_key,type:c.build,options:{size:"lg"}}),e.jsx(Tt,{label:t._({id:"bVhrVt"}),color:"blue",visible:s.external},"external")],[s,I]);return e.jsxs(e.Fragment,{children:[g.modal,M.modal,x.modal,o.modal,k.modal,h.modal,e.jsx(Bt,{query:I,requiredRole:E.build,children:e.jsxs(ue,{gap:"xs",children:[e.jsx(wt,{title:`${t._({id:"YxwWvi"})}: ${s.reference}`,subtitle:`${s.quantity} x ${(L=s.part_detail)==null?void 0:L.full_name}`,badges:F,editAction:g.open,editEnabled:r.hasChangePermission(c.part),imageUrl:((ee=s.part_detail)==null?void 0:ee.image)??((H=s.part_detail)==null?void 0:H.thumbnail),breadcrumbs:[{name:t._({id:"3ctapx"}),url:"/manufacturing"}],lastCrumb:[{name:s.reference,url:dt(c.build,s.pk)}],actions:T}),e.jsx(Dt,{pageKey:"build",panels:f,instance:s,reloadInstance:b,model:c.build,id:s.pk})]})})]})}export{Qs as default};
//# sourceMappingURL=BuildDetail-WKzPc85i.js.map
